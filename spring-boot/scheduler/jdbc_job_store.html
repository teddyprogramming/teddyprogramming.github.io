
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="hello_world.html">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>JDBC JobStore - Teddy 的筆記本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.76a95c52.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quartz-jdbc-jobstore" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Teddy 的筆記本" class="md-header__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teddy 的筆記本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JDBC JobStore
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teddy 的筆記本" class="md-nav__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Teddy 的筆記本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    IDE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            IDE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ide/jet-brains/shortcuts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JetBrains 快捷鍵
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Effective Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/001.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 1 - Consider static factory methods instead of constructors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/002.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 2 - Consider a builder when faced with many constructor parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/003.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 3 - Enforce the singleton property with a private constructor or an enum type
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/004.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 4 - Enforce noninstantiability with a private constructor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/005.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 5 - Prefer dependency injection to hardwiring resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/006.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 6 - Avoid creating unnecessary objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/007.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 7 - Eliminate obsolete object references
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/008.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 8 - Avoid finalizers and cleaners
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/009.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 9 - Prefer try-with-resources to try-finally
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spring Boot
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Spring Boot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scheduler
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Scheduler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quartz
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            Quartz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hello_world.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    JDBC JobStore
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="jdbc_job_store.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    JDBC JobStore
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    <span class="md-ellipsis">
      簡單的 Job 範例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      探討: 執行時間超過下一次排程的時間的行為
    </span>
  </a>
  
    <nav class="md-nav" aria-label="探討: 執行時間超過下一次排程的時間的行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disallowconcurrentexecution" class="md-nav__link">
    <span class="md-ellipsis">
      使用@DisallowConcurrentExecution 來避免重疊執行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trigger" class="md-nav__link">
    <span class="md-ellipsis">
      計算排程的時間與觸發的時間差來忽略錯過的 trigger
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job_1" class="md-nav__link">
    <span class="md-ellipsis">
      探討: Job 執行過程發生錯誤的行為
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      參考
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="quartz-jdbc-jobstore">Quartz: JDBC JobStore</h1>
<h2 id="job">簡單的 Job 範例</h2>
<p>以下範例展示，在 Spring Boot 中如何設定 Quartz 使用 JDBC JobStore。如此一來，我們把 Job 放到 cluster 上執行。</p>
<p>在 <code>build.gradle.kts</code> 中新增 <code>spring-boot-starter-quartz</code> 相依套件。如此，程式啟動後就會有一個 Quartz Scheduler 在背景執行。</p>
<div class="highlight"><span class="filename">build.gradle.kts</span><pre><span></span><code><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-quartz&quot;</span><span class="p">)</span>
</code></pre></div>
<p>使用 docker compose 執行 mysql。</p>
<div class="highlight"><span class="filename">compose.yml</span><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.1&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">database</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:8.4.0</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3306:3306&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quartz</span>
</code></pre></div>
<p>設定 spring boot 的 properties。</p>
<div class="highlight"><span class="filename">src/main/resources/application.yml</span><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w"> </span><span class="c1">#(1)!</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datasource</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://localhost:3306/quartz</span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.mysql.cj.jdbc.Driver</span>
<span class="w">  </span><span class="nt">quartz</span><span class="p">:</span>
<span class="w">    </span><span class="nt">job-store-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc</span><span class="w"> </span><span class="c1">#(2)!</span>
<span class="w">    </span><span class="nt">jdbc</span><span class="p">:</span>
<span class="w">      </span><span class="nt">initialize-schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w"> </span><span class="c1">#(3)!</span>
<span class="w">    </span><span class="nt">overwrite-existing-jobs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">org</span><span class="p">:</span>
<span class="w">        </span><span class="nt">quartz</span><span class="p">:</span>
<span class="w">          </span><span class="nt">scheduler</span><span class="p">:</span>
<span class="w">            </span><span class="nt">instanceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scheduler</span>
<span class="w">            </span><span class="nt">instanceId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTO</span><span class="w"> </span><span class="c1">#(4)!</span>
<span class="w">          </span><span class="nt">dataSource</span><span class="p">:</span>
<span class="w">            </span><span class="nt">quartzDataSource</span><span class="p">:</span><span class="w"> </span><span class="c1">#(5)!</span>
<span class="w">              </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.mysql.cj.jdbc.Driver</span>
<span class="w">              </span><span class="nt">URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://localhost:3306/quartz</span>
<span class="w">              </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">              </span><span class="nt">password</span><span class="p">:</span>
<span class="w">              </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hikaricp</span>
<span class="w">          </span><span class="nt">jobStore</span><span class="p">:</span>
<span class="w">            </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.quartz.impl.jdbcjobstore.JobStoreTX</span>
<span class="w">            </span><span class="nt">dataSource</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quartzDataSource</span><span class="w"> </span><span class="c1">#(5)!</span>
<span class="w">            </span><span class="nt">isClustered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1">#(6)!</span>
</code></pre></div>
<ol>
<li><code>spring.quartz.jdbc.initialize-schema</code> 吃的 Data Source 設定。在 <code>spring.quartz.properties.org.quartz.dataSource</code> 設定的 Data Source 不支援 initialize schema。</li>
<li>使用 JDBC JobStore。</li>
<li>每次啟動都會初始化 schema。換句話說，我們可以不必手動新增 quartz 相關的 tables。(<a href="https://github.com/quartz-scheduler/quartz/tree/main/quartz/src/main/resources/org/quartz/impl/jdbcjobstore">SQL 參考</a>)</li>
<li>在 cluster 上的 pod 需要有唯一的 instance id。這裡設定 <code>AUTO</code> 即可達到需求。</li>
<li>data source 的設定。這裡的名稱會在下面設定 job store 的 dataSource 參考。</li>
<li>job store 使用的 dataSource。</li>
<li>啟用 cluster。</li>
</ol>
<details class="tip">
<summary>使用變數來避免重複設定</summary>
<div class="highlight"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quartz</span><span class="p">:</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">org</span><span class="p">:</span>
<span class="w">        </span><span class="nt">quartz</span><span class="p">:</span>
<span class="w">          </span><span class="nt">dataSource</span><span class="p">:</span>
<span class="w">            </span><span class="nt">quartzDataSource</span><span class="p">:</span>
<span class="w">              </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${spring.datasource.driver-class-name}</span>
<span class="w">              </span><span class="nt">URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${spring.datasource.url}</span>
<span class="w">              </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${spring.datasource.username}</span>
<span class="w">              </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${spring.datasource.password}</span>
</code></pre></div>
</details>
<p>新增 <code>Job</code> 實作，簡單的在畫面輸出現在的時間以及 "Hello World!"。印出時間是為了幫助我們識別這是哪個時間點所觸發的 Job。</p>
<div class="highlight"><span class="filename">HelloWorldJob.java</span><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloWorldJob</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">JobExecutionContext</span><span class="w"> </span><span class="n">jobExecutionContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;hh:mm:ss&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Hello World!&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>新增 <code>JobDetail</code> 和 <code>Trigger</code> 的 Bean 定義。這裡設定每 10 秒觸發一次 Job 在畫面上輸出 "Hello World!"。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">QuartzConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JobDetail</span><span class="w"> </span><span class="nf">helloWorldJobDetail</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JobBuilder</span><span class="p">.</span><span class="na">newJob</span><span class="p">(</span><span class="n">HelloWorldJob</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                         </span><span class="p">.</span><span class="na">withIdentity</span><span class="p">(</span><span class="s">&quot;helloWorldJob&quot;</span><span class="p">)</span>
<span class="w">                         </span><span class="p">.</span><span class="na">storeDurably</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Trigger</span><span class="w"> </span><span class="nf">helloWorldTrigger</span><span class="p">(</span><span class="n">JobDetail</span><span class="w"> </span><span class="n">printHelloWorldJobDetail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TriggerBuilder</span><span class="p">.</span><span class="na">newTrigger</span><span class="p">()</span>
<span class="w">                             </span><span class="p">.</span><span class="na">forJob</span><span class="p">(</span><span class="n">printHelloWorldJobDetail</span><span class="p">)</span>
<span class="w">                             </span><span class="p">.</span><span class="na">withIdentity</span><span class="p">(</span><span class="s">&quot;helloWorldTrigger&quot;</span><span class="p">)</span>
<span class="w">                             </span><span class="p">.</span><span class="na">withSchedule</span><span class="p">(</span><span class="n">CronScheduleBuilder</span><span class="p">.</span><span class="na">cronSchedule</span><span class="p">(</span><span class="s">&quot;*/10 * * * * ?&quot;</span><span class="p">))</span>
<span class="w">                             </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>為了可以同時執行多個 instance，我們將程式打包成 tar 檔。專案的目錄 /build/libs 應該會產生 xxx.jar 檔。</p>
<div class="highlight"><pre><span></span><code>./gradlew<span class="w"> </span>bootJar
</code></pre></div>
<p>打開 3 個 terminal，分別執行以下指令執行程式: (xxx 替換成實際檔案名稱)</p>
<div class="highlight"><pre><span></span><code>java<span class="w"> </span>-jar<span class="w"> </span>build/libs/xxx.jar
</code></pre></div>
<p>觀察每 10 秒只會有一個 terminal 輸出 "Hello World!"。這表示 Job 是在 cluster 上執行的。將輸出訊息的 terminal 關閉，可以觀察到其他 terminal 會接續執行輸出 "Hello World!" 的 Job。</p>
<div class="admonition note">
<p class="admonition-title">一個 trigger 一個 job instance 的設定</p>
<p><code>org.quartz.scheduler.batchTriggerAcquisitionMaxCount</code> 預設值為 1 設定了 Trigger 的 job 一次執行一個 instance。可以設定其他數值來讓同一 trigger 同時執行多個 job。</p>
</div>
<h2 id="_1">探討: 執行時間超過下一次排程的時間的行為</h2>
<p>假設我們設定每 10 秒跑一個 job。並且，每個 job 執行時間需要 15 秒。也就是說，job 的執行時間必定會覆蓋到下一次觸發的時間。在沒有特別設定的情況下，經過 30 秒後，將會有 3 個 job 被跑起來。job 與 job 的時間時間是會重疊的。</p>
<div class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="99px" preserveAspectRatio="true" style="background: #ffffff" version="1.1" viewBox="0 0 562 99" width="562px" zoomAndPan="magnify"><defs/><g><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="0" x2="0" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="16" x2="16" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="32" x2="32" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="48" x2="48" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="64" x2="64" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="80" x2="80" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="96" x2="96" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="112" x2="112" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="128" x2="128" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="144" x2="144" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="160" x2="160" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="176" x2="176" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="192" x2="192" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="208" x2="208" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="224" x2="224" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="240" x2="240" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="256" x2="256" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="272" x2="272" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="288" x2="288" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="304" x2="304" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="320" x2="320" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="336" x2="336" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="352" x2="352" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="368" x2="368" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="384" x2="384" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="400" x2="400" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="416" x2="416" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="432" x2="432" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="448" x2="448" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="464" x2="464" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="480" x2="480" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="496" x2="496" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="512" x2="512" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="528" x2="528" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="544" x2="544" y1="6" y2="91.2188"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="560" x2="560" y1="6" y2="91.2188"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="0" x2="0" y1="16" y2="83.2188"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="160" x2="160" y1="16" y2="83.2188"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="320" x2="320" y1="16" y2="83.2188"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="480" x2="480" y1="16" y2="83.2188"/><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="9.2822">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="9.2822">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="9.2822">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="9.2822">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="9.2822">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="9.2822">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="9.2822">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="9.2822">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="9.2822">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="9.2822">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="9.2822">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="9.2822">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="9.2822">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="9.2822">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="9.2822">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="9.2822">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="9.2822">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="9.2822">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="9.2822">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="9.2822">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="9.2822">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="9.2822">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="9.2822">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="9.2822">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="9.2822">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="9.2822">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="9.2822">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="9.2822">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="9.2822">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="9.2822">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="9.2822">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="9.2822">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="9.2822">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="9.2822">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="9.2822">35</text><polygon fill="#000000" points="8,18,13,23,8,28,3,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="168,18,173,23,168,28,163,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="328,18,333,23,328,28,323,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="488,18,493,23,488,28,483,23" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="2" y="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="34.8047" y2="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="47.6094" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="2" y1="34.8047" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="238" x2="238" y1="34.8047" y2="47.6094"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="162" y="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="162" x2="398" y1="51.6094" y2="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="162" x2="398" y1="64.4141" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="162" x2="162" y1="51.6094" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="398" x2="398" y1="51.6094" y2="64.4141"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="322" y="68.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="558" y1="68.4141" y2="68.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="558" y1="81.2188" y2="81.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="322" y1="68.4141" y2="81.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="558" x2="558" y1="68.4141" y2="81.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="16" y="28.2104">T1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="176" y="28.2104">T2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="336" y="28.2104">T3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="496" y="28.2104">T4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="6" y="45.0151">Job 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="166" y="61.8198">Job 2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="326" y="78.6245">Job 3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="95.501">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="95.501">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="95.501">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="95.501">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="95.501">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="95.501">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="95.501">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="95.501">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="95.501">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="95.501">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="95.501">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="95.501">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="95.501">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="95.501">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="95.501">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="95.501">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="95.501">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="95.501">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="95.501">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="95.501">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="95.501">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="95.501">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="95.501">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="95.501">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="95.501">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="95.501">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="95.501">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="95.501">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="95.501">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="95.501">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="95.501">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="95.501">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="95.501">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="95.501">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="95.501">35</text></g></svg></div>

<h3 id="disallowconcurrentexecution">使用<code>@DisallowConcurrentExecution</code> 來避免重疊執行</h3>
<p>在 Job 的宣告加上 <code>@DisallowConcurrentExecution</code> 來避免 Job 重疊執行。</p>
<div class="highlight"><span class="filename">HelloWorldJob.java</span><pre><span></span><code><span class="hll"><span class="nd">@DisallowConcurrentExecution</span>
</span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloWorldJob</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>如此，當 Job 還在執行時，下一次的 Job 將會被延遲到上一次的 Job 執行完畢後再執行。變更後的
3 個 Job 執行時間軸參考下圖:</p>
<div class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="119px" preserveAspectRatio="true" style="background: #ffffff" version="1.1" viewBox="0 0 722 119" width="722px" zoomAndPan="magnify"><defs/><g><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="0" x2="0" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="16" x2="16" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="32" x2="32" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="48" x2="48" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="64" x2="64" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="80" x2="80" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="96" x2="96" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="112" x2="112" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="128" x2="128" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="144" x2="144" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="160" x2="160" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="176" x2="176" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="192" x2="192" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="208" x2="208" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="224" x2="224" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="240" x2="240" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="256" x2="256" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="272" x2="272" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="288" x2="288" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="304" x2="304" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="320" x2="320" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="336" x2="336" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="352" x2="352" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="368" x2="368" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="384" x2="384" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="400" x2="400" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="416" x2="416" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="432" x2="432" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="448" x2="448" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="464" x2="464" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="480" x2="480" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="496" x2="496" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="512" x2="512" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="528" x2="528" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="544" x2="544" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="560" x2="560" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="576" x2="576" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="592" x2="592" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="608" x2="608" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="624" x2="624" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="640" x2="640" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="656" x2="656" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="672" x2="672" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="688" x2="688" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="704" x2="704" y1="6" y2="111.6953"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="720" x2="720" y1="6" y2="111.6953"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="0" x2="0" y1="16" y2="103.6953"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="160" x2="160" y1="16" y2="103.6953"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="320" x2="320" y1="16" y2="103.6953"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="480" x2="480" y1="16" y2="103.6953"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="640" x2="640" y1="16" y2="103.6953"/><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="9.2822">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="9.2822">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="9.2822">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="9.2822">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="9.2822">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="9.2822">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="9.2822">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="9.2822">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="9.2822">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="9.2822">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="9.2822">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="9.2822">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="9.2822">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="9.2822">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="9.2822">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="9.2822">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="9.2822">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="9.2822">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="9.2822">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="9.2822">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="9.2822">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="9.2822">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="9.2822">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="9.2822">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="9.2822">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="9.2822">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="9.2822">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="9.2822">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="9.2822">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="9.2822">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="9.2822">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="9.2822">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="9.2822">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="9.2822">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="9.2822">35</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="561.6377" y="9.2822">36</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="577.6377" y="9.2822">37</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="593.6377" y="9.2822">38</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="609.6377" y="9.2822">39</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="625.6377" y="9.2822">40</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="641.6377" y="9.2822">41</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="657.6377" y="9.2822">42</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="673.6377" y="9.2822">43</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="689.6377" y="9.2822">44</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="705.6377" y="9.2822">45</text><polygon fill="#000000" points="8,18,13,23,8,28,3,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="168,18,173,23,168,28,163,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="328,18,333,23,328,28,323,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="488,18,493,23,488,28,483,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="648,18,653,23,648,28,643,23" style="stroke:#000000;stroke-width:1.0;"/><path d="M0,49.6094 L0,70.0859 L81.3457,70.0859 L81.3457,59.6094 L71.3457,49.6094 L0,49.6094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M71.3457,49.6094 L71.3457,59.6094 L81.3457,59.6094 L71.3457,49.6094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="60.3457" x="6" y="62.9634">Trigger by T1</text><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="2" y="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="34.8047" y2="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="47.6094" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="2" y1="34.8047" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="238" x2="238" y1="34.8047" y2="47.6094"/><path d="M240,66.4141 L240,86.8906 L321.3457,86.8906 L321.3457,76.4141 L311.3457,66.4141 L240,66.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M311.3457,66.4141 L311.3457,76.4141 L321.3457,76.4141 L311.3457,66.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="60.3457" x="246" y="79.7681">Trigger by T2</text><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="242" y="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="478" y1="51.6094" y2="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="478" y1="64.4141" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="242" y1="51.6094" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="478" x2="478" y1="51.6094" y2="64.4141"/><path d="M480,83.2188 L480,103.6953 L561.3457,103.6953 L561.3457,93.2188 L551.3457,83.2188 L480,83.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M551.3457,83.2188 L551.3457,93.2188 L561.3457,93.2188 L551.3457,83.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="60.3457" x="486" y="96.5728">Trigger by T3</text><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="482" y="68.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="482" x2="718" y1="68.4141" y2="68.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="482" x2="718" y1="81.2188" y2="81.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="482" x2="482" y1="68.4141" y2="81.2188"/><line style="stroke:#181818;stroke-width:1.0;" x1="718" x2="718" y1="68.4141" y2="81.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="16" y="28.2104">T1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="176" y="28.2104">T2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="336" y="28.2104">T3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="496" y="28.2104">T4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="656" y="28.2104">T5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="6" y="45.0151">Job 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="246" y="61.8198">Job 2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="486" y="78.6245">Job 3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="115.9775">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="115.9775">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="115.9775">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="115.9775">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="115.9775">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="115.9775">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="115.9775">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="115.9775">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="115.9775">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="115.9775">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="115.9775">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="115.9775">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="115.9775">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="115.9775">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="115.9775">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="115.9775">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="115.9775">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="115.9775">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="115.9775">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="115.9775">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="115.9775">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="115.9775">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="115.9775">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="115.9775">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="115.9775">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="115.9775">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="115.9775">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="115.9775">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="115.9775">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="115.9775">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="115.9775">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="115.9775">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="115.9775">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="115.9775">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="115.9775">35</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="561.6377" y="115.9775">36</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="577.6377" y="115.9775">37</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="593.6377" y="115.9775">38</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="609.6377" y="115.9775">39</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="625.6377" y="115.9775">40</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="641.6377" y="115.9775">41</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="657.6377" y="115.9775">42</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="673.6377" y="115.9775">43</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="689.6377" y="115.9775">44</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="705.6377" y="115.9775">45</text></g></svg></div>

<h3 id="trigger">計算排程的時間與觸發的時間差來忽略錯過的 trigger</h3>
<p>在 <code>Job.execute</code> 開始前，檢查 job 觸發的時間與排程的時間差，如果超過一定時間，則忽略這次的 trigger。範例中是時間差超過 1000 毫秒 (1 秒) 就忽略這次的 trigger。</p>
<div class="highlight"><span class="filename">HelloWorldJob.java</span><pre><span></span><code><span class="nd">@DisallowConcurrentExecution</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloWorldJob</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">JobExecutionContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getFireTime</span><span class="p">().</span><span class="na">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getScheduledFireTime</span><span class="p">().</span><span class="na">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="c1">// skip this trigger</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>如此，trigger 的 job 都會落在排程設定的時間點上。變更後的 Job 執行時間軸參考下圖:</p>
<div class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="194px" preserveAspectRatio="true" style="background: #ffffff" version="1.1" viewBox="0 0 882 194" width="882px" zoomAndPan="magnify"><defs/><g><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="0" x2="0" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="16" x2="16" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="32" x2="32" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="48" x2="48" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="64" x2="64" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="80" x2="80" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="96" x2="96" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="112" x2="112" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="128" x2="128" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="144" x2="144" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="160" x2="160" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="176" x2="176" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="192" x2="192" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="208" x2="208" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="224" x2="224" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="240" x2="240" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="256" x2="256" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="272" x2="272" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="288" x2="288" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="304" x2="304" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="320" x2="320" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="336" x2="336" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="352" x2="352" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="368" x2="368" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="384" x2="384" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="400" x2="400" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="416" x2="416" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="432" x2="432" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="448" x2="448" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="464" x2="464" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="480" x2="480" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="496" x2="496" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="512" x2="512" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="528" x2="528" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="544" x2="544" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="560" x2="560" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="576" x2="576" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="592" x2="592" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="608" x2="608" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="624" x2="624" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="640" x2="640" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="656" x2="656" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="672" x2="672" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="688" x2="688" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="704" x2="704" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="720" x2="720" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="736" x2="736" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="752" x2="752" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="768" x2="768" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="784" x2="784" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="800" x2="800" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="816" x2="816" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="832" x2="832" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="848" x2="848" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="864" x2="864" y1="6" y2="186.7344"/><line style="stroke:#C0C0C0;stroke-width:1.0;" x1="880" x2="880" y1="6" y2="186.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="0" x2="0" y1="16" y2="178.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="160" x2="160" y1="16" y2="178.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="320" x2="320" y1="16" y2="178.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="480" x2="480" y1="16" y2="178.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="640" x2="640" y1="16" y2="178.7344"/><line style="stroke:#000000;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="800" x2="800" y1="16" y2="178.7344"/><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="9.2822">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="9.2822">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="9.2822">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="9.2822">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="9.2822">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="9.2822">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="9.2822">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="9.2822">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="9.2822">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="9.2822">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="9.2822">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="9.2822">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="9.2822">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="9.2822">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="9.2822">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="9.2822">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="9.2822">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="9.2822">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="9.2822">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="9.2822">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="9.2822">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="9.2822">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="9.2822">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="9.2822">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="9.2822">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="9.2822">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="9.2822">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="9.2822">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="9.2822">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="9.2822">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="9.2822">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="9.2822">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="9.2822">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="9.2822">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="9.2822">35</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="561.6377" y="9.2822">36</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="577.6377" y="9.2822">37</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="593.6377" y="9.2822">38</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="609.6377" y="9.2822">39</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="625.6377" y="9.2822">40</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="641.6377" y="9.2822">41</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="657.6377" y="9.2822">42</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="673.6377" y="9.2822">43</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="689.6377" y="9.2822">44</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="705.6377" y="9.2822">45</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="721.6377" y="9.2822">46</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="737.6377" y="9.2822">47</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="753.6377" y="9.2822">48</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="769.6377" y="9.2822">49</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="785.6377" y="9.2822">50</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="801.6377" y="9.2822">51</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="817.6377" y="9.2822">52</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="833.6377" y="9.2822">53</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="849.6377" y="9.2822">54</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="865.6377" y="9.2822">55</text><polygon fill="#000000" points="8,18,13,23,8,28,3,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="168,18,173,23,168,28,163,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="328,18,333,23,328,28,323,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="488,18,493,23,488,28,483,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="648,18,653,23,648,28,643,23" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="808,18,813,23,808,28,803,23" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="2" y="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="34.8047" y2="34.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="238" y1="47.6094" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2" x2="2" y1="34.8047" y2="47.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="238" x2="238" y1="34.8047" y2="47.6094"/><path d="M240,66.4141 L240,97.3672 L321.3457,97.3672 L321.3457,76.4141 L311.3457,66.4141 L240,66.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M311.3457,66.4141 L311.3457,76.4141 L321.3457,76.4141 L311.3457,66.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="60.3457" x="246" y="79.7681">Trigger by T2</text><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="35.0771" x="246" y="90.2446">skipped</text><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="12" x="242" y="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="254" y1="51.6094" y2="51.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="254" y1="64.4141" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="242" x2="242" y1="51.6094" y2="64.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="254" x2="254" y1="51.6094" y2="64.4141"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="322" y="99.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="558" y1="99.3672" y2="99.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="558" y1="112.1719" y2="112.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="322" x2="322" y1="99.3672" y2="112.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="558" x2="558" y1="99.3672" y2="112.1719"/><path d="M560,130.9766 L560,161.9297 L641.3457,161.9297 L641.3457,140.9766 L631.3457,130.9766 L560,130.9766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M631.3457,130.9766 L631.3457,140.9766 L641.3457,140.9766 L631.3457,130.9766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="60.3457" x="566" y="144.3306">Trigger by T4</text><text fill="#000000" font-family="sans-serif" font-size="9" lengthAdjust="spacing" textLength="35.0771" x="566" y="154.8071">skipped</text><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="12" x="562" y="116.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="562" x2="574" y1="116.1719" y2="116.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="562" x2="574" y1="128.9766" y2="128.9766"/><line style="stroke:#181818;stroke-width:1.0;" x1="562" x2="562" y1="116.1719" y2="128.9766"/><line style="stroke:#181818;stroke-width:1.0;" x1="574" x2="574" y1="116.1719" y2="128.9766"/><rect fill="#E2E2F0" height="12.8047" style="stroke:none;stroke-width:1.0;" width="236" x="642" y="163.9297"/><line style="stroke:#181818;stroke-width:1.0;" x1="642" x2="878" y1="163.9297" y2="163.9297"/><line style="stroke:#181818;stroke-width:1.0;" x1="642" x2="878" y1="176.7344" y2="176.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="642" x2="642" y1="163.9297" y2="176.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="878" x2="878" y1="163.9297" y2="176.7344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="16" y="28.2104">T1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="176" y="28.2104">T2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="336" y="28.2104">T3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="496" y="28.2104">T4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="656" y="28.2104">T5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7178" x="816" y="28.2104">T6</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="6" y="45.0151">Job 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="258" y="61.8198">Job 2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="326" y="109.5776">Job 3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="578" y="126.3823">Job 4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27.4517" x="646" y="174.1401">Job 5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="4.8188" y="191.0166">1</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="20.8188" y="191.0166">2</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="36.8188" y="191.0166">3</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="52.8188" y="191.0166">4</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="68.8188" y="191.0166">5</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="84.8188" y="191.0166">6</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="100.8188" y="191.0166">7</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="116.8188" y="191.0166">8</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6.3623" x="132.8188" y="191.0166">9</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="145.6377" y="191.0166">10</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="161.6377" y="191.0166">11</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="177.6377" y="191.0166">12</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="193.6377" y="191.0166">13</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="209.6377" y="191.0166">14</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="225.6377" y="191.0166">15</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="241.6377" y="191.0166">16</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="257.6377" y="191.0166">17</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="273.6377" y="191.0166">18</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="289.6377" y="191.0166">19</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="305.6377" y="191.0166">20</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="321.6377" y="191.0166">21</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="337.6377" y="191.0166">22</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="353.6377" y="191.0166">23</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="369.6377" y="191.0166">24</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="385.6377" y="191.0166">25</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="401.6377" y="191.0166">26</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="417.6377" y="191.0166">27</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="433.6377" y="191.0166">28</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="449.6377" y="191.0166">29</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="465.6377" y="191.0166">30</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="481.6377" y="191.0166">31</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="497.6377" y="191.0166">32</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="513.6377" y="191.0166">33</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="529.6377" y="191.0166">34</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="545.6377" y="191.0166">35</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="561.6377" y="191.0166">36</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="577.6377" y="191.0166">37</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="593.6377" y="191.0166">38</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="609.6377" y="191.0166">39</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="625.6377" y="191.0166">40</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="641.6377" y="191.0166">41</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="657.6377" y="191.0166">42</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="673.6377" y="191.0166">43</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="689.6377" y="191.0166">44</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="705.6377" y="191.0166">45</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="721.6377" y="191.0166">46</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="737.6377" y="191.0166">47</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="753.6377" y="191.0166">48</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="769.6377" y="191.0166">49</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="785.6377" y="191.0166">50</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="801.6377" y="191.0166">51</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="817.6377" y="191.0166">52</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="833.6377" y="191.0166">53</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="849.6377" y="191.0166">54</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="12.7246" x="865.6377" y="191.0166">55</text></g></svg></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>目前沒有發現官方對於此方案的解法。這裡的解法有土法煉鋼的感覺。</p>
</div>
<h2 id="job_1">探討: Job 執行過程發生錯誤的行為</h2>
<p>在 Job 執行過程中，如果拋出例外，Job 即中斷執行。如果拋出的例外是 <code>JobExecutionException</code> 並設定 <code>refireImmediately</code> 為 <code>true</code>，則 Job 會立即重新執行，並且下一次 <code>JobExecutionContext.getRefireCount()</code> 數字累加。
以下程式碼展示當 Job 失敗拋出例外時， retry 3 次。</p>
<div class="highlight"><span class="filename">HelloWorldJob.java</span><pre><span></span><code><span class="nd">@DisallowConcurrentExecution</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloWorldJob</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">JobExecutionContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getRefireCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JobExecutionException</span><span class="p">(</span><span class="s">&quot;Too many re-fires&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span>
<span class="w">        </span><span class="c1">// ...</span>

<span class="hll"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JobExecutionException</span><span class="p">(</span><span class="s">&quot;Something goes wrong&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_2">參考</h2>
<ul>
<li><a href="https://docs.spring.io/spring-boot/reference/io/quartz.html">Sprint Boot Quartz Scheduler</a></li>
<li><a href="https://www.quartz-scheduler.org/documentation/quartz-2.2.2/configuration/ConfigJDBCJobStoreClustering.html">Quartz Configuration - Configure Clustering with JDBC-JobStore</a> </li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最後更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年7月2日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="建立日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年7月1日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到頂端
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Teddy Lee
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.select", "content.code.annotate", "content.code.copy", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>