
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>3. Creating a Set of Cooperating Microservices - Teddy 的筆記本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/style.css">
    
      <link rel="stylesheet" href="../../assets/mkdocs_puml/puml.css">
    
      <link rel="stylesheet" href="../../termynal.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-creating-a-set-of-cooperating-microservices" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Teddy 的筆記本" class="md-header__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teddy 的筆記本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creating a Set of Cooperating Microservices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teddy 的筆記本" class="md-nav__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Teddy 的筆記本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    JetBrains
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            JetBrains
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/shortcuts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    快捷鍵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/postfix-completion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Postfix Completion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vim
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Vim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/zsh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    zsh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/vscode.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/ideavim.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IdeaVim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/neovim.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    neovim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/advanced.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    進階
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/terminal.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminal
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Terraform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/backend.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/import_infrastructure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Import Infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/intro_to_terraform.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro to Terraform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/state.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/style_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/terraform/workspaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workspaces
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/apply.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apply
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pod-topology-spread-constraints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pod Topology Spread Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Domain-Driven Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Domain-Driven Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/01-crunching-knowledge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 Crunching Knowledge
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/02-communication-and-the-use-of-language.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Communication and the Use of Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/03-binding-model-and-implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 Binding Model and Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/04-isolating-the-domain.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 Isolating the Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/05-a-model-expressed-in-software.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 A Model Expressed in Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/06-the-life-cycle-of-a-domain-object.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 The Life Cycle of a Domain Object
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/07-using-the-language-an-extended-example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 Using the Language - An Extended Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/08-breakthrough.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8 Breakthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/09-making-implicit-concepts-explicit.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9 Making Implicit Concepts Explicit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/10-supple-design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10 Supple Design
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Clean Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Clean Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clean-architecture/34.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    34 The Missing Chapter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Effective Java, 3rd
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Effective Java, 3rd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Creating And Destroying Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            Creating And Destroying Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/001.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 1 - Consider static factory methods instead of constructors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/002.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 2 - Consider a builder when faced with many constructor parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/003.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 3 - Enforce the singleton property with a private constructor or an enum type
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/004.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 4 - Enforce noninstantiability with a private constructor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/005.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 5 - Prefer dependency injection to hardwiring resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/006.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 6 - Avoid creating unnecessary objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/007.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 7 - Eliminate obsolete object references
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/008.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 8 - Avoid finalizers and cleaners
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/009.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 9 - Prefer try-with-resources to try-finally
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Methods Common To All Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Methods Common To All Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/010.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 10 - Obey the general contract when overriding equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/011.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 11 - Always override hashCode when you override equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/012.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 12 = Always override toString
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/013.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 13 - Override clone judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/014.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 14 - Consider implementing Comparable
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Classes and Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Classes and Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/015.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 15 - Minimize the accessibility of classes and members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/016.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 16 - In public classes, use accessor methods, not public fields
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/055.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Item 55 - Return optionals judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pyenv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pyenv
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Spring Boot
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spring Boot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Scheduler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Scheduler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1_1" id="__nav_7_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quartz
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_1">
            <span class="md-nav__icon md-icon"></span>
            Quartz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/hello_world.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/jdbc_job_store.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JDBC JobStore
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/testing/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Microservices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Microservices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/microservices-with-spring-boot-3-and-spring-cloud/03-creating-a-set-of-cooperating-microservices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03 Creating a Set of Cooperating Microservices
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-toggles/main.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Toggles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kata
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Kata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Microservices with Spring Boot 3 and Spring Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="3-creating-a-set-of-cooperating-microservices">3. Creating a Set of Cooperating Microservices</h1>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="165px" preserveAspectRatio="xMidYMid meet" style="width:430px;height:165px;background:#FFFFFF;" version="1.1" viewBox="0 0 430 165" width="430px" zoomAndPan="magnify" class="diagram"><defs/><g><g class="entity" data-entity="pc" data-source-line="2" data-uid="ent0002" id="entity_pc"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172.877" x="94.42" y="7"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="247.297" y="12"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="14"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.877" x="109.42" y="39.9951">Product Composite</text></g><g class="entity" data-entity="p" data-source-line="3" data-uid="ent0003" id="entity_p"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93.71" x="7" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="80.71" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="22" y="146.2851">Product</text></g><g class="entity" data-entity="r" data-source-line="4" data-uid="ent0004" id="entity_r"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.5791" x="135.57" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="206.1491" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="150.57" y="146.2851">Review</text></g><g class="entity" data-entity="rd" data-source-line="5" data-uid="ent0005" id="entity_rd"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163.6484" x="261.03" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="404.6784" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="276.03" y="146.2851">Recommendation</text></g><g class="link" data-entity-1="pc" data-entity-2="p" data-source-line="7" data-uid="lnk6" id="link_pc_p"><path d="M153.3,53.78 C132,71.27 107.2872,91.5626 85.9972,109.0426" fill="none" id="pc-to-p" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="81.36,112.85,90.8541,110.2304,85.2244,109.6772,85.7776,104.0475,81.36,112.85" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="pc" data-entity-2="r" data-source-line="8" data-uid="lnk7" id="link_pc_r"><path d="M180.85,53.78 C180.85,71.27 180.85,89.37 180.85,106.85" fill="none" id="pc-to-r" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="180.85,112.85,184.85,103.85,180.85,107.85,176.85,103.85,180.85,112.85" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="pc" data-entity-2="rd" data-source-line="9" data-uid="lnk8" id="link_pc_rd"><path d="M216.01,53.78 C243.18,71.27 275.5752,92.122 302.7252,109.602" fill="none" id="pc-to-rd" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="307.77,112.85,302.3681,104.6147,303.566,110.1433,298.0374,111.3412,307.77,112.85" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 2d26cd2b-d3d7-4211-b7be-2584f6588fcb</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<table>
<thead>
<tr>
<th style="text-align: left;">Service</th>
<th style="text-align: left;">Port</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Product Composite</td>
<td style="text-align: left;">6000</td>
</tr>
<tr>
<td style="text-align: left;">Product</td>
<td style="text-align: left;">6001</td>
</tr>
<tr>
<td style="text-align: left;">Recommendation</td>
<td style="text-align: left;">6002</td>
</tr>
<tr>
<td style="text-align: left;">Review</td>
<td style="text-align: left;">6003</td>
</tr>
</tbody>
</table>
<blockquote>
<p>書本使用 7000 ~ 7003，但因為 macos 上，7000 被 airplay 使用，所以改用 6000 ~ 6003</p>
</blockquote>
<h2 id="microservice">建立 microservice 專案</h2>
<p>新增四個 Spring Boot 專案，目錄結構如下:</p>
<div class="highlight"><pre><span></span><code>/
├── product-composite-service
├── product-service
├── recommendation-service
└── review-service
</code></pre></div>
<ul>
<li>專案相依 <code>actuator</code>, <code>webflux</code></li>
<li>
<p>使用 gradle 編譯專案</p>
<details class="tip">
<summary>使用 <code>./gradlew build</code> 編譯</summary>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>product-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>recommendation-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>review-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>product-composite<span class="w"> </span>service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span>
</code></pre></div>
</details>
</li>
</ul>
<h2 id="_1">單一指令編譯專案</h2>
<p>調整專案結構，使可以用單一指令 <code>./gradlew build</code> 編譯所有專案。</p>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: c2bf21df-f07a-4a98-bf07-ac71ba2a1b17</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 1438703a-8c05-491d-add3-3d96c531bfea</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<p>在最外層新增 settings.gradle.kts:</p>
<div class="highlight"><pre><span></span><code><span class="n">include</span><span class="p">(</span><span class="s">&quot;:product-service&quot;</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="s">&quot;:review-service&quot;</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="s">&quot;:recommendation-service&quot;</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="s">&quot;:product-composite-service&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="adding-restful-apis">Adding RESTful APIs</h2>
<h3 id="product-api">Product API</h3>
<p>將 product-service 的 port 設定成 <code>6001</code>。</p>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 00d0e51f-640b-474a-8591-0d1dbdd2927f</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 8ba0eedc-c3e1-4148-b4df-bcfc5fc66ddd</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<div class="admonition note">
<p class="admonition-title">書中作者將 Controller 視作 Service，因此命名成 <code>ProductService</code>。</p>
</div>
<table>
<thead>
<tr>
<th style="text-align: left;">Case</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">/products/1</td>
<td style="text-align: left;">200, productId = 1</td>
</tr>
<tr>
<td style="text-align: left;">/products/13</td>
<td style="text-align: left;">404, product not found</td>
</tr>
<tr>
<td style="text-align: left;">/prodcuts/-1</td>
<td style="text-align: left;">422 (UNPROCESSABLE_ENTITY), invalid productId</td>
</tr>
<tr>
<td style="text-align: left;">/products/not-integer</td>
<td style="text-align: left;">400, type mismatch</td>
</tr>
</tbody>
</table>
<h4 id="test-get-product">Test: Get product</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="w"> </span><span class="n">WebTestClient</span>

<span class="hll"><span class="w">    </span><span class="nd">@Test</span>
</span><span class="hll"><span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getProductById</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">().</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<ul>
<li>設定 <code>@SpringBootTest</code> 參數 <code>webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT</code>。</li>
<li>Autowire <code>WebTestClient</code>。</li>
<li>目前沒有 persistence layer，用假資料即可。</li>
<li>
<p>實作 <code>ServiceUtil</code> 封裝 <code>serviceAddress</code> 的細節。</p>
<ul>
<li>
<p>格式為 <code>${hostName}/${ipAddress}:${port}</code></p>
<details class="tip">
<summary>使用 <code>InetAddress</code> 取得 <code>hostName</code> 與 <code>ipAddress</code></summary>
<p>取得 host name: <code>InetAddress.getLocalHost().getHostName()</code><br />
取得 host IP: <code>InetAddress.getLocalHost().getHostAddress()</code></p>
</details>
</li>
</ul>
</li>
</ul>
<h4 id="test-get-product-not-found">Test: Get product not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductNotFound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;No product found for productId: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>宣告 <code>NotFoundException</code>，在 product 找不到時拋出。</li>
<li>
<p>使用 <code>@RestControllerAdvice</code> 處理例外狀況</p>
<details class="tip">
<summary>使用 <code>@RestControllerAdvice</code> 處理 product not found 的 response</summary>
<div class="highlight"><pre><span></span><code><span class="nd">@RestControllerAdvice</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">GlobalControllerExceptionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">NotFoundException</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ResponseBody</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleNotFoundException</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ServerHttpRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">NotFoundException</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">.</span><span class="na">pathWithinApplication</span><span class="p">().</span><span class="na">value</span><span class="p">(),</span>
<span class="w">            </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">,</span>
<span class="w">            </span><span class="n">requireNotNull</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">HttpErrorInfo</span><span class="p">(</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">:</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpStatus</span><span class="p">:</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>例外狀況回傳 <code>HttpErrorInfo</code></p>
<p><div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 0f920312-7b3a-451a-9f45-76f861db920d</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: adb5b203-bb72-4a0c-863b-8801d9a6d230</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div></p>
</li>
</ul>
<h4 id="test-get-product-negative-product-id">Test: Get product negative product id</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterNegativeValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span><span class="w"> </span><span class="c1">// 422</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>宣告 <code>InvalidInputException</code>，在 <code>productId</code> 為負數時拋出。</li>
<li>處理例外拋出時回傳的資料。</li>
</ul>
<h4 id="test-get-product-invalid-parameter-productid-type-mismatch">Test: Get product invalid parameter productId type mismatch</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>資料型態不吻合會被 Spring 擋下，預設錯誤訊息沒有 <code>message</code> 欄位，通過設定可以加入。<ul>
<li><code>server.error.include-message=always</code></li>
</ul>
</li>
</ul>
<h3 id="recommendation-api">Recommendation API</h3>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: f2d29975-ae89-467d-8be3-fd4974a9b812</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 2691cb42-c321-4086-8c65-c39a9181e9b1</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<table>
<thead>
<tr>
<th style="text-align: left;">Case</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">/recommendations?productId=1</td>
<td style="text-align: left;">200, len=3, [0].productId = 1</td>
</tr>
<tr>
<td style="text-align: left;">/recommendations?productId=113</td>
<td style="text-align: left;">200, len=0</td>
</tr>
<tr>
<td style="text-align: left;">/recommendations?productId=-1</td>
<td style="text-align: left;">422, Invalid productId = -1</td>
</tr>
<tr>
<td style="text-align: left;">/recommendations</td>
<td style="text-align: left;">400, Required query parameter 'productId' is not present.</td>
</tr>
<tr>
<td style="text-align: left;">/recommendations?productId=not-integer</td>
<td style="text-align: left;">400, Type mismatch.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title"><code>?productId=</code> 使用 <code>@RequestParam</code></p>
</div>
<ul>
<li>
<p>重構:</p>
<ol>
<li>
<p>將 <code>serviceAddress</code> 的組合程式碼抽出成 component</p>
<details class="tip">
<summary>video</summary>
<p><video controls><br />
    <source src="3_001.mp4" type="video/mp4"><br />
    你的瀏覽器不支援此影片格式。<br />
</video></p>
</details>
</li>
<li>
<p>將 <code>ServiceAddress</code> 移動到 <code>util</code> 共用 module</p>
<details class="tip">
<summary>video</summary>
<p><video controls><br />
    <source src="3_002.mp4" type="video/mp4"><br />
</video></p>
</details>
</li>
<li>
<p>將 Exceptions, Exception Handler 移動到 <code>util</code> 共用</p>
<details class="tip">
<summary>video</summary>
<p><video controls><br />
    <source src="3_003.mp4" type="video/mp4"><br />
</video></p>
</details>
</li>
</ol>
</li>
</ul>
<h3 id="review-api">Review API</h3>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 39b257a2-76c7-41e7-ac8d-3e72521fa85b</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 1068abb8-9d7c-47a1-b45d-174fc64cbfcb</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<table>
<thead>
<tr>
<th style="text-align: left;">Case</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">/reviews?productId=1</td>
<td style="text-align: left;">200, len = 3, [0].productId = 1</td>
</tr>
<tr>
<td style="text-align: left;">/reviews?productId=213</td>
<td style="text-align: left;">200, len = 0</td>
</tr>
<tr>
<td style="text-align: left;">/reviews?productId=-1</td>
<td style="text-align: left;">422, Invalid productId = -1</td>
</tr>
<tr>
<td style="text-align: left;">/reviews</td>
<td style="text-align: left;">400, Required query parameter 'productId' is not present.</td>
</tr>
<tr>
<td style="text-align: left;">/reviews?productId=not-integer</td>
<td style="text-align: left;">400, Type mismatch</td>
</tr>
</tbody>
</table>
<h3 id="refactor-service-interface">Refactor: 抽 Service interface</h3>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: f07e67ef-c046-460f-85f1-a3c9bf475838</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 367c5dc4-1571-4d4a-b577-7bb82203c017</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<ul>
<li>將 <code>ProductService</code>, <code>RecommendationService</code>, <code>ReviewService</code> 抽成 interface 放到 <code>api</code> 下。<ul>
<li>先重新命名既有的 class，加上後墜 <code>Impl</code>。(使用 <span class="keys"><kbd class="key-shift">Shift</kbd><span>+</span><kbd class="key-f6">F6</kbd></span> 或 vim <span class="keys"><kbd>\rn</kbd></span> )</li>
<li>抽 interface (使用 <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-t">T</kbd></span> &gt; Extract Interface...)</li>
</ul>
</li>
<li>將 <code>Product</code>, <code>Recomendation</code>, <code>Review</code> 移動到 <code>api</code> 下。<ul>
<li>使用 <span class="keys"><kbd class="key-f6">F6</kbd></span></li>
</ul>
</li>
</ul>
<h3 id="product-composite-api">Product Composite API</h3>
<div class='puml-container'><div class="puml light" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 011d171b-1492-4ac0-9751-dc932a43c7e5</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div><div class="puml dark" style="">520. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            color: #5ca731;
            text-align: left;
            margin-left: 20px;
        }
        .error-info {
            text-align: left;
            margin-left: 20px;
        }
        .error-info p:first-child {
            margin-bottom: 75px;
        }
        footer {
            position: absolute;
            bottom: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Origin Unreachable</h1>
    <div class="error-info">
        <p>Sorry, we are unable to reach the origin server at the moment. Please try again later.</p>
        <p><strong>Error ID</strong>: 09846b01-0440-4373-b971-c926ee201b1b</p>
        <p><strong>Timestamp</strong>: 2025-06-10 11:09:04</p>
        
    </div>
    <footer>Powered by Ezoic</footer>
</body>
</html>
</div></div>

<table>
<thead>
<tr>
<th style="text-align: left;">Case</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">/product-composite/1</td>
<td style="text-align: left;">200, productId = 1, len(recommendations) = 3, len(reviews) = 3</td>
</tr>
<tr>
<td style="text-align: left;">/product-composite/13</td>
<td style="text-align: left;">404, Not found productId = 13.</td>
</tr>
<tr>
<td style="text-align: left;">/product-composite/-1</td>
<td style="text-align: left;">422, Invalid productId = -1</td>
</tr>
</tbody>
</table>
<ul>
<li>Spring 建議的 Mock Server<ul>
<li><a href="https://docs.spring.io/spring-cloud-contract/docs/current/reference/html/project-features.html#features-wiremock">WireMockk</a><ul>
<li><a href="https://wiremock.org/docs/spring-boot/">https://wiremock.org/docs/spring-boot/</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/reference/web/webflux-webclient/client-testing.html">MockWebServer</a></li>
</ul>
</li>
</ul>
<p>重構:</p>
<ul>
<li>抽 <code>ProductService</code><ul>
<li><code>@RestController</code></li>
<li>HTTP interface</li>
</ul>
</li>
</ul>
<h4 id="test-get-product_1">Test: Get product</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@EnableWireMock</span><span class="p">(</span><span class="n">ConfigureWireMock</span><span class="p">(</span><span class="n">portProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;app.product-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.recommendation-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.review-service.port&quot;</span><span class="o">]</span><span class="p">))</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductCompositeServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">`get product by product id`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span><span class="n">okJson</span><span class="p">(</span><span class="s">&quot;&quot;&quot; { &quot;productId&quot;: 1, &quot;name&quot;: &quot;product 1&quot;, &quot;weight&quot;: 123, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7001&quot; } &quot;&quot;&quot;</span><span class="p">)))</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;recommendationId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 1, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 2, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 3, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; }</span>
<span class="s">                    ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/review?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;reviewId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-1&quot;, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-2&quot;, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-3&quot;, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; }</span>
<span class="s">                        ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/1&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.recommendations.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.reviews.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>使用 <code>RestTemplate</code> 串接 API</p>
<details class="tip">
<summary>使用 <code>RestTemplate</code> 配合 <code>ParameterizedTypeReference</code> 接收 List 處理 generic type 的問題</summary>
<div class="highlight"><span class="filename">Example</span><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getRecommendations</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span>
<span class="w">        </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;http://</span><span class="si">$</span><span class="n">recommendationServiceHost</span><span class="s">:</span><span class="si">$</span><span class="n">recommendationServicePort</span><span class="s">/recommendation?productId=</span><span class="si">$</span><span class="n">productId</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">).</span><span class="na">body</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>逐步實作，分三個 subtask: <code>$.productId</code>, <code>$.recommendations.length()</code>, <code>$.reviews.length()</code>，一次做一個，還沒有做的 assertion 先註解起來。</p>
</li>
<li>定義 properties: microservices 的 host 與 port</li>
<li>Spring 建議的 Mock Server<ul>
<li><a href="https://docs.spring.io/spring-cloud-contract/docs/current/reference/html/project-features.html#features-wiremock">WireMockk</a> 這裡的測試使用這個</li>
<li><a href="https://docs.spring.io/spring-framework/reference/web/webflux-webclient/client-testing.html">MockWebServer</a></li>
</ul>
</li>
</ul>
<h4 id="test-get-product-not-found_1">Test: Get product not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/13&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Product with productId=13 not found&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Not found: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-get-product-invalid-parameter">Test: Get product invalid parameter</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product invalid parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/-1&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Invalid productId: -1&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="disable-gradle-build-to-generate-plain-jar-file">Disable gradle build to generate plain jar file</h2>
<p>預設 <code>gradle build</code> 會產生兩個 jar 檔案:</p>
<ol>
<li>ordinary JAR file</li>
<li>plain JAR file containing only the class files resulting from compiling the Java files in the Spring Boot application</li>
</ol>
<p>我們不需要第 2 個 jar 檔。設定 <code>build.gradle.kts</code> 讓 <code>gradle build</code> 僅產生第一個 jar 檔案。</p>
<details class="tip">
<summary>Tip</summary>
<p>在跟目錄新增檔案，加入以下設定。</p>
<div class="highlight"><span class="filename">build.gradle.kts</span><pre><span></span><code>subprojects {
    afterEvaluate {
        if (plugins.hasPlugin(&quot;org.springframework.boot&quot;)) {
            tasks.getByName(&quot;jar&quot;) {
                enabled = false
            }
        }
    }
}
</code></pre></div>
</details>
<h2 id="_2">手動測試</h2>
<ul>
<li>
<p>啟動 microservices</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>jar<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*-service-*.jar&quot;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>java<span class="w"> </span>-jar<span class="w"> </span><span class="nv">$jar</span><span class="w"> </span><span class="p">&amp;</span>
<span class="k">done</span>
</code></pre></div>
</li>
<li>
<p>測試 product-service, recommendation-service, review-service, product-composite-service 的 API。</p>
</li>
<li>
<p>停掉所有 microservices</p>
<div class="highlight"><pre><span></span><code>pkill<span class="w"> </span>-P<span class="w"> </span><span class="nv">$$</span>
</code></pre></div>
</li>
</ul>
<h2 id="_3">半自動化測試</h2>
<h3 id="curl-request-response-http-code">透過 <code>curl</code> 得到 request 的 response 與 http code</h3>
<ul>
<li>執行 <code>http://localhost:6000/product-composite/1</code> 將 response 與 http code 存到變數</li>
</ul>
<details class="tip">
<summary>Tip</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span><span class="w"> </span>curl<span class="w"> </span>http://localhost:6000/product-composite/1<span class="w"> </span>-s<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}&quot;</span><span class="k">)</span>
<span class="nv">http_code</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">:(-3)</span><span class="si">}</span>
<span class="nv">response</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">%???</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$response</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$http_code</span><span class="s2">&quot;</span>
</code></pre></div>
<ul>
<li><code>-w "%{http_code}"</code> 在結果後輸出 http code</li>
<li><code>http_code=${result:(-3)}</code> 擷取 result 的後三碼 http code</li>
<li><code>response=${result%???}</code> 移除 result 結尾三碼</li>
</ul>
</details>
<h3 id="assertcurl-http-code">撰寫 <code>assertCurl</code> 驗證 http code 符合預期</h3>
<ul>
<li><code>assertCurl ${expectedCode} ${curl}</code></li>
<li>符合預期，顯示 "Test OK"</li>
<li>不符合預期，顯示 "Test FAILED"，並提供以下訊息供 debug<ul>
<li>預期的 code 與實際的 code，</li>
<li>curl 指令</li>
<li>response body</li>
</ul>
</li>
<li>
<p>function</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span>name<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">$1</span><span class="w"> </span><span class="c1"># first argument</span>
<span class="w">    </span><span class="nv">$2</span><span class="w"> </span><span class="c1"># second argument</span>
<span class="o">}</span>
</code></pre></div>
</li>
<li>
<p>if-else statement</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>condition<span class="w"> </span><span class="o">]</span>
<span class="k">then</span>
<span class="w">    </span>statement
<span class="k">else</span>
<span class="w">    </span>statement
<span class="k">fi</span>
</code></pre></div>
<ul>
<li>Equal evaluation: <code>=</code></li>
</ul>
</li>
</ul>
<details class="tip">
<summary>Tip</summary>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span>assertCurl<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">expected_code</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span>-s<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="nv">http_code</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">:(-3)</span><span class="si">}</span>
<span class="w">    </span><span class="nv">response</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">%???</span><span class="si">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$http_code</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$expected_code</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test OK&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test FAILED, expected code: </span><span class="nv">$expected_code</span><span class="s2">, got: </span><span class="nv">$http_code</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;- Failing command: </span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;- Response: </span><span class="nv">$response</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

assertCurl<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="s2">&quot;curl http://localhost:6000/product-composite/1&quot;</span>
</code></pre></div>
</details>
<h3 id="assertequal">撰寫 <code>assertEqual</code> 驗證兩個值是否相等</h3>
<ul>
<li>驗證 <code>productId</code> 為 <code>1</code><ul>
<li><code>$(echo "$response" | jq ".productId")</code> 從 response 擷取 <code>productId</code> 值</li>
</ul>
</li>
<li>驗證 <code>recommendations</code> 長度為 <code>3</code><ul>
<li><code>$(echo "$response" | jq ".recommendations | length")</code></li>
</ul>
</li>
<li>驗證 <code>reviews</code> 長度為 <code>3</code></li>
</ul>
<h3 id="test-product-not-found">Test: product not found</h3>
<ul>
<li><code>productId</code> 為 <code>13</code> 時，not found</li>
<li>status code: <code>404</code></li>
<li>assert message:<ul>
<li><code>jq -r ".."</code>: 用 <code>-r</code> 可以避免輸出字串的前後有雙引號</li>
</ul>
</li>
</ul>
<h3 id="test-product-no-recommendation">Test: product no recommendation</h3>
<ul>
<li><code>productId</code> 為 <code>113</code></li>
<li>status code: <code>200</code></li>
<li>assert recommendations 長度 <code>0</code>, reviews 長度 <code>3</code></li>
</ul>
<h3 id="test-product-no-reviews">Test: product no reviews</h3>
<ul>
<li><code>productId</code> 為 <code>213</code></li>
<li>status code: <code>200</code></li>
<li>assert recommendation 長度 <code>3</code>, reviews 長度 <code>0</code></li>
</ul>
<h3 id="test-product-id-is-negative">Test: product id is negative</h3>
<ul>
<li><code>prodictId</code> 為 <code>-1</code></li>
<li>status code: <code>422</code></li>
<li>assert message</li>
</ul>
<h3 id="test-product-is-in-not-integer">Test: product is in not integer</h3>
<ul>
<li><code>productId</code> 為 <code>no-integer</code></li>
<li>status code: <code>400</code></li>
<li>assert message</li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最後更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年4月20日 18:43:41 UTC">2025年4月20日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="建立日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年1月31日 10:35:43 UTC">2025年1月31日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到頂端
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2025 Teddy Lee
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.select", "content.code.annotate", "content.code.copy", "toc.integrate", "navigation.top", "content.footnote.tooltips", "content.tooltips"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../assets/mkdocs_puml/puml.js"></script>
      
        <script src="../../termynal.js"></script>
      
    
  </body>
</html>