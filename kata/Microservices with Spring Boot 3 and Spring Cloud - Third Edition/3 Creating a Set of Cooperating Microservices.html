
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.1">
    
    
      
        <title>3. Creating a Set of Cooperating Microservices - Teddy 的筆記本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/style.css">
    
      <link rel="stylesheet" href="../../assets/mkdocs_puml/puml.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-creating-a-set-of-cooperating-microservices" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Teddy 的筆記本" class="md-header__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teddy 的筆記本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creating a Set of Cooperating Microservices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teddy 的筆記本" class="md-nav__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Teddy 的筆記本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JetBrains
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            JetBrains
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/shortcuts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快捷鍵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/postfix-completion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postfix Completion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vim
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Vim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/zsh.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zsh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/vscode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/ideavim.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IdeaVim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/advanced.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    進階
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/apply.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apply
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pod-topology-spread-constraints.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod Topology Spread Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Domain-Driven Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Domain-Driven Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/01-crunching-knowledge.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Crunching Knowledge
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/02-communication-and-the-use-of-language.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Communication and the Use of Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/03-binding-model-and-implementation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Binding Model and Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/04-isolating-the-domain.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Isolating the Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/05-a-model-expressed-in-software.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 A Model Expressed in Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/06-the-life-cycle-of-a-domain-object.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 The Life Cycle of a Domain Object
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/07-using-the-language-an-extended-example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Using the Language - An Extended Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/08-breakthrough.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Breakthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/09-making-implicit-concepts-explicit.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 Making Implicit Concepts Explicit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/10-supple-design.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Supple Design
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clean Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Clean Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clean-architecture/34.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34 The Missing Chapter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Java, 3rd
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Effective Java, 3rd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Creating And Destroying Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            Creating And Destroying Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/001.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 1 - Consider static factory methods instead of constructors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/002.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 2 - Consider a builder when faced with many constructor parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/003.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 3 - Enforce the singleton property with a private constructor or an enum type
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/004.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 4 - Enforce noninstantiability with a private constructor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/005.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 5 - Prefer dependency injection to hardwiring resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/006.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 6 - Avoid creating unnecessary objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/007.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 7 - Eliminate obsolete object references
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/008.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 8 - Avoid finalizers and cleaners
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/009.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 9 - Prefer try-with-resources to try-finally
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methods Common To All Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Methods Common To All Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/010.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 10 - Obey the general contract when overriding equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/011.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 11 - Always override hashCode when you override equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/012.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 12 = Always override toString
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/013.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 13 - Override clone judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/014.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 14 - Consider implementing Comparable
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Classes and Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Classes and Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/015.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 15 - Minimize the accessibility of classes and members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/016.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 16 - In public classes, use accessor methods, not public fields
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/055.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 55 - Return optionals judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pyenv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pyenv
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/spring-boot-basic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spring Boot Basic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/set-up-microservices-project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    新增 Spring Boot microservices 專案
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/spring-webflux.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spring Webflux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scheduler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Scheduler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_1" >
        
          
          <label class="md-nav__link" for="__nav_7_4_1" id="__nav_7_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quartz
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_1">
            <span class="md-nav__icon md-icon"></span>
            Quartz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/hello_world.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/jdbc_job_store.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JDBC JobStore
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/testing/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-toggles/main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Toggles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kata
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Kata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices with Spring Boot 3 and Spring Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="3-creating-a-set-of-cooperating-microservices">3. Creating a Set of Cooperating Microservices</h1>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="165px" preserveAspectRatio="xMidYMid meet" style="width:430px;height:165px;background:#FFFFFF;" version="1.1" viewBox="0 0 430 165" width="430px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_pc"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172.877" x="94.42" y="7"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="247.297" y="12"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="14"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.877" x="109.42" y="39.9951">Product Composite</text></g><g id="elem_p"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93.71" x="7" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="80.71" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="22" y="146.2851">Product</text></g><g id="elem_r"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.5791" x="135.57" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="206.1491" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="150.57" y="146.2851">Review</text></g><g id="elem_rd"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163.6484" x="261.03" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="404.6784" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="276.03" y="146.2851">Recommendation</text></g><g id="link_pc_p"><path d="M153.3,53.78 C132,71.27 107.2872,91.5626 85.9972,109.0426 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-p" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="81.36,112.85,90.8541,110.2304,85.2244,109.6772,85.7776,104.0475,81.36,112.85" style="stroke:#181818;stroke-width:1;"/></g><g id="link_pc_r"><path d="M180.85,53.78 C180.85,71.27 180.85,89.37 180.85,106.85 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-r" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="180.85,112.85,184.85,103.85,180.85,107.85,176.85,103.85,180.85,112.85" style="stroke:#181818;stroke-width:1;"/></g><g id="link_pc_rd"><path d="M216.01,53.78 C243.18,71.27 275.5752,92.122 302.7252,109.602 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-rd" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="307.77,112.85,302.3681,104.6147,303.566,110.1433,298.0374,111.3412,307.77,112.85" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="165px" preserveAspectRatio="xMidYMid meet" style="width:430px;height:165px;background:#1B1B1B;" version="1.1" viewBox="0 0 430 165" width="430px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="165" style="stroke:#FFFFFF00;stroke-width:1;" width="430" x="0" y="0"/><g id="elem_pc"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="172.877" x="94.42" y="7"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="247.297" y="12"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="245.297" y="14"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="245.297" y="18"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.877" x="109.42" y="39.9951">Product Composite</text></g><g id="elem_p"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="93.71" x="7" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="80.71" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="78.71" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="78.71" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="22" y="146.2851">Product</text></g><g id="elem_r"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="90.5791" x="135.57" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="206.1491" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="204.1491" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="204.1491" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="150.57" y="146.2851">Review</text></g><g id="elem_rd"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="163.6484" x="261.03" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="404.6784" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="402.6784" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="402.6784" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="276.03" y="146.2851">Recommendation</text></g><g id="link_pc_p"><path d="M153.3,53.78 C132,71.27 107.2872,91.5626 85.9972,109.0426 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-p" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="81.36,112.85,90.8541,110.2304,85.2244,109.6772,85.7776,104.0475,81.36,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_pc_r"><path d="M180.85,53.78 C180.85,71.27 180.85,89.37 180.85,106.85 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-r" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="180.85,112.85,184.85,103.85,180.85,107.85,176.85,103.85,180.85,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_pc_rd"><path d="M216.01,53.78 C243.18,71.27 275.5752,92.122 302.7252,109.602 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-rd" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="307.77,112.85,302.3681,104.6147,303.566,110.1433,298.0374,111.3412,307.77,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<p>Ports:</p>
<ul>
<li>Product Composite: <code>7000</code></li>
<li>Product: <code>7001</code></li>
<li>Recommendation: <code>7002</code></li>
<li>Review: <code>7003</code></li>
</ul>
<h1 id="kata-1-using-spring-initializr-to-generate-skeleton-code">Kata 1: Using Spring Initializr to generate skeleton code</h1>
<div class="highlight"><pre><span></span><code>/
├── product-composite-service
├── product-service
├── recommendation-service
└── review-service
</code></pre></div>
<ul>
<li>使用 Spring Initializr 建立專案</li>
<li>專案相依: <code>actuator</code>, <code>webflux</code></li>
<li>
<p>使用 gradle 編譯專案</p>
<details class="tip">
<summary>Tip</summary>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>product-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>recommendation-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>review-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>product-composite<span class="w"> </span>service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span>
</code></pre></div>
</details>
</li>
</ul>
<h1 id="kata-2-setting-up-multi-project-builds-in-gradle">Kata 2: Setting up multi-project builds in Gradle</h1>
<p>調整專案結構，使可以用單一指令 <code>./gradlew build</code> 編譯所有專案。</p>
<h1 id="kata-3-adding-restful-apis">Kata 3: Adding RESTful APIs</h1>
<h2 id="kata-31-product-api">Kata 3.1: Product API</h2>
<p>將 product-service 的 port 設定成 <code>7001</code>。</p>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="290px" preserveAspectRatio="xMidYMid meet" style="width:725px;height:290px;background:#FFFFFF;" version="1.1" viewBox="0 0 725 290" width="725px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L517.5,28.2969 A2.5,2.5 0 0 1 520,30.7969 L520,280.58 A2.5,2.5 0 0 1 517.5,283.08 L8.5,283.08 A2.5,2.5 0 0 1 6,280.58 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M546.5,157.19 L671.2852,157.19 A3.75,3.75 0 0 1 673.7852,159.69 L680.7852,179.4869 L715.5,179.4869 A2.5,2.5 0 0 1 718,181.9869 L718,247.99 A2.5,2.5 0 0 1 715.5,250.49 L546.5,250.49 A2.5,2.5 0 0 1 544,247.99 L544,159.69 A2.5,2.5 0 0 1 546.5,157.19 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="544" x2="680.7852" y1="179.4869" y2="179.4869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="548" y="172.1851">product-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#F1F1F1" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><path d="M314.34,52.73 L314.34,61.2964 L273.6681,87.4453 L314.34,69.2964 L314.34,77.8628 A0,0 0 0 0 314.34,77.8628 L503.6608,77.8628 A0,0 0 0 0 503.6608,77.8628 L503.6608,62.73 L493.6608,52.73 L314.34,52.73 A0,0 0 0 0 314.34,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M493.6608,52.73 L493.6608,62.73 L503.6608,62.73 L493.6608,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3208" x="320.34" y="69.7969">GET /product/{productId}</text><g id="elem_Product"><rect codeLine="12" fill="#F1F1F1" height="107.4844" id="Product" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169.4043" x="66.3" y="159.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="124.1472" y="177.5951">Product</text><line style="stroke:#181818;stroke-width:0.5;" x1="67.3" x2="234.7043" y1="185.8969" y2="185.8969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="72.3" y="202.892">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="72.3" y="219.1889">name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="72.3" y="235.4857">weight: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="72.3" y="251.7826">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="67.3" x2="234.7043" y1="259.0844" y2="259.0844"/></g><g id="elem_ProductServiceImpl"><rect codeLine="23" fill="#F1F1F1" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.9941" x="560" y="192.19"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.9941" x="563" y="210.1851">ProductServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="561" x2="700.9941" y1="218.4869" y2="218.4869"/><line style="stroke:#181818;stroke-width:0.5;" x1="561" x2="700.9941" y1="226.4869" y2="226.4869"/></g><g id="link_ProductService_Product"><path codeLine="19" d="M151,99.84 C151,116.9 151,133.12 151,153.31 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="151,159.31,155,150.31,151,154.31,147,150.31,151,159.31" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="26" d="M297.6741,100.0116 C394.8041,119.3316 497.31,140.58 520,149.19 C549.02,160.2 579.5,178.05 601.16,191.97 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="280.02,96.5,296.5036,105.8963,298.8447,94.1268,280.02,96.5" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="290px" preserveAspectRatio="xMidYMid meet" style="width:725px;height:290px;background:#1B1B1B;" version="1.1" viewBox="0 0 725 290" width="725px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="290" style="stroke:#FFFFFF00;stroke-width:1;" width="725" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L517.5,28.2969 A2.5,2.5 0 0 1 520,30.7969 L520,280.58 A2.5,2.5 0 0 1 517.5,283.08 L8.5,283.08 A2.5,2.5 0 0 1 6,280.58 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M546.5,157.19 L671.2852,157.19 A3.75,3.75 0 0 1 673.7852,159.69 L680.7852,179.4869 L715.5,179.4869 A2.5,2.5 0 0 1 718,181.9869 L718,247.99 A2.5,2.5 0 0 1 715.5,250.49 L546.5,250.49 A2.5,2.5 0 0 1 544,247.99 L544,159.69 A2.5,2.5 0 0 1 546.5,157.19 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="544" x2="680.7852" y1="179.4869" y2="179.4869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="548" y="172.1851">product-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#313139" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><path d="M314.34,52.73 L314.34,61.2964 L273.6681,87.4453 L314.34,69.2964 L314.34,77.8628 A0,0 0 0 0 314.34,77.8628 L503.6608,77.8628 A0,0 0 0 0 503.6608,77.8628 L503.6608,62.73 L493.6608,52.73 L314.34,52.73 A0,0 0 0 0 314.34,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M493.6608,52.73 L493.6608,62.73 L503.6608,62.73 L493.6608,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3208" x="320.34" y="69.7969">GET /product/{productId}</text><g id="elem_Product"><rect codeLine="12" fill="#313139" height="107.4844" id="Product" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="169.4043" x="66.3" y="159.6"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="124.1472" y="177.5951">Product</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="67.3" x2="234.7043" y1="185.8969" y2="185.8969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="72.3" y="202.892">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="72.3" y="219.1889">name: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="72.3" y="235.4857">weight: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="72.3" y="251.7826">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="67.3" x2="234.7043" y1="259.0844" y2="259.0844"/></g><g id="elem_ProductServiceImpl"><rect codeLine="23" fill="#313139" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.9941" x="560" y="192.19"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.9941" x="563" y="210.1851">ProductServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="561" x2="700.9941" y1="218.4869" y2="218.4869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="561" x2="700.9941" y1="226.4869" y2="226.4869"/></g><g id="link_ProductService_Product"><path codeLine="19" d="M151,99.84 C151,116.9 151,133.12 151,153.31 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="151,159.31,155,150.31,151,154.31,147,150.31,151,159.31" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="26" d="M297.6741,100.0116 C394.8041,119.3316 497.31,140.58 520,149.19 C549.02,160.2 579.5,178.05 601.16,191.97 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="280.02,96.5,296.5036,105.8963,298.8447,94.1268,280.02,96.5" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h3 id="test-311-normal-case-for-product-1">Test 3.1.1: Normal case for product = 1</h3>
<p>在 <code>@SpringBootTest</code> 增加 <code>webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT</code> 參數，並新增以下測試，然後實作讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="w"> </span><span class="n">WebTestClient</span>

<span class="hll"><span class="w">    </span><span class="nd">@Test</span>
</span><span class="hll"><span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getProductById</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">().</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>使用 mock data，主要提供一個 normal case，在 product id = 1 的情況下，可以取得資料。</p>
<div class="admonition note">
<p class="admonition-title">書中 Controller 視為 Service，因此命名為 <code>ProductService</code> 且放在 <code>service</code> 套件下</p>
</div>
</li>
<li>
<p>實作 <code>ServiceUtil</code> 取得 host name 與 IP。</p>
<details class="tip">
<summary>使用 <code>InetAddress</code></summary>
<p>取得 host name: <code>InetAddress.getLocalHost().getHostName()</code><br />
取得 host IP: <code>InetAddress.getLocalHost().getHostAddress()</code></p>
</details>
</li>
</ul>
<h3 id="test-312-product-not-found-for-product-13">Test 3.1.2: Product not found for product = 13</h3>
<p>新增以下測試，並實作讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductNotFound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;No product found for productId: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>NotFoundException</code></li>
</ul>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="128px" preserveAspectRatio="xMidYMid meet" style="width:230px;height:128px;background:#FFFFFF;" version="1.1" viewBox="0 0 230 128" width="230px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_HttpErrorInfo"><rect codeLine="4" fill="#F1F1F1" height="107.4844" id="HttpErrorInfo" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="209.3672" x="7" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.5674" x="65.8999" y="24.9951">HttpErrorInfo</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="215.3672" y1="33.2969" y2="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.3672" x="13" y="50.292">timestamp: ZonedDateTime</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7764" x="13" y="66.5889">path: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.5205" x="13" y="82.8857">httpStatus: HttpStatus</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.8662" x="13" y="99.1826">message: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="215.3672" y1="106.4844" y2="106.4844"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="128px" preserveAspectRatio="xMidYMid meet" style="width:230px;height:128px;background:#1B1B1B;" version="1.1" viewBox="0 0 230 128" width="230px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="128" style="stroke:#FFFFFF00;stroke-width:1;" width="230" x="0" y="0"/><g id="elem_HttpErrorInfo"><rect codeLine="4" fill="#313139" height="107.4844" id="HttpErrorInfo" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="209.3672" x="7" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.5674" x="65.8999" y="24.9951">HttpErrorInfo</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="215.3672" y1="33.2969" y2="33.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.3672" x="13" y="50.292">timestamp: ZonedDateTime</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7764" x="13" y="66.5889">path: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.5205" x="13" y="82.8857">httpStatus: HttpStatus</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.8662" x="13" y="99.1826">message: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="215.3672" y1="106.4844" y2="106.4844"/></g></g></svg></div></div>

<details class="tip">
<summary>使用 <code>@RestControllerAdvice</code> 處理 product not found 的 response</summary>
<div class="highlight"><pre><span></span><code><span class="nd">@RestControllerAdvice</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">GlobalControllerExceptionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">NotFoundException</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ResponseBody</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleNotFoundException</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ServerHttpRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">NotFoundException</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">.</span><span class="na">pathWithinApplication</span><span class="p">().</span><span class="na">value</span><span class="p">(),</span>
<span class="w">            </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">,</span>
<span class="w">            </span><span class="n">requireNotNull</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">HttpErrorInfo</span><span class="p">(</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">:</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpStatus</span><span class="p">:</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h3 id="test-313-negative-product-id">Test 3.1.3: Negative product id</h3>
<p>新增以下測試，並實作讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterNegativeValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span><span class="w"> </span><span class="c1">// 422</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>InvalidInputException</code></li>
</ul>
<h3 id="test-314-product-id-type-mismatch">Test 3.1.4: Product Id type mismatch</h3>
<p>新增以下測試，並實作讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">server.error.include-message=always</p>
</div>
<h3 id="315">3.1.5: 手動測試</h3>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>http://localhost:7001/product/1
curl<span class="w"> </span>http://localhost:7001/product/13
curl<span class="w"> </span>http://localhost:7001/product/-1
curl<span class="w"> </span>http://localhost:7001/product/not-integer
</code></pre></div>
<h2 id="kata-32-review-api">Kata 3.2: Review API</h2>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="322px" preserveAspectRatio="xMidYMid meet" style="width:838px;height:322px;background:#FFFFFF;" version="1.1" viewBox="0 0 838 322" width="838px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L634.5,28.2969 A2.5,2.5 0 0 1 637,30.7969 L637,313.17 A2.5,2.5 0 0 1 634.5,315.67 L8.5,315.67 A2.5,2.5 0 0 1 6,313.17 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_review-service"><path d="M663.5,173.48 L779.5146,173.48 A3.75,3.75 0 0 1 782.0146,175.98 L789.0146,195.7769 L828.5,195.7769 A2.5,2.5 0 0 1 831,198.2769 L831,264.28 A2.5,2.5 0 0 1 828.5,266.78 L663.5,266.78 A2.5,2.5 0 0 1 661,264.28 L661,175.98 A2.5,2.5 0 0 1 663.5,173.48 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="661" x2="789.0146" y1="195.7769" y2="195.7769"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="665" y="188.4751">review-service</text></g><g id="elem_ReviewService"><rect codeLine="6" fill="#F1F1F1" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="306.2939" x="21.85" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="123.8368" y="58.9951">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="22.85" x2="327.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="22.85" x2="327.1439" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="27.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><path d="M362.95,52.73 L362.95,61.2964 L322.1439,87.4453 L362.95,69.2964 L362.95,77.8628 A0,0 0 0 0 362.95,77.8628 L621.0477,77.8628 A0,0 0 0 0 621.0477,77.8628 L621.0477,62.73 L611.0477,52.73 L362.95,52.73 A0,0 0 0 0 362.95,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M611.0477,52.73 L611.0477,62.73 L621.0477,62.73 L611.0477,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.0977" x="368.95" y="69.7969">GET /review?productId={productId}</text><g id="elem_Review"><rect codeLine="13" fill="#F1F1F1" height="140.0781" id="Review" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169.4043" x="90.3" y="159.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="149.7126" y="177.5851">Review</text><line style="stroke:#181818;stroke-width:0.5;" x1="91.3" x2="258.7043" y1="185.8869" y2="185.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="96.3" y="202.882">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="96.3" y="219.1789">reviewId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="96.3" y="235.4757">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="96.3" y="251.7726">subject: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="96.3" y="268.0695">content: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="96.3" y="284.3664">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="91.3" x2="258.7043" y1="291.6681" y2="291.6681"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="26" fill="#F1F1F1" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8633" x="676.57" y="208.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.8633" x="679.57" y="226.4751">ReviewServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="677.57" x2="814.4333" y1="234.7769" y2="234.7769"/><line style="stroke:#181818;stroke-width:0.5;" x1="677.57" x2="814.4333" y1="242.7769" y2="242.7769"/></g><g id="link_ReviewService_Review"><path codeLine="22" d="M175,99.79 C175,116.44 175,132.23 175,153.15 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="175,159.15,179,150.15,175,154.15,171,150.15,175,159.15" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="29" d="M346.1477,100.7993 C469.1877,122.4493 608.22,148.2 637,159.59 C667.41,171.62 698.59,192.39 719.76,208.01 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="328.42,97.68,345.1079,106.7086,347.1874,94.8901,328.42,97.68" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="322px" preserveAspectRatio="xMidYMid meet" style="width:838px;height:322px;background:#1B1B1B;" version="1.1" viewBox="0 0 838 322" width="838px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="322" style="stroke:#FFFFFF00;stroke-width:1;" width="838" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L634.5,28.2969 A2.5,2.5 0 0 1 637,30.7969 L637,313.17 A2.5,2.5 0 0 1 634.5,315.67 L8.5,315.67 A2.5,2.5 0 0 1 6,313.17 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_review-service"><path d="M663.5,173.48 L779.5146,173.48 A3.75,3.75 0 0 1 782.0146,175.98 L789.0146,195.7769 L828.5,195.7769 A2.5,2.5 0 0 1 831,198.2769 L831,264.28 A2.5,2.5 0 0 1 828.5,266.78 L663.5,266.78 A2.5,2.5 0 0 1 661,264.28 L661,175.98 A2.5,2.5 0 0 1 663.5,173.48 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="661" x2="789.0146" y1="195.7769" y2="195.7769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="665" y="188.4751">review-service</text></g><g id="elem_ReviewService"><rect codeLine="6" fill="#313139" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="306.2939" x="21.85" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="123.8368" y="58.9951">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="22.85" x2="327.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="22.85" x2="327.1439" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="27.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><path d="M362.95,52.73 L362.95,61.2964 L322.1439,87.4453 L362.95,69.2964 L362.95,77.8628 A0,0 0 0 0 362.95,77.8628 L621.0477,77.8628 A0,0 0 0 0 621.0477,77.8628 L621.0477,62.73 L611.0477,52.73 L362.95,52.73 A0,0 0 0 0 362.95,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M611.0477,52.73 L611.0477,62.73 L621.0477,62.73 L611.0477,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.0977" x="368.95" y="69.7969">GET /review?productId={productId}</text><g id="elem_Review"><rect codeLine="13" fill="#313139" height="140.0781" id="Review" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="169.4043" x="90.3" y="159.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="149.7126" y="177.5851">Review</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="91.3" x2="258.7043" y1="185.8869" y2="185.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="96.3" y="202.882">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="96.3" y="219.1789">reviewId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="96.3" y="235.4757">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="96.3" y="251.7726">subject: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="96.3" y="268.0695">content: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="96.3" y="284.3664">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="91.3" x2="258.7043" y1="291.6681" y2="291.6681"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="26" fill="#313139" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="138.8633" x="676.57" y="208.48"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.8633" x="679.57" y="226.4751">ReviewServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="677.57" x2="814.4333" y1="234.7769" y2="234.7769"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="677.57" x2="814.4333" y1="242.7769" y2="242.7769"/></g><g id="link_ReviewService_Review"><path codeLine="22" d="M175,99.79 C175,116.44 175,132.23 175,153.15 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="175,159.15,179,150.15,175,154.15,171,150.15,175,159.15" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="29" d="M346.1477,100.7993 C469.1877,122.4493 608.22,148.2 637,159.59 C667.41,171.62 698.59,192.39 719.76,208.01 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="328.42,97.68,345.1079,106.7086,347.1874,94.8901,328.42,97.68" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h3 id="test-321-normal-case-for-product-id-1">Test 3.2.1: Normal case for product id = 1</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getReviewByProductId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">[0].productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>將 <code>ServiceUtil</code> 抽到 <code>util</code> 模組，讓不同的模組可以共用。</p>
<details class="tip">
<summary>手動新增 <code>util</code> module</summary>
<p>需要增加下面設定</p>
<div class="highlight"><span class="filename">build.gradle.kts</span><pre><span></span><code>plugins {
    id(&quot;io.spring.dependency-management&quot;) version &quot;1.1.7&quot;
}

dependencies {
    implementation(platform(&quot;org.springframework.boot:spring-boot-dependencies:3.4.2&quot;))
    implementation(&quot;org.springframework:spring-contextt&quot;)
}
</code></pre></div>
<p>留意 <code>ServiceUtil</code> 是否在 sacn package 下。</p>
</details>
</li>
</ul>
<h3 id="test-322-product-id-not-found">Test 3.2.2: product id not found</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=213&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="test-323-product-id-is-negative">Test 3.2.3: product id is negative</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review invalid parameter negative value`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>把 exception 及其 handler 移到 util 下共用</li>
</ul>
<h3 id="test-324-prodict-id-is-not-integer">Test 3.2.4: prodict id is not integer</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review invalid parameter string`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=no-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="test-325-missig-product-id">Test 3.2.5: missig product id</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review missing parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Required query parameter &#39;productId&#39; is not present.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>不需要實作</li>
</ul>
<h2 id="kata-33-recommendation-api">Kata 3.3: Recommendation API</h2>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="322px" preserveAspectRatio="xMidYMid meet" style="width:1126px;height:322px;background:#FFFFFF;" version="1.1" viewBox="0 0 1126 322" width="1126px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L848.5,28.2969 A2.5,2.5 0 0 1 851,30.7969 L851,313.17 A2.5,2.5 0 0 1 848.5,315.67 L8.5,315.67 A2.5,2.5 0 0 1 6,313.17 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_recommendation-service"><path d="M877.5,173.48 L1074.2607,173.48 A3.75,3.75 0 0 1 1076.7607,175.98 L1083.7607,195.7769 L1116.5,195.7769 A2.5,2.5 0 0 1 1119,198.2769 L1119,264.28 A2.5,2.5 0 0 1 1116.5,266.78 L877.5,266.78 A2.5,2.5 0 0 1 875,264.28 L875,175.98 A2.5,2.5 0 0 1 877.5,173.48 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="875" x2="1083.7607" y1="195.7769" y2="195.7769"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="879" y="188.4751">recommendation-service</text></g><g id="elem_RecommendationService"><rect codeLine="5" fill="#F1F1F1" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="452.4326" x="21.78" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="160.3015" y="58.9951">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="22.78" x2="473.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="22.78" x2="473.2126" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="27.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><path d="M509.03,52.73 L509.03,61.2964 L468.2126,87.4453 L509.03,69.2964 L509.03,77.8628 A0,0 0 0 0 509.03,77.8628 L834.9778,77.8628 A0,0 0 0 0 834.9778,77.8628 L834.9778,62.73 L824.9778,52.73 L509.03,52.73 A0,0 0 0 0 509.03,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M824.9778,52.73 L824.9778,62.73 L834.9778,62.73 L824.9778,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.9478" x="515.03" y="69.7969">GET /recommendation?productId={productId}</text><g id="elem_Recommendation"><rect codeLine="12" fill="#F1F1F1" height="140.0781" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172.3506" x="161.82" y="159.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="186.1711" y="177.5851">Recommendation</text><line style="stroke:#181818;stroke-width:0.5;" x1="162.82" x2="333.1706" y1="185.8869" y2="185.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="167.82" y="202.882">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="167.82" y="219.1789">recommendationId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="167.82" y="235.4757">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="167.82" y="251.7726">rate: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="167.82" y="268.0695">content: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="167.82" y="284.3664">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="162.82" x2="333.1706" y1="291.6681" y2="291.6681"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="25" fill="#F1F1F1" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.9326" x="891.03" y="208.48"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.9326" x="894.03" y="226.4751">RecommendationServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="892.03" x2="1101.9626" y1="234.7769" y2="234.7769"/><line style="stroke:#181818;stroke-width:0.5;" x1="892.03" x2="1101.9626" y1="242.7769" y2="242.7769"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="21" d="M248,99.79 C248,116.44 248,132.23 248,153.15 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="248,159.15,252,150.15,248,154.15,244,150.15,248,159.15" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="28" d="M492.571,99.6728 C633.201,117.2528 781.94,138.72 851,159.59 C890.32,171.48 932.45,192.37 961.3,208.07 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="474.71,97.44,491.8267,105.6264,493.3152,93.7191,474.71,97.44" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="322px" preserveAspectRatio="xMidYMid meet" style="width:1126px;height:322px;background:#1B1B1B;" version="1.1" viewBox="0 0 1126 322" width="1126px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="322" style="stroke:#FFFFFF00;stroke-width:1;" width="1126" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L848.5,28.2969 A2.5,2.5 0 0 1 851,30.7969 L851,313.17 A2.5,2.5 0 0 1 848.5,315.67 L8.5,315.67 A2.5,2.5 0 0 1 6,313.17 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_recommendation-service"><path d="M877.5,173.48 L1074.2607,173.48 A3.75,3.75 0 0 1 1076.7607,175.98 L1083.7607,195.7769 L1116.5,195.7769 A2.5,2.5 0 0 1 1119,198.2769 L1119,264.28 A2.5,2.5 0 0 1 1116.5,266.78 L877.5,266.78 A2.5,2.5 0 0 1 875,264.28 L875,175.98 A2.5,2.5 0 0 1 877.5,173.48 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="875" x2="1083.7607" y1="195.7769" y2="195.7769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="879" y="188.4751">recommendation-service</text></g><g id="elem_RecommendationService"><rect codeLine="5" fill="#313139" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="452.4326" x="21.78" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="160.3015" y="58.9951">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="22.78" x2="473.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="22.78" x2="473.2126" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="27.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><path d="M509.03,52.73 L509.03,61.2964 L468.2126,87.4453 L509.03,69.2964 L509.03,77.8628 A0,0 0 0 0 509.03,77.8628 L834.9778,77.8628 A0,0 0 0 0 834.9778,77.8628 L834.9778,62.73 L824.9778,52.73 L509.03,52.73 A0,0 0 0 0 509.03,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M824.9778,52.73 L824.9778,62.73 L834.9778,62.73 L824.9778,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.9478" x="515.03" y="69.7969">GET /recommendation?productId={productId}</text><g id="elem_Recommendation"><rect codeLine="12" fill="#313139" height="140.0781" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="172.3506" x="161.82" y="159.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="186.1711" y="177.5851">Recommendation</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="162.82" x2="333.1706" y1="185.8869" y2="185.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="167.82" y="202.882">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="167.82" y="219.1789">recommendationId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="167.82" y="235.4757">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="167.82" y="251.7726">rate: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="167.82" y="268.0695">content: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="167.82" y="284.3664">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="162.82" x2="333.1706" y1="291.6681" y2="291.6681"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="25" fill="#313139" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="211.9326" x="891.03" y="208.48"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.9326" x="894.03" y="226.4751">RecommendationServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="892.03" x2="1101.9626" y1="234.7769" y2="234.7769"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="892.03" x2="1101.9626" y1="242.7769" y2="242.7769"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="21" d="M248,99.79 C248,116.44 248,132.23 248,153.15 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="248,159.15,252,150.15,248,154.15,244,150.15,248,159.15" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="28" d="M492.571,99.6728 C633.201,117.2528 781.94,138.72 851,159.59 C890.32,171.48 932.45,192.37 961.3,208.07 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="474.71,97.44,491.8267,105.6264,493.3152,93.7191,474.71,97.44" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h3 id="kata-331-get-recommendation-by-product-id">Kata 3.3.1: get recommendation by product id</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation by product id`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">[0].productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="kata-332-get-recommentation-not-found">Kata 3.3.2: get recommentation not found</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=113&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="kata-333-get-recommentation-invalid-parameter-negative-product-id">Kata 3.3.3: get recommentation invalid parameter negative product id</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation invalid parameter negative value`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="kata-334-get-recommentation-invalid-parameter-string">Kata 3.3.4: get recommentation invalid parameter string</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation invalid parameter string`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=no-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="kata-335-get-recommendation-missing-parameter">Kata 3.3.5: get recommendation missing parameter</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation missing parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Required query parameter &#39;productId&#39; is not present.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="kata-34-product-composite-api">Kata 3.4: Product Composite API</h2>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="490px" preserveAspectRatio="xMidYMid meet" style="width:1307px;height:490px;background:#FFFFFF;" version="1.1" viewBox="0 0 1307 490" width="1307px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L727.5,28.2969 A2.5,2.5 0 0 1 730,30.7969 L730,480.66 A2.5,2.5 0 0 1 727.5,483.16 L8.5,483.16 A2.5,2.5 0 0 1 6,480.66 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-composite"><path d="M813.5,173.49 L963.2979,173.49 A3.75,3.75 0 0 1 965.7979,175.99 L972.7979,195.7869 L1056.5,195.7869 A2.5,2.5 0 0 1 1059,198.2869 L1059,264.28 A2.5,2.5 0 0 1 1056.5,266.78 L813.5,266.78 A2.5,2.5 0 0 1 811,264.28 L811,175.99 A2.5,2.5 0 0 1 813.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="811" x2="972.7979" y1="195.7869" y2="195.7869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.7979" x="815" y="188.4851">product-composite</text></g><g id="cluster_product"><path d="M756.5,357.27 L819.0234,357.27 A3.75,3.75 0 0 1 821.5234,359.77 L828.5234,379.5669 L895.5,379.5669 A2.5,2.5 0 0 1 898,382.0669 L898,448.07 A2.5,2.5 0 0 1 895.5,450.57 L756.5,450.57 A2.5,2.5 0 0 1 754,448.07 L754,359.77 A2.5,2.5 0 0 1 756.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="754" x2="828.5234" y1="379.5669" y2="379.5669"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="61.5234" x="758" y="372.2651">product</text></g><g id="cluster_review"><path d="M924.5,357.27 L978.2529,357.27 A3.75,3.75 0 0 1 980.7529,359.77 L987.7529,379.5669 L1059.5,379.5669 A2.5,2.5 0 0 1 1062,382.0669 L1062,448.07 A2.5,2.5 0 0 1 1059.5,450.57 L924.5,450.57 A2.5,2.5 0 0 1 922,448.07 L922,359.77 A2.5,2.5 0 0 1 924.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="922" x2="987.7529" y1="379.5669" y2="379.5669"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.7529" x="926" y="372.2651">review</text></g><g id="cluster_recommendation"><path d="M1088.5,357.27 L1222.999,357.27 A3.75,3.75 0 0 1 1225.499,359.77 L1232.499,379.5669 L1297.5,379.5669 A2.5,2.5 0 0 1 1300,382.0669 L1300,448.07 A2.5,2.5 0 0 1 1297.5,450.57 L1088.5,450.57 A2.5,2.5 0 0 1 1086,448.07 L1086,359.77 A2.5,2.5 0 0 1 1088.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1086" x2="1232.499" y1="379.5669" y2="379.5669"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="133.499" x="1090" y="372.2651">recommendation</text></g><g id="elem_ProductCompositeService"><rect codeLine="5" fill="#F1F1F1" height="58.5938" id="ProductCompositeService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="330.6162" x="86.69" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="180.168" x="161.9141" y="58.9951">ProductCompositeService</text><line style="stroke:#181818;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318.6162" x="92.69" y="92.292">getProduct(productId: Int): ProductAggregate</text></g><path d="M452.27,52.73 L452.27,61.2964 L411.3062,87.4453 L452.27,69.2964 L452.27,77.8628 A0,0 0 0 0 452.27,77.8628 L713.7319,77.8628 A0,0 0 0 0 713.7319,77.8628 L713.7319,62.73 L703.7319,52.73 L452.27,52.73 A0,0 0 0 0 452.27,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M703.7319,52.73 L703.7319,62.73 L713.7319,62.73 L703.7319,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.4619" x="458.27" y="69.7969">GET /product-composite/{productId}</text><g id="elem_ProductAggregate"><rect codeLine="12" fill="#F1F1F1" height="140.0781" id="ProductAggregate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="387.375" x="90.31" y="159.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.998" x="220.4985" y="177.5951">ProductAggregate</text><line style="stroke:#181818;stroke-width:0.5;" x1="91.31" x2="476.685" y1="185.8969" y2="185.8969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="96.31" y="202.892">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="96.31" y="219.1889">name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="96.31" y="235.4857">weight: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="375.375" x="96.31" y="251.7826">recommendations: List&lt;RecommendationSummary&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.2363" x="96.31" y="268.0795">reviews: List&lt;ReviewSummary&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.4863" x="96.31" y="284.3764">serviceAddresses: ServiceAddresses</text><line style="stroke:#181818;stroke-width:0.5;" x1="91.31" x2="476.685" y1="291.6781" y2="291.6781"/></g><g id="elem_RecommendationSummary"><rect codeLine="21" fill="#F1F1F1" height="91.1875" id="RecommendationSummary" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.3037" x="22.35" y="367.82"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191.3037" x="25.35" y="385.8151">RecommendationSummary</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="394.1169" y2="394.1169"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="28.35" y="411.112">recommendationId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="28.35" y="427.4089">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="28.35" y="443.7057">rate: Int</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="451.0075" y2="451.0075"/></g><g id="elem_ReviewSummary"><rect codeLine="27" fill="#F1F1F1" height="91.1875" id="ReviewSummary" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.2344" x="254.88" y="367.82"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2344" x="257.88" y="385.8151">ReviewSummary</text><line style="stroke:#181818;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="394.1169" y2="394.1169"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="260.88" y="411.112">reviewId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="260.88" y="427.4089">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="260.88" y="443.7057">subject: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="451.0075" y2="451.0075"/></g><g id="elem_ServiceAddresses"><rect codeLine="33" fill="#F1F1F1" height="107.4844" id="ServiceAddresses" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="299.6426" x="414.18" y="359.68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.9561" x="502.0233" y="377.6751">ServiceAddresses</text><line style="stroke:#181818;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="385.9769" y2="385.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="420.18" y="402.972">cmp: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.0225" x="505.8001" y="402.972"># product composite service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.1563" x="420.18" y="419.2689">pro: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.9336" x="498.7864" y="419.2689"># product service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6025" x="420.18" y="435.5657">rev: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3867" x="498.2327" y="435.5657"># review service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.0146" x="420.18" y="451.8626">rec: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.4561" x="497.6448" y="451.8626"># recommendation service</text><line style="stroke:#181818;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="459.1644" y2="459.1644"/></g><g id="elem_ProductCompositeServiceImpl"><rect codeLine="47" fill="#F1F1F1" height="42.2969" id="ProductCompositeServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216.7109" x="826.64" y="208.49"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210.7109" x="829.64" y="226.4851">ProductCompositeServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="827.64" x2="1042.3509" y1="234.7869" y2="234.7869"/><line style="stroke:#181818;stroke-width:0.5;" x1="827.64" x2="1042.3509" y1="242.7869" y2="242.7869"/></g><g id="elem_ProductService"><rect codeLine="51" fill="#F1F1F1" height="42.2969" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.4512" x="770.27" y="392.27"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="773.27" y="410.2651">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="771.27" x2="880.7212" y1="418.5669" y2="418.5669"/><line style="stroke:#181818;stroke-width:0.5;" x1="771.27" x2="880.7212" y1="426.5669" y2="426.5669"/></g><g id="elem_ReviewService"><rect codeLine="55" fill="#F1F1F1" height="42.2969" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.3203" x="937.84" y="392.27"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="940.84" y="410.2651">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="938.84" x2="1045.1603" y1="418.5669" y2="418.5669"/><line style="stroke:#181818;stroke-width:0.5;" x1="938.84" x2="1045.1603" y1="426.5669" y2="426.5669"/></g><g id="elem_RecommendationService"><rect codeLine="59" fill="#F1F1F1" height="42.2969" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.3896" x="1102.31" y="392.27"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="1105.31" y="410.2651">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="1103.31" x2="1282.6996" y1="418.5669" y2="418.5669"/><line style="stroke:#181818;stroke-width:0.5;" x1="1103.31" x2="1282.6996" y1="426.5669" y2="426.5669"/></g><g id="link_ProductCompositeService_ProductAggregate"><path codeLine="40" d="M257.79,99.79 C261.18,116.44 264.4128,132.3507 268.6728,153.2707 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductAggregate" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="269.87,159.15,271.9937,149.5328,268.8723,154.2505,264.1546,151.1291,269.87,159.15" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_RecommendationSummary"><path codeLine="41" d="M221.68,300.14 C201.46,322.69 183.5751,342.6325 165.3851,362.9225 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-RecommendationSummary" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="161.38,367.39,170.3661,363.3588,164.7176,363.6671,164.4094,358.0186,161.38,367.39" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_ReviewSummary"><path codeLine="42" d="M296.62,300.14 C300.71,322.69 304.0664,341.1968 307.7564,361.4868 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ReviewSummary" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="308.83,367.39,311.1551,357.8195,307.9354,362.4707,303.2842,359.251,308.83,367.39" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_ServiceAddresses"><path codeLine="43" d="M391.05,300.14 C421.31,319.78 448.7176,337.5727 477.2276,356.0827 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ServiceAddresses" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="482.26,359.35,476.8896,351.0942,478.0663,356.6273,472.5332,357.804,482.26,359.35" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductCompositeService_ProductCompositeServiceImpl"><path codeLine="62" d="M435.4751,102.4169 C549.2551,122.1569 672.05,144.57 730,159.6 C781.98,173.08 839.86,193.04 880.82,208.04 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-backto-ProductCompositeServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="417.74,99.34,434.4494,108.3286,436.5007,96.5052,417.74,99.34" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_ProductService"><path codeLine="63" d="M922.71,251.14 C901.72,286.14 862.2959,351.8944 841.3359,386.8444 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-ProductService" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="838.25,391.99,846.3092,386.3289,840.8216,387.702,839.4484,382.2143,838.25,391.99" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_ReviewService"><path codeLine="64" d="M941.43,251.14 C952.4,286.14 972.8447,351.3149 983.8047,386.2649 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-ReviewService" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="985.6,391.99,986.7237,382.2055,984.1039,387.2191,979.0903,384.5992,985.6,391.99" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_RecommendationService"><path codeLine="65" d="M964.09,251.14 C1013.78,286.14 1109.495,353.5844 1159.105,388.5344 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-RecommendationService" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="1164.01,391.99,1158.9562,383.5367,1159.9225,389.1104,1154.3488,390.0767,1164.01,391.99" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="490px" preserveAspectRatio="xMidYMid meet" style="width:1307px;height:490px;background:#1B1B1B;" version="1.1" viewBox="0 0 1307 490" width="1307px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="490" style="stroke:#FFFFFF00;stroke-width:1;" width="1307" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L727.5,28.2969 A2.5,2.5 0 0 1 730,30.7969 L730,480.66 A2.5,2.5 0 0 1 727.5,483.16 L8.5,483.16 A2.5,2.5 0 0 1 6,480.66 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-composite"><path d="M813.5,173.49 L963.2979,173.49 A3.75,3.75 0 0 1 965.7979,175.99 L972.7979,195.7869 L1056.5,195.7869 A2.5,2.5 0 0 1 1059,198.2869 L1059,264.28 A2.5,2.5 0 0 1 1056.5,266.78 L813.5,266.78 A2.5,2.5 0 0 1 811,264.28 L811,175.99 A2.5,2.5 0 0 1 813.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="811" x2="972.7979" y1="195.7869" y2="195.7869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.7979" x="815" y="188.4851">product-composite</text></g><g id="cluster_product"><path d="M756.5,357.27 L819.0234,357.27 A3.75,3.75 0 0 1 821.5234,359.77 L828.5234,379.5669 L895.5,379.5669 A2.5,2.5 0 0 1 898,382.0669 L898,448.07 A2.5,2.5 0 0 1 895.5,450.57 L756.5,450.57 A2.5,2.5 0 0 1 754,448.07 L754,359.77 A2.5,2.5 0 0 1 756.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="754" x2="828.5234" y1="379.5669" y2="379.5669"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="61.5234" x="758" y="372.2651">product</text></g><g id="cluster_review"><path d="M924.5,357.27 L978.2529,357.27 A3.75,3.75 0 0 1 980.7529,359.77 L987.7529,379.5669 L1059.5,379.5669 A2.5,2.5 0 0 1 1062,382.0669 L1062,448.07 A2.5,2.5 0 0 1 1059.5,450.57 L924.5,450.57 A2.5,2.5 0 0 1 922,448.07 L922,359.77 A2.5,2.5 0 0 1 924.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="922" x2="987.7529" y1="379.5669" y2="379.5669"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.7529" x="926" y="372.2651">review</text></g><g id="cluster_recommendation"><path d="M1088.5,357.27 L1222.999,357.27 A3.75,3.75 0 0 1 1225.499,359.77 L1232.499,379.5669 L1297.5,379.5669 A2.5,2.5 0 0 1 1300,382.0669 L1300,448.07 A2.5,2.5 0 0 1 1297.5,450.57 L1088.5,450.57 A2.5,2.5 0 0 1 1086,448.07 L1086,359.77 A2.5,2.5 0 0 1 1088.5,357.27 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1086" x2="1232.499" y1="379.5669" y2="379.5669"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="133.499" x="1090" y="372.2651">recommendation</text></g><g id="elem_ProductCompositeService"><rect codeLine="5" fill="#313139" height="58.5938" id="ProductCompositeService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="330.6162" x="86.69" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="180.168" x="161.9141" y="58.9951">ProductCompositeService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318.6162" x="92.69" y="92.292">getProduct(productId: Int): ProductAggregate</text></g><path d="M452.27,52.73 L452.27,61.2964 L411.3062,87.4453 L452.27,69.2964 L452.27,77.8628 A0,0 0 0 0 452.27,77.8628 L713.7319,77.8628 A0,0 0 0 0 713.7319,77.8628 L713.7319,62.73 L703.7319,52.73 L452.27,52.73 A0,0 0 0 0 452.27,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M703.7319,52.73 L703.7319,62.73 L713.7319,62.73 L703.7319,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.4619" x="458.27" y="69.7969">GET /product-composite/{productId}</text><g id="elem_ProductAggregate"><rect codeLine="12" fill="#313139" height="140.0781" id="ProductAggregate" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="387.375" x="90.31" y="159.6"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.998" x="220.4985" y="177.5951">ProductAggregate</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="91.31" x2="476.685" y1="185.8969" y2="185.8969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="96.31" y="202.892">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="96.31" y="219.1889">name: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="96.31" y="235.4857">weight: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="375.375" x="96.31" y="251.7826">recommendations: List&lt;RecommendationSummary&gt;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.2363" x="96.31" y="268.0795">reviews: List&lt;ReviewSummary&gt;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.4863" x="96.31" y="284.3764">serviceAddresses: ServiceAddresses</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="91.31" x2="476.685" y1="291.6781" y2="291.6781"/></g><g id="elem_RecommendationSummary"><rect codeLine="21" fill="#313139" height="91.1875" id="RecommendationSummary" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="197.3037" x="22.35" y="367.82"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191.3037" x="25.35" y="385.8151">RecommendationSummary</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="394.1169" y2="394.1169"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="28.35" y="411.112">recommendationId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="28.35" y="427.4089">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="28.35" y="443.7057">rate: Int</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="451.0075" y2="451.0075"/></g><g id="elem_ReviewSummary"><rect codeLine="27" fill="#313139" height="91.1875" id="ReviewSummary" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="124.2344" x="254.88" y="367.82"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2344" x="257.88" y="385.8151">ReviewSummary</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="394.1169" y2="394.1169"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="260.88" y="411.112">reviewId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="260.88" y="427.4089">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="260.88" y="443.7057">subject: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="451.0075" y2="451.0075"/></g><g id="elem_ServiceAddresses"><rect codeLine="33" fill="#313139" height="107.4844" id="ServiceAddresses" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="299.6426" x="414.18" y="359.68"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.9561" x="502.0233" y="377.6751">ServiceAddresses</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="385.9769" y2="385.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="420.18" y="402.972">cmp: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.0225" x="505.8001" y="402.972"># product composite service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.1563" x="420.18" y="419.2689">pro: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.9336" x="498.7864" y="419.2689"># product service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6025" x="420.18" y="435.5657">rev: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3867" x="498.2327" y="435.5657"># review service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.0146" x="420.18" y="451.8626">rec: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.4561" x="497.6448" y="451.8626"># recommendation service</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="459.1644" y2="459.1644"/></g><g id="elem_ProductCompositeServiceImpl"><rect codeLine="47" fill="#313139" height="42.2969" id="ProductCompositeServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="216.7109" x="826.64" y="208.49"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210.7109" x="829.64" y="226.4851">ProductCompositeServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="827.64" x2="1042.3509" y1="234.7869" y2="234.7869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="827.64" x2="1042.3509" y1="242.7869" y2="242.7869"/></g><g id="elem_ProductService"><rect codeLine="51" fill="#313139" height="42.2969" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="111.4512" x="770.27" y="392.27"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="773.27" y="410.2651">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="771.27" x2="880.7212" y1="418.5669" y2="418.5669"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="771.27" x2="880.7212" y1="426.5669" y2="426.5669"/></g><g id="elem_ReviewService"><rect codeLine="55" fill="#313139" height="42.2969" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="108.3203" x="937.84" y="392.27"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="940.84" y="410.2651">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="938.84" x2="1045.1603" y1="418.5669" y2="418.5669"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="938.84" x2="1045.1603" y1="426.5669" y2="426.5669"/></g><g id="elem_RecommendationService"><rect codeLine="59" fill="#313139" height="42.2969" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="181.3896" x="1102.31" y="392.27"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="1105.31" y="410.2651">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1103.31" x2="1282.6996" y1="418.5669" y2="418.5669"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1103.31" x2="1282.6996" y1="426.5669" y2="426.5669"/></g><g id="link_ProductCompositeService_ProductAggregate"><path codeLine="40" d="M257.79,99.79 C261.18,116.44 264.4128,132.3507 268.6728,153.2707 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductAggregate" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="269.87,159.15,271.9937,149.5328,268.8723,154.2505,264.1546,151.1291,269.87,159.15" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_RecommendationSummary"><path codeLine="41" d="M221.68,300.14 C201.46,322.69 183.5751,342.6325 165.3851,362.9225 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-RecommendationSummary" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="161.38,367.39,170.3661,363.3588,164.7176,363.6671,164.4094,358.0186,161.38,367.39" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_ReviewSummary"><path codeLine="42" d="M296.62,300.14 C300.71,322.69 304.0664,341.1968 307.7564,361.4868 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ReviewSummary" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="308.83,367.39,311.1551,357.8195,307.9354,362.4707,303.2842,359.251,308.83,367.39" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_ServiceAddresses"><path codeLine="43" d="M391.05,300.14 C421.31,319.78 448.7176,337.5727 477.2276,356.0827 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ServiceAddresses" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="482.26,359.35,476.8896,351.0942,478.0663,356.6273,472.5332,357.804,482.26,359.35" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductCompositeService_ProductCompositeServiceImpl"><path codeLine="62" d="M435.4751,102.4169 C549.2551,122.1569 672.05,144.57 730,159.6 C781.98,173.08 839.86,193.04 880.82,208.04 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-backto-ProductCompositeServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="417.74,99.34,434.4494,108.3286,436.5007,96.5052,417.74,99.34" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_ProductService"><path codeLine="63" d="M922.71,251.14 C901.72,286.14 862.2959,351.8944 841.3359,386.8444 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-ProductService" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="838.25,391.99,846.3092,386.3289,840.8216,387.702,839.4484,382.2143,838.25,391.99" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_ReviewService"><path codeLine="64" d="M941.43,251.14 C952.4,286.14 972.8447,351.3149 983.8047,386.2649 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-ReviewService" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="985.6,391.99,986.7237,382.2055,984.1039,387.2191,979.0903,384.5992,985.6,391.99" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductCompositeServiceImpl_RecommendationService"><path codeLine="65" d="M964.09,251.14 C1013.78,286.14 1109.495,353.5844 1159.105,388.5344 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeServiceImpl-to-RecommendationService" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="1164.01,391.99,1158.9562,383.5367,1159.9225,389.1104,1154.3488,390.0767,1164.01,391.99" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h3 id="refactor-service-interfaces">Refactor: 抽 Service interfaces</h3>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="239px" preserveAspectRatio="xMidYMid meet" style="width:1131px;height:239px;background:#FFFFFF;" version="1.1" viewBox="0 0 1131 239" width="1131px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L1121.5,28.2969 A2.5,2.5 0 0 1 1124,30.7969 L1124,113.09 A2.5,2.5 0 0 1 1121.5,115.59 L8.5,115.59 A2.5,2.5 0 0 1 6,113.09 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M66.5,139.59 L191.2852,139.59 A3.75,3.75 0 0 1 193.7852,142.09 L200.7852,161.8869 L235.5,161.8869 A2.5,2.5 0 0 1 238,164.3869 L238,230.39 A2.5,2.5 0 0 1 235.5,232.89 L66.5,232.89 A2.5,2.5 0 0 1 64,230.39 L64,142.09 A2.5,2.5 0 0 1 66.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="64" x2="200.7852" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="68" y="154.5851">product-service</text></g><g id="cluster_recommendation-service"><path d="M421.5,139.59 L618.2607,139.59 A3.75,3.75 0 0 1 620.7607,142.09 L627.7607,161.8869 L660.5,161.8869 A2.5,2.5 0 0 1 663,164.3869 L663,230.39 A2.5,2.5 0 0 1 660.5,232.89 L421.5,232.89 A2.5,2.5 0 0 1 419,230.39 L419,142.09 A2.5,2.5 0 0 1 421.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="419" x2="627.7607" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="423" y="154.5851">recommendation-service</text></g><g id="cluster_review-service"><path d="M872.5,139.59 L988.5146,139.59 A3.75,3.75 0 0 1 991.0146,142.09 L998.0146,161.8869 L1037.5,161.8869 A2.5,2.5 0 0 1 1040,164.3869 L1040,230.39 A2.5,2.5 0 0 1 1037.5,232.89 L872.5,232.89 A2.5,2.5 0 0 1 870,230.39 L870,142.09 A2.5,2.5 0 0 1 872.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="870" x2="998.0146" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="874" y="154.5851">review-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#FF0000" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><g id="elem_RecommendationService"><rect codeLine="8" fill="#FF0000" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="452.4326" x="314.78" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="453.3015" y="58.9951">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="315.78" x2="766.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="315.78" x2="766.2126" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="320.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><g id="elem_ReviewService"><rect codeLine="11" fill="#FF0000" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="306.2939" x="801.85" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="903.8368" y="58.9951">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="802.85" x2="1107.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="802.85" x2="1107.1439" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="807.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><g id="elem_ps"><rect codeLine="17" fill="#F1F1F1" height="42.2969" id="ps" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.9941" x="80" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="83" y="192.5851">ProductService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="188.4512" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="81" x2="220.9941" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="81" x2="220.9941" y1="208.8869" y2="208.8869"/></g><g id="elem_rec"><rect codeLine="21" fill="#F1F1F1" height="42.2969" id="rec" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.9326" x="435.03" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="438.03" y="192.5851">RecommendationService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="613.4196" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="436.03" x2="645.9626" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="436.03" x2="645.9626" y1="208.8869" y2="208.8869"/></g><g id="elem_rev"><rect codeLine="25" fill="#F1F1F1" height="42.2969" id="rev" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8633" x="885.57" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="888.57" y="192.5851">ReviewService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="990.8903" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="886.57" x2="1023.4333" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="886.57" x2="1023.4333" y1="208.8869" y2="208.8869"/></g><g id="link_ProductService_ps"><path codeLine="28" d="M151,117.93 C151,140.72 151,154.06 151,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ps" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="151,99.93,145,117.93,157,117.93,151,99.93" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_rec"><path codeLine="29" d="M541,117.93 C541,140.72 541,154.06 541,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-rec" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="541,99.93,535,117.93,547,117.93,541,99.93" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_rev"><path codeLine="30" d="M955,117.93 C955,140.72 955,154.06 955,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-rev" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="955,99.93,949,117.93,961,117.93,955,99.93" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="239px" preserveAspectRatio="xMidYMid meet" style="width:1131px;height:239px;background:#1B1B1B;" version="1.1" viewBox="0 0 1131 239" width="1131px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="239" style="stroke:#FFFFFF00;stroke-width:1;" width="1131" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L1121.5,28.2969 A2.5,2.5 0 0 1 1124,30.7969 L1124,113.09 A2.5,2.5 0 0 1 1121.5,115.59 L8.5,115.59 A2.5,2.5 0 0 1 6,113.09 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M66.5,139.59 L191.2852,139.59 A3.75,3.75 0 0 1 193.7852,142.09 L200.7852,161.8869 L235.5,161.8869 A2.5,2.5 0 0 1 238,164.3869 L238,230.39 A2.5,2.5 0 0 1 235.5,232.89 L66.5,232.89 A2.5,2.5 0 0 1 64,230.39 L64,142.09 A2.5,2.5 0 0 1 66.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="64" x2="200.7852" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="68" y="154.5851">product-service</text></g><g id="cluster_recommendation-service"><path d="M421.5,139.59 L618.2607,139.59 A3.75,3.75 0 0 1 620.7607,142.09 L627.7607,161.8869 L660.5,161.8869 A2.5,2.5 0 0 1 663,164.3869 L663,230.39 A2.5,2.5 0 0 1 660.5,232.89 L421.5,232.89 A2.5,2.5 0 0 1 419,230.39 L419,142.09 A2.5,2.5 0 0 1 421.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="419" x2="627.7607" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="423" y="154.5851">recommendation-service</text></g><g id="cluster_review-service"><path d="M872.5,139.59 L988.5146,139.59 A3.75,3.75 0 0 1 991.0146,142.09 L998.0146,161.8869 L1037.5,161.8869 A2.5,2.5 0 0 1 1040,164.3869 L1040,230.39 A2.5,2.5 0 0 1 1037.5,232.89 L872.5,232.89 A2.5,2.5 0 0 1 870,230.39 L870,142.09 A2.5,2.5 0 0 1 872.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="870" x2="998.0146" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="874" y="154.5851">review-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#FF0000" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><g id="elem_RecommendationService"><rect codeLine="8" fill="#FF0000" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="452.4326" x="314.78" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="453.3015" y="58.9951">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="315.78" x2="766.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="315.78" x2="766.2126" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="320.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><g id="elem_ReviewService"><rect codeLine="11" fill="#FF0000" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="306.2939" x="801.85" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="903.8368" y="58.9951">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="802.85" x2="1107.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="802.85" x2="1107.1439" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="807.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><g id="elem_ps"><rect codeLine="17" fill="#313139" height="42.2969" id="ps" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.9941" x="80" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="83" y="192.5851">ProductService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="188.4512" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="81" x2="220.9941" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="81" x2="220.9941" y1="208.8869" y2="208.8869"/></g><g id="elem_rec"><rect codeLine="21" fill="#313139" height="42.2969" id="rec" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="211.9326" x="435.03" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="438.03" y="192.5851">RecommendationService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="613.4196" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="436.03" x2="645.9626" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="436.03" x2="645.9626" y1="208.8869" y2="208.8869"/></g><g id="elem_rev"><rect codeLine="25" fill="#313139" height="42.2969" id="rev" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="138.8633" x="885.57" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="888.57" y="192.5851">ReviewService</text><text fill="#FF0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="990.8903" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="886.57" x2="1023.4333" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="886.57" x2="1023.4333" y1="208.8869" y2="208.8869"/></g><g id="link_ProductService_ps"><path codeLine="28" d="M151,117.93 C151,140.72 151,154.06 151,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ps" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="151,99.93,145,117.93,157,117.93,151,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_rec"><path codeLine="29" d="M541,117.93 C541,140.72 541,154.06 541,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-rec" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="541,99.93,535,117.93,547,117.93,541,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_rev"><path codeLine="30" d="M955,117.93 C955,140.72 955,154.06 955,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-rev" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="955,99.93,949,117.93,961,117.93,955,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<ul>
<li><code>Product</code>, <code>Recommendation</code>, <code>Review</code> 搬到 <code>api</code> 下</li>
<li>抽 interface: <code>ProductService</code>, <code>RecommendationService</code>, <code>ReviewService</code><ul>
<li>先將原本的物件改名增加後綴 <code>Impl</code></li>
<li>抽 interface 到 <code>api</code> 套件</li>
</ul>
</li>
<li>執行測試，確定 Refactor 後測試依然通過 <code>./gradlew test</code></li>
</ul>
<details class="tip">
<summary>IntelliJ 熱鍵</summary>
<p>Move class: <span class="keys"><kbd class="key-f6">F6</kbd></span><br />
Rename: <span class="keys"><kbd class="key-shift">Shift</kbd><span>+</span><kbd class="key-f6">F6</kbd></span> (vim <span class="keys"><kbd>\rn</kbd></span>)<br />
抽 Interface: <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-t">T</kbd></span> &gt; Extract Interface...</p>
</details>
<h3 id="test-341-get-product-by-productid">Test 3.4.1: Get product by productId</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@EnableWireMock</span><span class="p">(</span><span class="n">ConfigureWireMock</span><span class="p">(</span><span class="n">portProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;app.product-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.recommendation-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.review-service.port&quot;</span><span class="o">]</span><span class="p">))</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductCompositeServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">`get product by product id`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span><span class="n">okJson</span><span class="p">(</span><span class="s">&quot;&quot;&quot; { &quot;productId&quot;: 1, &quot;name&quot;: &quot;product 1&quot;, &quot;weight&quot;: 123, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7001&quot; } &quot;&quot;&quot;</span><span class="p">)))</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;recommendationId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 1, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 2, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 3, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; }</span>
<span class="s">                    ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/review?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;reviewId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-1&quot;, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-2&quot;, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-3&quot;, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; }</span>
<span class="s">                        ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/1&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.recommendations.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.reviews.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>使用 <code>RestTemplate</code> 串接 API</p>
<details class="tip">
<summary>使用 <code>RestTemplate</code> 配合 <code>ParameterizedTypeReference</code> 接收 List 處理 generic type 的問題</summary>
<div class="highlight"><span class="filename">Example</span><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getRecommendations</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span>
<span class="w">        </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;http://</span><span class="si">$</span><span class="n">recommendationServiceHost</span><span class="s">:</span><span class="si">$</span><span class="n">recommendationServicePort</span><span class="s">/recommendation?productId=</span><span class="si">$</span><span class="n">productId</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">).</span><span class="na">body</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>逐步實作，分三個 subtask: <code>$.productId</code>, <code>$.recommendations.length()</code>, <code>$.reviews.length()</code>，一次做一個，還沒有做的 assertion 先註解起來。</p>
</li>
<li>定義 properties: microservices 的 host 與 port</li>
<li>Spring 建議的 Mock Server<ul>
<li><a href="https://docs.spring.io/spring-cloud-contract/docs/current/reference/html/project-features.html#features-wiremock">WireMockk</a> 測試使用這個</li>
<li><a href="https://docs.spring.io/spring-framework/reference/web/webflux-webclient/client-testing.html">MockWebServer</a></li>
</ul>
</li>
</ul>
<h3 id="test-342-get-product-not-found">Test 3.4.2: Get product not found</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/13&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Product with productId=13 not found&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Not found: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="test-343-get-product-invalid-parameter">Test 3.4.3: Get product invalid parameter</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product invalid parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/-1&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Invalid productId: -1&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最後更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年1月31日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="建立日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年1月31日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到頂端
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2025 Teddy Lee
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.select", "content.code.annotate", "content.code.copy", "toc.integrate", "navigation.top", "content.footnote.tooltips", "content.tooltips"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5090c770.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../assets/mkdocs_puml/puml.js"></script>
      
    
  </body>
</html>