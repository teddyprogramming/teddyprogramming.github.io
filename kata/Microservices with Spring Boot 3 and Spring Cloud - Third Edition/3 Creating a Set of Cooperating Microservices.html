
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>3. Creating a Set of Cooperating Microservices - Teddy 的筆記本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/style.css">
    
      <link rel="stylesheet" href="../../assets/mkdocs_puml/puml.css">
    
      <link rel="stylesheet" href="../../termynal.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-creating-a-set-of-cooperating-microservices" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Teddy 的筆記本" class="md-header__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teddy 的筆記本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creating a Set of Cooperating Microservices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teddy 的筆記本" class="md-nav__button md-logo" aria-label="Teddy 的筆記本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Teddy 的筆記本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JetBrains
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            JetBrains
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/shortcuts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快捷鍵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/jet-brains/postfix-completion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postfix Completion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vim
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Vim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/zsh.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zsh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/vscode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/ideavim.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IdeaVim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vim/advanced.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    進階
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/apply.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apply
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pod-topology-spread-constraints.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod Topology Spread Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Domain-Driven Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Domain-Driven Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/01-crunching-knowledge.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Crunching Knowledge
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/02-communication-and-the-use-of-language.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Communication and the Use of Language
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/03-binding-model-and-implementation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Binding Model and Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/04-isolating-the-domain.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Isolating the Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/05-a-model-expressed-in-software.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 A Model Expressed in Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/06-the-life-cycle-of-a-domain-object.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 The Life Cycle of a Domain Object
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/07-using-the-language-an-extended-example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Using the Language - An Extended Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/08-breakthrough.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Breakthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/09-making-implicit-concepts-explicit.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 Making Implicit Concepts Explicit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain-driven-design/10-supple-design.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Supple Design
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clean Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Clean Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clean-architecture/34.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34 The Missing Chapter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Java, 3rd
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Effective Java, 3rd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Creating And Destroying Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            Creating And Destroying Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/001.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 1 - Consider static factory methods instead of constructors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/002.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 2 - Consider a builder when faced with many constructor parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/003.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 3 - Enforce the singleton property with a private constructor or an enum type
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/004.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 4 - Enforce noninstantiability with a private constructor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/005.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 5 - Prefer dependency injection to hardwiring resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/006.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 6 - Avoid creating unnecessary objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/007.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 7 - Eliminate obsolete object references
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/008.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 8 - Avoid finalizers and cleaners
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/009.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 9 - Prefer try-with-resources to try-finally
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methods Common To All Objects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Methods Common To All Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/010.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 10 - Obey the general contract when overriding equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/011.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 11 - Always override hashCode when you override equals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/012.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 12 = Always override toString
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/013.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 13 - Override clone judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/014.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 14 - Consider implementing Comparable
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Classes and Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Classes and Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/015.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 15 - Minimize the accessibility of classes and members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/016.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 16 - In public classes, use accessor methods, not public fields
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../java/effective-java/055.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Item 55 - Return optionals judiciously
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pyenv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pyenv
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/spring-boot-basic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spring Boot Basic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/set-up-microservices-project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    新增 Spring Boot microservices 專案
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/spring-webflux.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spring Webflux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scheduler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Scheduler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_1" >
        
          
          <label class="md-nav__link" for="__nav_7_4_1" id="__nav_7_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quartz
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_1">
            <span class="md-nav__icon md-icon"></span>
            Quartz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/hello_world.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/scheduler/jdbc_job_store.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JDBC JobStore
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../spring-boot/testing/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-toggles/main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Toggles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kata
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Kata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices with Spring Boot 3 and Spring Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="3-creating-a-set-of-cooperating-microservices">3. Creating a Set of Cooperating Microservices</h1>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="165px" preserveAspectRatio="xMidYMid meet" style="width:430px;height:165px;background:#FFFFFF;" version="1.1" viewBox="0 0 430 165" width="430px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_pc"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172.877" x="94.42" y="7"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="247.297" y="12"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="14"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="245.297" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.877" x="109.42" y="39.9951">Product Composite</text></g><g id="elem_p"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93.71" x="7" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="80.71" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="78.71" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="22" y="146.2851">Product</text></g><g id="elem_r"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.5791" x="135.57" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="206.1491" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="204.1491" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="150.57" y="146.2851">Review</text></g><g id="elem_rd"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163.6484" x="261.03" y="113.29"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="404.6784" y="118.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="120.29"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="402.6784" y="124.29"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="276.03" y="146.2851">Recommendation</text></g><g id="link_pc_p"><path d="M153.3,53.78 C132,71.27 107.2872,91.5626 85.9972,109.0426 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-p" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="81.36,112.85,90.8541,110.2304,85.2244,109.6772,85.7776,104.0475,81.36,112.85" style="stroke:#181818;stroke-width:1;"/></g><g id="link_pc_r"><path d="M180.85,53.78 C180.85,71.27 180.85,89.37 180.85,106.85 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-r" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="180.85,112.85,184.85,103.85,180.85,107.85,176.85,103.85,180.85,112.85" style="stroke:#181818;stroke-width:1;"/></g><g id="link_pc_rd"><path d="M216.01,53.78 C243.18,71.27 275.5752,92.122 302.7252,109.602 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-rd" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="307.77,112.85,302.3681,104.6147,303.566,110.1433,298.0374,111.3412,307.77,112.85" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="165px" preserveAspectRatio="xMidYMid meet" style="width:430px;height:165px;background:#1B1B1B;" version="1.1" viewBox="0 0 430 165" width="430px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="165" style="stroke:#FFFFFF00;stroke-width:1;" width="430" x="0" y="0"/><g id="elem_pc"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="172.877" x="94.42" y="7"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="247.297" y="12"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="245.297" y="14"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="245.297" y="18"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.877" x="109.42" y="39.9951">Product Composite</text></g><g id="elem_p"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="93.71" x="7" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="80.71" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="78.71" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="78.71" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="22" y="146.2851">Product</text></g><g id="elem_r"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="90.5791" x="135.57" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="206.1491" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="204.1491" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="204.1491" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="150.57" y="146.2851">Review</text></g><g id="elem_rd"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="163.6484" x="261.03" y="113.29"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="404.6784" y="118.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="402.6784" y="120.29"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="402.6784" y="124.29"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="276.03" y="146.2851">Recommendation</text></g><g id="link_pc_p"><path d="M153.3,53.78 C132,71.27 107.2872,91.5626 85.9972,109.0426 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-p" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="81.36,112.85,90.8541,110.2304,85.2244,109.6772,85.7776,104.0475,81.36,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_pc_r"><path d="M180.85,53.78 C180.85,71.27 180.85,89.37 180.85,106.85 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-r" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="180.85,112.85,184.85,103.85,180.85,107.85,176.85,103.85,180.85,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_pc_rd"><path d="M216.01,53.78 C243.18,71.27 275.5752,92.122 302.7252,109.602 " fill="#FFFFFF" fill-opacity="0.00000" id="pc-to-rd" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="307.77,112.85,302.3681,104.6147,303.566,110.1433,298.0374,111.3412,307.77,112.85" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<p>Ports:</p>
<ul>
<li>Product Composite: <code>6000</code></li>
<li>Product: <code>6001</code></li>
<li>Recommendation: <code>6002</code></li>
<li>Review: <code>6003</code></li>
</ul>
<div class="admonition note">
<p class="admonition-title">書本使用 port 7000, 7001, 7002, 7003</p>
<p>因為 macos 中，port 7000 被 airplay 佔用了，所以改用 <code>6000</code>, <code>6001</code>, <code>6002</code>, <code>6003</code></p>
</div>
<h2 id="microservice">建立 microservice 專案</h2>
<p>按下面目錄結構新增 4 個 microservices 專案。</p>
<div class="highlight"><pre><span></span><code>/
├── product-composite-service
├── product-service
├── recommendation-service
└── review-service
</code></pre></div>
<ul>
<li>使用 Spring Initializr 建立專案</li>
<li>專案相依 <code>actuator</code>, <code>webflux</code></li>
<li>
<p>使用 gradle 編譯專案</p>
<details class="tip">
<summary>使用 <code>./gradlew build</code></summary>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>product-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>recommendation-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>review-service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>product-composite<span class="w"> </span>service<span class="p">;</span><span class="w"> </span>./gradlew<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-<span class="p">;</span>
</code></pre></div>
</details>
</li>
</ul>
<h2 id="_1">單一指令編譯專案</h2>
<p>調整專案結構，使可以用單一指令 <code>./gradlew build</code> 編譯所有專案。</p>
<div class="admonition note">
<p class="admonition-title">IntelliJ 可能需要將 gradle 設定清除後重新開啟 IDE。</p>
</div>
<h2 id="adding-restful-apis">Adding RESTful APIs</h2>
<h3 id="product-api">Product API</h3>
<p>將 product-service 的 port 設定成 <code>6001</code>。</p>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="240px" preserveAspectRatio="xMidYMid meet" style="width:495px;height:240px;background:#FFFFFF;" version="1.1" viewBox="0 0 495 240" width="495px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_ProductService"><rect codeLine="4" fill="#F1F1F1" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="257.3281" x="7" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="82.9385" y="24.9951">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="263.3281" y1="33.2969" y2="33.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="263.3281" y1="41.2969" y2="41.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="13" y="58.292">getProduct(productId: Int): Product</text></g><path d="M299,18.73 L299,27.2964 L258.3281,53.4453 L299,35.2964 L299,43.8628 A0,0 0 0 0 299,43.8628 L488.3208,43.8628 A0,0 0 0 0 488.3208,43.8628 L488.3208,28.73 L478.3208,18.73 L299,18.73 A0,0 0 0 0 299,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M478.3208,18.73 L478.3208,28.73 L488.3208,28.73 L478.3208,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3208" x="305" y="35.7969">GET /product/{productId}</text><g id="elem_Product"><rect codeLine="11" fill="#F1F1F1" height="107.4844" id="Product" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169.4043" x="50.96" y="125.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="108.8072" y="143.5951">Product</text><line style="stroke:#181818;stroke-width:0.5;" x1="51.96" x2="219.3643" y1="151.8969" y2="151.8969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="56.96" y="168.892">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="56.96" y="185.1889">name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="56.96" y="201.4857">weight: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="56.96" y="217.7826">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="51.96" x2="219.3643" y1="225.0844" y2="225.0844"/></g><g id="link_ProductService_Product"><path codeLine="18" d="M135.66,65.84 C135.66,82.9 135.66,99.12 135.66,119.31 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="135.66,125.31,139.66,116.31,135.66,120.31,131.66,116.31,135.66,125.31" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="240px" preserveAspectRatio="xMidYMid meet" style="width:495px;height:240px;background:#1B1B1B;" version="1.1" viewBox="0 0 495 240" width="495px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="240" style="stroke:#FFFFFF00;stroke-width:1;" width="495" x="0" y="0"/><g id="elem_ProductService"><rect codeLine="4" fill="#313139" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="257.3281" x="7" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="82.9385" y="24.9951">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="263.3281" y1="33.2969" y2="33.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="263.3281" y1="41.2969" y2="41.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="13" y="58.292">getProduct(productId: Int): Product</text></g><path d="M299,18.73 L299,27.2964 L258.3281,53.4453 L299,35.2964 L299,43.8628 A0,0 0 0 0 299,43.8628 L488.3208,43.8628 A0,0 0 0 0 488.3208,43.8628 L488.3208,28.73 L478.3208,18.73 L299,18.73 A0,0 0 0 0 299,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M478.3208,18.73 L478.3208,28.73 L488.3208,28.73 L478.3208,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3208" x="305" y="35.7969">GET /product/{productId}</text><g id="elem_Product"><rect codeLine="11" fill="#313139" height="107.4844" id="Product" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="169.4043" x="50.96" y="125.6"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="108.8072" y="143.5951">Product</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="51.96" x2="219.3643" y1="151.8969" y2="151.8969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="56.96" y="168.892">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="56.96" y="185.1889">name: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="56.96" y="201.4857">weight: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="56.96" y="217.7826">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="51.96" x2="219.3643" y1="225.0844" y2="225.0844"/></g><g id="link_ProductService_Product"><path codeLine="18" d="M135.66,65.84 C135.66,82.9 135.66,99.12 135.66,119.31 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="135.66,125.31,139.66,116.31,135.66,120.31,131.66,116.31,135.66,125.31" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<div class="admonition note">
<p class="admonition-title">書中作者將 Controller 視作 Service，因此命名成 <code>ProductService</code>。</p>
</div>
<h4 id="test-get-product">Test: Get product</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="w"> </span><span class="n">WebTestClient</span>

<span class="hll"><span class="w">    </span><span class="nd">@Test</span>
</span><span class="hll"><span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getProductById</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">().</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
<ul>
<li>設定 <code>@SpringBootTest</code> 參數 <code>webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT</code>。</li>
<li>Autowire <code>WebTestClient</code>。</li>
<li>目前沒有 persistence layer，用假資料即可。</li>
<li>
<p>實作 <code>ServiceUtil</code> 封裝 <code>serviceAddress</code> 的細節。</p>
<ul>
<li>
<p>格式為 <code>${hostName}/${ipAddress}:${port}</code></p>
<details class="tip">
<summary>使用 <code>InetAddress</code> 取得 <code>hostName</code> 與 <code>ipAddress</code></summary>
<p>取得 host name: <code>InetAddress.getLocalHost().getHostName()</code><br />
取得 host IP: <code>InetAddress.getLocalHost().getHostAddress()</code></p>
</details>
</li>
</ul>
</li>
</ul>
<h4 id="test-get-product-not-found">Test: Get product not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductNotFound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;No product found for productId: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>宣告 <code>NotFoundException</code>，在 product 找不到時拋出。</li>
<li>
<p>使用 <code>@RestControllerAdvice</code> 處理例外狀況</p>
<details class="tip">
<summary>使用 <code>@RestControllerAdvice</code> 處理 product not found 的 response</summary>
<div class="highlight"><pre><span></span><code><span class="nd">@RestControllerAdvice</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">GlobalControllerExceptionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">NotFoundException</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ResponseBody</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">handleNotFoundException</span><span class="p">(</span>
<span class="w">        </span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">ServerHttpRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">NotFoundException</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">HttpErrorInfo</span><span class="p">(</span>
<span class="w">            </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">path</span><span class="p">.</span><span class="na">pathWithinApplication</span><span class="p">().</span><span class="na">value</span><span class="p">(),</span>
<span class="w">            </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">,</span>
<span class="w">            </span><span class="n">requireNotNull</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">HttpErrorInfo</span><span class="p">(</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">:</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpStatus</span><span class="p">:</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">,</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>例外狀況回傳 <code>HttpErrorInfo</code></p>
<p><div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="128px" preserveAspectRatio="xMidYMid meet" style="width:230px;height:128px;background:#FFFFFF;" version="1.1" viewBox="0 0 230 128" width="230px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_HttpErrorInfo"><rect codeLine="4" fill="#F1F1F1" height="107.4844" id="HttpErrorInfo" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="209.3672" x="7" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.5674" x="65.8999" y="24.9951">HttpErrorInfo</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="215.3672" y1="33.2969" y2="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.3672" x="13" y="50.292">timestamp: ZonedDateTime</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7764" x="13" y="66.5889">path: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.5205" x="13" y="82.8857">httpStatus: HttpStatus</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.8662" x="13" y="99.1826">message: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="215.3672" y1="106.4844" y2="106.4844"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="128px" preserveAspectRatio="xMidYMid meet" style="width:230px;height:128px;background:#1B1B1B;" version="1.1" viewBox="0 0 230 128" width="230px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="128" style="stroke:#FFFFFF00;stroke-width:1;" width="230" x="0" y="0"/><g id="elem_HttpErrorInfo"><rect codeLine="4" fill="#313139" height="107.4844" id="HttpErrorInfo" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="209.3672" x="7" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.5674" x="65.8999" y="24.9951">HttpErrorInfo</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="215.3672" y1="33.2969" y2="33.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.3672" x="13" y="50.292">timestamp: ZonedDateTime</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7764" x="13" y="66.5889">path: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.5205" x="13" y="82.8857">httpStatus: HttpStatus</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.8662" x="13" y="99.1826">message: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="215.3672" y1="106.4844" y2="106.4844"/></g></g></svg></div></div></p>
</li>
</ul>
<h4 id="test-get-product-negative-product-id">Test: Get product negative product id</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterNegativeValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span><span class="w"> </span><span class="c1">// 422</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>宣告 <code>InvalidInputException</code>，在 <code>productId</code> 為負數時拋出。</li>
<li>處理例外拋出時回傳的資料。</li>
</ul>
<h4 id="test-get-product-invalid-parameter-productid-type-mismatch">Test: Get product invalid parameter productId type mismatch</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getProductInvalidParameterString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product/not-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>資料型態不吻合會被 Spring 擋下，預設錯誤訊息沒有 <code>message</code> 欄位，通過設定可以加入。<ul>
<li><code>server.error.include-message=always</code></li>
</ul>
</li>
</ul>
<h3 id="refactor-module">Refactor: 新增程式碼共用的 module</h3>
<h4 id="util-module"><code>util</code> module</h4>
<ul>
<li>
<p>新增 <code>util</code> module。</p>
<ul>
<li>
<p>注意 <code>plugins</code> 與 <code>dependencies</code> 的內容與下面一致，可以減少很多詭異事件..</p>
<div class="highlight"><span class="filename">build.gradle.kts</span><pre><span></span><code>plugins {
    kotlin(&quot;jvm&quot;) version &quot;1.9.25&quot;
<span class="hll">    id(&quot;io.spring.dependency-management&quot;) version &quot;1.1.7&quot;
</span>}

dependencies {
<span class="hll">    implementation(platform(&quot;org.springframework.boot:spring-boot-dependencies:3.4.2&quot;))
</span>    implementation(&quot;org.jetbrains.kotlin:kotlin-reflect&quot;)
<span class="hll">    implementation(&quot;org.springframework:spring-context&quot;)
</span>    implementation(&quot;org.springframework:spring-web&quot;)
    testImplementation(&quot;org.jetbrains.kotlin:kotlin-test-junit5&quot;)
    testImplementation(&quot;io.projectreactor:reactor-test&quot;)
    testRuntimeOnly(&quot;org.junit.platform:junit-platform-launcher&quot;)
}
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>將 <code>ServiceUtil</code> 移到 <code>util</code> 下</p>
<ul>
<li>IntelliJ 熱鍵: <span class="keys"><kbd class="key-f6">F6</kbd></span></li>
</ul>
</li>
<li>執行測試確保 Refactor 結果沒有破壞功能。<ul>
<li>如果測試失敗，應該是需要設定 product-service 的 scan package，包含 <code>ServiceUtil</code> 所在的 package。</li>
</ul>
</li>
</ul>
<h4 id="api-module"><code>api</code> module</h4>
<ul>
<li>新增 <code>api</code> module</li>
<li>將 Exception Handler, <code>NotFoundException</code>, <code>InvalidInputException</code> 移到 <code>api</code> 下。</li>
<li>執行測試</li>
</ul>
<h3 id="review-api">Review API</h3>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="272px" preserveAspectRatio="xMidYMid meet" style="width:613px;height:272px;background:#FFFFFF;" version="1.1" viewBox="0 0 613 272" width="613px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_ReviewService"><rect codeLine="4" fill="#F1F1F1" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="306.2939" x="7" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="108.9868" y="24.9951">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="312.2939" y1="33.2969" y2="33.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="312.2939" y1="41.2969" y2="41.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="13" y="58.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><path d="M348.1,18.73 L348.1,27.2964 L307.2939,53.4453 L348.1,35.2964 L348.1,43.8628 A0,0 0 0 0 348.1,43.8628 L606.1977,43.8628 A0,0 0 0 0 606.1977,43.8628 L606.1977,28.73 L596.1977,18.73 L348.1,18.73 A0,0 0 0 0 348.1,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M596.1977,18.73 L596.1977,28.73 L606.1977,28.73 L596.1977,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.0977" x="354.1" y="35.7969">GET /review?productId={productId}</text><g id="elem_Review"><rect codeLine="12" fill="#F1F1F1" height="140.0781" id="Review" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169.4043" x="75.44" y="125.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="134.8526" y="143.5851">Review</text><line style="stroke:#181818;stroke-width:0.5;" x1="76.44" x2="243.8443" y1="151.8869" y2="151.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="81.44" y="168.882">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="81.44" y="185.1789">reviewId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="81.44" y="201.4757">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="81.44" y="217.7726">subject: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="81.44" y="234.0695">content: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="81.44" y="250.3664">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="76.44" x2="243.8443" y1="257.6681" y2="257.6681"/></g><g id="link_ReviewService_Review"><path codeLine="21" d="M160.15,65.79 C160.15,82.44 160.15,98.23 160.15,119.15 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="160.15,125.15,164.15,116.15,160.15,120.15,156.15,116.15,160.15,125.15" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="272px" preserveAspectRatio="xMidYMid meet" style="width:613px;height:272px;background:#1B1B1B;" version="1.1" viewBox="0 0 613 272" width="613px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="272" style="stroke:#FFFFFF00;stroke-width:1;" width="613" x="0" y="0"/><g id="elem_ReviewService"><rect codeLine="4" fill="#313139" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="306.2939" x="7" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="108.9868" y="24.9951">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="312.2939" y1="33.2969" y2="33.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="312.2939" y1="41.2969" y2="41.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="13" y="58.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><path d="M348.1,18.73 L348.1,27.2964 L307.2939,53.4453 L348.1,35.2964 L348.1,43.8628 A0,0 0 0 0 348.1,43.8628 L606.1977,43.8628 A0,0 0 0 0 606.1977,43.8628 L606.1977,28.73 L596.1977,18.73 L348.1,18.73 A0,0 0 0 0 348.1,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M596.1977,18.73 L596.1977,28.73 L606.1977,28.73 L596.1977,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.0977" x="354.1" y="35.7969">GET /review?productId={productId}</text><g id="elem_Review"><rect codeLine="12" fill="#313139" height="140.0781" id="Review" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="169.4043" x="75.44" y="125.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="134.8526" y="143.5851">Review</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="76.44" x2="243.8443" y1="151.8869" y2="151.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="81.44" y="168.882">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="81.44" y="185.1789">reviewId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="81.44" y="201.4757">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="81.44" y="217.7726">subject: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="81.44" y="234.0695">content: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="81.44" y="250.3664">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="76.44" x2="243.8443" y1="257.6681" y2="257.6681"/></g><g id="link_ReviewService_Review"><path codeLine="21" d="M160.15,65.79 C160.15,82.44 160.15,98.23 160.15,119.15 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="160.15,125.15,164.15,116.15,160.15,120.15,156.15,116.15,160.15,125.15" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h4 id="test-get-review">Test: Get review</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">getReviewByProductId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">[0].productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-get-review-not-found">Test: Get review not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=213&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-product-id-is-negative">Test: Product id is negative</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review invalid parameter negative value`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-prodict-id-is-not-integer">Test: Prodict id is not integer</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get review invalid parameter string`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review?productId=no-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-missig-product-id">Test: Missig product id</h4>
<p>讓測試通過。(不需改程式碼)</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get reiew missing parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/review&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Required query parameter &#39;productId&#39; is not present.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="recommendation-api">Recommendation API</h3>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="272px" preserveAspectRatio="xMidYMid meet" style="width:827px;height:272px;background:#FFFFFF;" version="1.1" viewBox="0 0 827 272" width="827px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="elem_RecommendationService"><rect codeLine="4" fill="#F1F1F1" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="452.4326" x="7" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="145.5215" y="24.9951">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="458.4326" y1="33.2969" y2="33.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="458.4326" y1="41.2969" y2="41.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="13" y="58.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><path d="M494.24,18.73 L494.24,27.2964 L453.4326,53.4453 L494.24,35.2964 L494.24,43.8628 A0,0 0 0 0 494.24,43.8628 L820.1878,43.8628 A0,0 0 0 0 820.1878,43.8628 L820.1878,28.73 L810.1878,18.73 L494.24,18.73 A0,0 0 0 0 494.24,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M810.1878,18.73 L810.1878,28.73 L820.1878,28.73 L810.1878,18.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.9478" x="500.24" y="35.7969">GET /recommendation?productId={productId}</text><g id="elem_Recommendation"><rect codeLine="11" fill="#F1F1F1" height="140.0781" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172.3506" x="147.04" y="125.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="171.3911" y="143.5851">Recommendation</text><line style="stroke:#181818;stroke-width:0.5;" x1="148.04" x2="318.3906" y1="151.8869" y2="151.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="153.04" y="168.882">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="153.04" y="185.1789">recommendationId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="153.04" y="201.4757">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="153.04" y="217.7726">rate: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="153.04" y="234.0695">content: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="153.04" y="250.3664">serviceAddress: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="148.04" x2="318.3906" y1="257.6681" y2="257.6681"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="20" d="M233.22,65.79 C233.22,82.44 233.22,98.23 233.22,119.15 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="233.22,125.15,237.22,116.15,233.22,120.15,229.22,116.15,233.22,125.15" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="272px" preserveAspectRatio="xMidYMid meet" style="width:827px;height:272px;background:#1B1B1B;" version="1.1" viewBox="0 0 827 272" width="827px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="272" style="stroke:#FFFFFF00;stroke-width:1;" width="827" x="0" y="0"/><g id="elem_RecommendationService"><rect codeLine="4" fill="#313139" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="452.4326" x="7" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="145.5215" y="24.9951">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="458.4326" y1="33.2969" y2="33.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="8" x2="458.4326" y1="41.2969" y2="41.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="13" y="58.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><path d="M494.24,18.73 L494.24,27.2964 L453.4326,53.4453 L494.24,35.2964 L494.24,43.8628 A0,0 0 0 0 494.24,43.8628 L820.1878,43.8628 A0,0 0 0 0 820.1878,43.8628 L820.1878,28.73 L810.1878,18.73 L494.24,18.73 A0,0 0 0 0 494.24,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M810.1878,18.73 L810.1878,28.73 L820.1878,28.73 L810.1878,18.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.9478" x="500.24" y="35.7969">GET /recommendation?productId={productId}</text><g id="elem_Recommendation"><rect codeLine="11" fill="#313139" height="140.0781" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="172.3506" x="147.04" y="125.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="171.3911" y="143.5851">Recommendation</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="148.04" x2="318.3906" y1="151.8869" y2="151.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="153.04" y="168.882">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="153.04" y="185.1789">recommendationId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="153.04" y="201.4757">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="153.04" y="217.7726">rate: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.5488" x="153.04" y="234.0695">content: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.4043" x="153.04" y="250.3664">serviceAddress: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="148.04" x2="318.3906" y1="257.6681" y2="257.6681"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="20" d="M233.22,65.79 C233.22,82.44 233.22,98.23 233.22,119.15 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="233.22,125.15,237.22,116.15,233.22,120.15,229.22,116.15,233.22,125.15" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h4 id="test-get-recommendations">Test: Get recommendations</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendations by product id`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">[0].productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-get-recommentations-not-found">Test: Get recommentations not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendations not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=113&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-negative-product-id">Test: Negative product id</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation invalid parameter negative value`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid productId: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-product-id-is-not-integer">Test: Product id is not integer</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation invalid parameter string`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=no-integer&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Type mismatch.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-missing-prodict-id">Test: Missing prodict id</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get recommendation missing parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isBadRequest</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/recommendation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Required query parameter &#39;productId&#39; is not present.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="refactor-service-interface">Refactor: 抽 Service interface</h3>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="239px" preserveAspectRatio="xMidYMid meet" style="width:1482px;height:239px;background:#FFFFFF;" version="1.1" viewBox="0 0 1482 239" width="1482px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L1472.5,28.2969 A2.5,2.5 0 0 1 1475,30.7969 L1475,113.09 A2.5,2.5 0 0 1 1472.5,115.59 L8.5,115.59 A2.5,2.5 0 0 1 6,113.09 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M66.5,139.59 L191.2852,139.59 A3.75,3.75 0 0 1 193.7852,142.09 L200.7852,161.8869 L235.5,161.8869 A2.5,2.5 0 0 1 238,164.3869 L238,230.39 A2.5,2.5 0 0 1 235.5,232.89 L66.5,232.89 A2.5,2.5 0 0 1 64,230.39 L64,142.09 A2.5,2.5 0 0 1 66.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="64" x2="200.7852" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="68" y="154.5851">product-service</text></g><g id="cluster_recommendation-service"><path d="M516.5,139.59 L713.2607,139.59 A3.75,3.75 0 0 1 715.7607,142.09 L722.7607,161.8869 L755.5,161.8869 A2.5,2.5 0 0 1 758,164.3869 L758,230.39 A2.5,2.5 0 0 1 755.5,232.89 L516.5,232.89 A2.5,2.5 0 0 1 514,230.39 L514,142.09 A2.5,2.5 0 0 1 516.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="514" x2="722.7607" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="518" y="154.5851">recommendation-service</text></g><g id="cluster_review-service"><path d="M1132.5,139.59 L1248.5146,139.59 A3.75,3.75 0 0 1 1251.0146,142.09 L1258.0146,161.8869 L1297.5,161.8869 A2.5,2.5 0 0 1 1300,164.3869 L1300,230.39 A2.5,2.5 0 0 1 1297.5,232.89 L1132.5,232.89 A2.5,2.5 0 0 1 1130,230.39 L1130,142.09 A2.5,2.5 0 0 1 1132.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1130" x2="1258.0146" y1="161.8869" y2="161.8869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="1134" y="154.5851">review-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#FFA500" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><g id="elem_RecommendationService"><rect codeLine="8" fill="#FFA500" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="452.4326" x="409.78" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="548.3015" y="58.9951">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="410.78" x2="861.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="410.78" x2="861.2126" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="415.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><g id="elem_ReviewService"><rect codeLine="11" fill="#FFA500" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="306.2939" x="1061.85" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="1163.8368" y="58.9951">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="1062.85" x2="1367.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="1062.85" x2="1367.1439" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="1067.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><g id="elem_Product"><rect codeLine="15" fill="#FFA500" height="42.2969" id="Product" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="59.71" x="315.15" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="318.15" y="67.1451">Product</text><line style="stroke:#181818;stroke-width:0.5;" x1="316.15" x2="373.86" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="316.15" x2="373.86" y1="83.4469" y2="83.4469"/></g><g id="elem_Recommendation"><rect codeLine="16" fill="#FFA500" height="42.2969" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.6484" x="897.18" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="900.18" y="67.1451">Recommendation</text><line style="stroke:#181818;stroke-width:0.5;" x1="898.18" x2="1025.8284" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="898.18" x2="1025.8284" y1="83.4469" y2="83.4469"/></g><g id="elem_Review"><rect codeLine="17" fill="#FFA500" height="42.2969" id="Review" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56.5791" x="1402.71" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="1405.71" y="67.1451">Review</text><line style="stroke:#181818;stroke-width:0.5;" x1="1403.71" x2="1458.2891" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="1403.71" x2="1458.2891" y1="83.4469" y2="83.4469"/></g><g id="elem_ProductServiceImpl"><rect codeLine="25" fill="#F1F1F1" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.9941" x="80" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="83" y="192.5851">ProductService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="188.4512" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="81" x2="220.9941" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="81" x2="220.9941" y1="208.8869" y2="208.8869"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="28" fill="#F1F1F1" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.9326" x="530.03" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="533.03" y="192.5851">RecommendationService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="708.4196" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="531.03" x2="740.9626" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="531.03" x2="740.9626" y1="208.8869" y2="208.8869"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="31" fill="#F1F1F1" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8633" x="1145.57" y="174.59"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="1148.57" y="192.5851">ReviewService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="1250.8903" y="192.5851">Impl</text><line style="stroke:#181818;stroke-width:0.5;" x1="1146.57" x2="1283.4333" y1="200.8869" y2="200.8869"/><line style="stroke:#181818;stroke-width:0.5;" x1="1146.57" x2="1283.4333" y1="208.8869" y2="208.8869"/></g><g id="link_ProductService_Product"><path codeLine="19" d="M279.83,70.3 C291.45,70.3 297.08,70.3 308.71,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="314.71,70.3,305.71,66.3,309.71,70.3,305.71,74.3,314.71,70.3" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="20" d="M862.67,70.3 C874.05,70.3 879.43,70.3 890.82,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="896.82,70.3,887.82,66.3,891.82,70.3,887.82,74.3,896.82,70.3" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_Review"><path codeLine="21" d="M1368.56,70.3 C1379.78,70.3 1385,70.3 1396.22,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="1402.22,70.3,1393.22,66.3,1397.22,70.3,1393.22,74.3,1402.22,70.3" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="34" d="M151,117.93 C151,140.72 151,154.06 151,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="151,99.93,145,117.93,157,117.93,151,99.93" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="35" d="M636,117.93 C636,140.72 636,154.06 636,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="636,99.93,630,117.93,642,117.93,636,99.93" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="36" d="M1215,117.93 C1215,140.72 1215,154.06 1215,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1215,99.93,1209,117.93,1221,117.93,1215,99.93" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="239px" preserveAspectRatio="xMidYMid meet" style="width:1482px;height:239px;background:#1B1B1B;" version="1.1" viewBox="0 0 1482 239" width="1482px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="239" style="stroke:#FFFFFF00;stroke-width:1;" width="1482" x="0" y="0"/><g id="cluster_api"><path d="M8.5,6 L33.7676,6 A3.75,3.75 0 0 1 36.2676,8.5 L43.2676,28.2969 L1472.5,28.2969 A2.5,2.5 0 0 1 1475,30.7969 L1475,113.09 A2.5,2.5 0 0 1 1472.5,115.59 L8.5,115.59 A2.5,2.5 0 0 1 6,113.09 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="43.2676" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="10" y="20.9951">api</text></g><g id="cluster_product-service"><path d="M66.5,139.59 L191.2852,139.59 A3.75,3.75 0 0 1 193.7852,142.09 L200.7852,161.8869 L235.5,161.8869 A2.5,2.5 0 0 1 238,164.3869 L238,230.39 A2.5,2.5 0 0 1 235.5,232.89 L66.5,232.89 A2.5,2.5 0 0 1 64,230.39 L64,142.09 A2.5,2.5 0 0 1 66.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="64" x2="200.7852" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123.7852" x="68" y="154.5851">product-service</text></g><g id="cluster_recommendation-service"><path d="M516.5,139.59 L713.2607,139.59 A3.75,3.75 0 0 1 715.7607,142.09 L722.7607,161.8869 L755.5,161.8869 A2.5,2.5 0 0 1 758,164.3869 L758,230.39 A2.5,2.5 0 0 1 755.5,232.89 L516.5,232.89 A2.5,2.5 0 0 1 514,230.39 L514,142.09 A2.5,2.5 0 0 1 516.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="514" x2="722.7607" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="195.7607" x="518" y="154.5851">recommendation-service</text></g><g id="cluster_review-service"><path d="M1132.5,139.59 L1248.5146,139.59 A3.75,3.75 0 0 1 1251.0146,142.09 L1258.0146,161.8869 L1297.5,161.8869 A2.5,2.5 0 0 1 1300,164.3869 L1300,230.39 A2.5,2.5 0 0 1 1297.5,232.89 L1132.5,232.89 A2.5,2.5 0 0 1 1130,230.39 L1130,142.09 A2.5,2.5 0 0 1 1132.5,139.59 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1130" x2="1258.0146" y1="161.8869" y2="161.8869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115.0146" x="1134" y="154.5851">review-service</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#FFA500" height="58.5938" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="257.3281" x="22.34" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="98.2785" y="58.9951">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.34" x2="278.6681" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245.3281" x="28.34" y="92.292">getProduct(productId: Int): Product</text></g><g id="elem_RecommendationService"><rect codeLine="8" fill="#FFA500" height="58.5938" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="452.4326" x="409.78" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="548.3015" y="58.9951">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="410.78" x2="861.2126" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="410.78" x2="861.2126" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440.4326" x="415.78" y="92.292">getRecommendations(productId: Int): List&lt;Recommendation&gt;</text></g><g id="elem_ReviewService"><rect codeLine="11" fill="#FFA500" height="58.5938" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="306.2939" x="1061.85" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="1163.8368" y="58.9951">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1062.85" x2="1367.1439" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1062.85" x2="1367.1439" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294.2939" x="1067.85" y="92.292">getReviews(productId: Int): List&lt;Review&gt;</text></g><g id="elem_Product"><rect codeLine="15" fill="#FFA500" height="42.2969" id="Product" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="59.71" x="315.15" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.71" x="318.15" y="67.1451">Product</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="316.15" x2="373.86" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="316.15" x2="373.86" y1="83.4469" y2="83.4469"/></g><g id="elem_Recommendation"><rect codeLine="16" fill="#FFA500" height="42.2969" id="Recommendation" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="129.6484" x="897.18" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.6484" x="900.18" y="67.1451">Recommendation</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="898.18" x2="1025.8284" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="898.18" x2="1025.8284" y1="83.4469" y2="83.4469"/></g><g id="elem_Review"><rect codeLine="17" fill="#FFA500" height="42.2969" id="Review" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="56.5791" x="1402.71" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.5791" x="1405.71" y="67.1451">Review</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1403.71" x2="1458.2891" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1403.71" x2="1458.2891" y1="83.4469" y2="83.4469"/></g><g id="elem_ProductServiceImpl"><rect codeLine="25" fill="#313139" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.9941" x="80" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.4512" x="83" y="192.5851">ProductService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="188.4512" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="81" x2="220.9941" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="81" x2="220.9941" y1="208.8869" y2="208.8869"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="28" fill="#313139" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="211.9326" x="530.03" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.3896" x="533.03" y="192.5851">RecommendationService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="708.4196" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="531.03" x2="740.9626" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="531.03" x2="740.9626" y1="208.8869" y2="208.8869"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="31" fill="#313139" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="138.8633" x="1145.57" y="174.59"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.3203" x="1148.57" y="192.5851">ReviewService</text><text fill="#FFA500" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.543" x="1250.8903" y="192.5851">Impl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1146.57" x2="1283.4333" y1="200.8869" y2="200.8869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1146.57" x2="1283.4333" y1="208.8869" y2="208.8869"/></g><g id="link_ProductService_Product"><path codeLine="19" d="M279.83,70.3 C291.45,70.3 297.08,70.3 308.71,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-to-Product" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="314.71,70.3,305.71,66.3,309.71,70.3,305.71,74.3,314.71,70.3" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_Recommendation"><path codeLine="20" d="M862.67,70.3 C874.05,70.3 879.43,70.3 890.82,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-to-Recommendation" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="896.82,70.3,887.82,66.3,891.82,70.3,887.82,74.3,896.82,70.3" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_Review"><path codeLine="21" d="M1368.56,70.3 C1379.78,70.3 1385,70.3 1396.22,70.3 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-to-Review" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="1402.22,70.3,1393.22,66.3,1397.22,70.3,1393.22,74.3,1402.22,70.3" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="34" d="M151,117.93 C151,140.72 151,154.06 151,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="151,99.93,145,117.93,157,117.93,151,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="35" d="M636,117.93 C636,140.72 636,154.06 636,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="636,99.93,630,117.93,642,117.93,636,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="36" d="M1215,117.93 C1215,140.72 1215,154.06 1215,174.36 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1215,99.93,1209,117.93,1221,117.93,1215,99.93" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<ul>
<li>將 <code>ProductService</code>, <code>RecommendationService</code>, <code>ReviewService</code> 抽成 interface 放到 <code>api</code> 下。<ul>
<li>先重新命名既有的 class，加上後墜 <code>Impl</code>。(使用 <span class="keys"><kbd class="key-shift">Shift</kbd><span>+</span><kbd class="key-f6">F6</kbd></span> 或 vim <span class="keys"><kbd>\rn</kbd></span> )</li>
<li>抽 interface (使用 <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-t">T</kbd></span> &gt; Extract Interface...)</li>
</ul>
</li>
<li>將 <code>Product</code>, <code>Recomendation</code>, <code>Review</code> 移動到 <code>api</code> 下。<ul>
<li>使用 <span class="keys"><kbd class="key-f6">F6</kbd></span></li>
</ul>
</li>
</ul>
<h3 id="product-composite-api">Product Composite API</h3>
<div class='puml-container'><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="490px" preserveAspectRatio="xMidYMid meet" style="width:1397px;height:490px;background:#FFFFFF;" version="1.1" viewBox="0 0 1397 490" width="1397px" zoomAndPan="magnify" class="diagram"><defs/><g><g id="cluster_api"><path d="M763.5,14.15 L788.7676,14.15 A3.75,3.75 0 0 1 791.2676,16.65 L798.2676,36.4469 L1261.5,36.4469 A2.5,2.5 0 0 1 1264,38.9469 L1264,104.95 A2.5,2.5 0 0 1 1261.5,107.45 L763.5,107.45 A2.5,2.5 0 0 1 761,104.95 L761,16.65 A2.5,2.5 0 0 1 763.5,14.15 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="761" x2="798.2676" y1="36.4469" y2="36.4469"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="765" y="29.1451">api</text></g><g id="cluster_product-composite"><path d="M8.5,6 L158.2979,6 A3.75,3.75 0 0 1 160.7979,8.5 L167.7979,28.2969 L727.5,28.2969 A2.5,2.5 0 0 1 730,30.7969 L730,480.66 A2.5,2.5 0 0 1 727.5,483.16 L8.5,483.16 A2.5,2.5 0 0 1 6,480.66 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="167.7979" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.7979" x="10" y="20.9951">product-composite</text></g><g id="cluster_product"><path d="M756.5,173.49 L819.0234,173.49 A3.75,3.75 0 0 1 821.5234,175.99 L828.5234,195.7869 L925.5,195.7869 A2.5,2.5 0 0 1 928,198.2869 L928,264.28 A2.5,2.5 0 0 1 925.5,266.78 L756.5,266.78 A2.5,2.5 0 0 1 754,264.28 L754,175.99 A2.5,2.5 0 0 1 756.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="754" x2="828.5234" y1="195.7869" y2="195.7869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="61.5234" x="758" y="188.4851">product</text></g><g id="cluster_review"><path d="M1222.5,173.49 L1276.2529,173.49 A3.75,3.75 0 0 1 1278.7529,175.99 L1285.7529,195.7869 L1387.5,195.7869 A2.5,2.5 0 0 1 1390,198.2869 L1390,264.28 A2.5,2.5 0 0 1 1387.5,266.78 L1222.5,266.78 A2.5,2.5 0 0 1 1220,264.28 L1220,175.99 A2.5,2.5 0 0 1 1222.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1220" x2="1285.7529" y1="195.7869" y2="195.7869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.7529" x="1224" y="188.4851">review</text></g><g id="cluster_recommendation"><path d="M954.5,173.49 L1088.999,173.49 A3.75,3.75 0 0 1 1091.499,175.99 L1098.499,195.7869 L1193.5,195.7869 A2.5,2.5 0 0 1 1196,198.2869 L1196,264.28 A2.5,2.5 0 0 1 1193.5,266.78 L954.5,266.78 A2.5,2.5 0 0 1 952,264.28 L952,175.99 A2.5,2.5 0 0 1 954.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="952" x2="1098.499" y1="195.7869" y2="195.7869"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="133.499" x="956" y="188.4851">recommendation</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#F1F1F1" height="42.2969" id="ProductService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.4512" x="777.27" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="780.27" y="67.1451">ProductService</text><line style="stroke:#181818;stroke-width:0.5;" x1="778.27" x2="887.7212" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="778.27" x2="887.7212" y1="83.4469" y2="83.4469"/></g><g id="elem_RecommendationService"><rect codeLine="6" fill="#F1F1F1" height="42.2969" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.3896" x="923.31" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="926.31" y="67.1451">RecommendationService</text><line style="stroke:#181818;stroke-width:0.5;" x1="924.31" x2="1103.6996" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="924.31" x2="1103.6996" y1="83.4469" y2="83.4469"/></g><g id="elem_ReviewService"><rect codeLine="7" fill="#F1F1F1" height="42.2969" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.3203" x="1139.84" y="49.15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="1142.84" y="67.1451">ReviewService</text><line style="stroke:#181818;stroke-width:0.5;" x1="1140.84" x2="1247.1603" y1="75.4469" y2="75.4469"/><line style="stroke:#181818;stroke-width:0.5;" x1="1140.84" x2="1247.1603" y1="83.4469" y2="83.4469"/></g><g id="elem_ProductCompositeService"><rect codeLine="11" fill="#F1F1F1" height="58.5938" id="ProductCompositeService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="330.6162" x="86.69" y="41"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180.168" x="161.9141" y="58.9951">ProductCompositeService</text><line style="stroke:#181818;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="67.2969" y2="67.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="75.2969" y2="75.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318.6162" x="92.69" y="92.292">getProduct(productId: Int): ProductAggregate</text></g><path d="M452.27,52.73 L452.27,61.2964 L411.3062,87.4453 L452.27,69.2964 L452.27,77.8628 A0,0 0 0 0 452.27,77.8628 L713.7319,77.8628 A0,0 0 0 0 713.7319,77.8628 L713.7319,62.73 L703.7319,52.73 L452.27,52.73 A0,0 0 0 0 452.27,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M703.7319,52.73 L703.7319,62.73 L713.7319,62.73 L703.7319,52.73 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.4619" x="458.27" y="69.7969">GET /product-composite/{productId}</text><g id="elem_ProductCompositeIntegration"><rect codeLine="18" fill="#F1F1F1" height="42.2969" id="ProductCompositeIntegration" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.5703" x="502.21" y="208.49"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.5703" x="505.21" y="226.4851">ProductCompositeIntegration</text><line style="stroke:#181818;stroke-width:0.5;" x1="503.21" x2="712.7803" y1="234.7869" y2="234.7869"/><line style="stroke:#181818;stroke-width:0.5;" x1="503.21" x2="712.7803" y1="242.7869" y2="242.7869"/></g><g id="elem_ProductAggregate"><rect codeLine="20" fill="#F1F1F1" height="140.0781" id="ProductAggregate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="387.375" x="69.31" y="159.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.998" x="199.4985" y="177.5951">ProductAggregate</text><line style="stroke:#181818;stroke-width:0.5;" x1="70.31" x2="455.685" y1="185.8969" y2="185.8969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="75.31" y="202.892">productId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="75.31" y="219.1889">name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="75.31" y="235.4857">weight: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="375.375" x="75.31" y="251.7826">recommendations: List&lt;RecommendationSummary&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.2363" x="75.31" y="268.0795">reviews: List&lt;ReviewSummary&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.4863" x="75.31" y="284.3764">serviceAddresses: ServiceAddresses</text><line style="stroke:#181818;stroke-width:0.5;" x1="70.31" x2="455.685" y1="291.6781" y2="291.6781"/></g><g id="elem_RecommendationSummary"><rect codeLine="29" fill="#F1F1F1" height="91.1875" id="RecommendationSummary" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.3037" x="22.35" y="367.82"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191.3037" x="25.35" y="385.8151">RecommendationSummary</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="394.1169" y2="394.1169"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="28.35" y="411.112">recommendationId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="28.35" y="427.4089">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="28.35" y="443.7057">rate: Int</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="451.0075" y2="451.0075"/></g><g id="elem_ReviewSummary"><rect codeLine="35" fill="#F1F1F1" height="91.1875" id="ReviewSummary" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.2344" x="254.88" y="367.82"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2344" x="257.88" y="385.8151">ReviewSummary</text><line style="stroke:#181818;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="394.1169" y2="394.1169"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="260.88" y="411.112">reviewId: Int</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="260.88" y="427.4089">author: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="260.88" y="443.7057">subject: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="451.0075" y2="451.0075"/></g><g id="elem_ServiceAddresses"><rect codeLine="41" fill="#F1F1F1" height="107.4844" id="ServiceAddresses" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="299.6426" x="414.18" y="359.68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.9561" x="502.0233" y="377.6751">ServiceAddresses</text><line style="stroke:#181818;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="385.9769" y2="385.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="420.18" y="402.972">cmp: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.0225" x="505.8001" y="402.972"># product composite service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.1563" x="420.18" y="419.2689">pro: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.9336" x="498.7864" y="419.2689"># product service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6025" x="420.18" y="435.5657">rev: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3867" x="498.2327" y="435.5657"># review service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.0146" x="420.18" y="451.8626">rec: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.4561" x="497.6448" y="451.8626"># recommendation service</text><line style="stroke:#181818;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="459.1644" y2="459.1644"/></g><g id="elem_ProductServiceImpl"><rect codeLine="56" fill="#F1F1F1" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.9941" x="770" y="208.49"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.9941" x="773" y="226.4851">ProductServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="910.9941" y1="234.7869" y2="234.7869"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="910.9941" y1="242.7869" y2="242.7869"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="60" fill="#F1F1F1" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8633" x="1235.57" y="208.49"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.8633" x="1238.57" y="226.4851">ReviewServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="1236.57" x2="1373.4333" y1="234.7869" y2="234.7869"/><line style="stroke:#181818;stroke-width:0.5;" x1="1236.57" x2="1373.4333" y1="242.7869" y2="242.7869"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="64" fill="#F1F1F1" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.9326" x="968.03" y="208.49"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.9326" x="971.03" y="226.4851">RecommendationServiceImpl</text><line style="stroke:#181818;stroke-width:0.5;" x1="969.03" x2="1178.9626" y1="234.7869" y2="234.7869"/><line style="stroke:#181818;stroke-width:0.5;" x1="969.03" x2="1178.9626" y1="242.7869" y2="242.7869"/></g><g id="link_ProductCompositeService_ProductAggregate"><path codeLine="48" d="M253.99,99.79 C255.16,116.44 256.2623,132.2446 257.7223,153.1646 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductAggregate" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="258.14,159.15,261.5037,149.8934,257.7919,154.1621,253.5231,150.4503,258.14,159.15" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductCompositeService_ProductCompositeIntegration"><path codeLine="49" d="M329.57,100.03 C372.56,116.48 426.72,138.08 474,159.6 C507.11,174.67 538.4832,190.8928 565.0732,205.1628 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductCompositeIntegration" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="570.36,208,564.3213,200.2196,565.9544,205.6356,560.5383,207.2687,570.36,208" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_RecommendationSummary"><path codeLine="50" d="M208.71,300.14 C191.09,322.69 175.7136,342.3717 159.8636,362.6617 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-RecommendationSummary" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="156.17,367.39,164.8627,362.7599,159.248,363.4497,158.5582,357.8351,156.17,367.39" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_ReviewSummary"><path codeLine="51" d="M283.65,300.14 C290.35,322.69 295.8933,341.3478 301.9133,361.6378 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ReviewSummary" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="303.62,367.39,304.8948,357.624,302.1978,362.5965,297.2252,359.8995,303.62,367.39" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductAggregate_ServiceAddresses"><path codeLine="52" d="M378.08,300.14 C410.61,319.78 440.3439,337.7383 470.9939,356.2483 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ServiceAddresses" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="476.13,359.35,470.4937,351.2733,471.8499,356.7652,466.3581,358.1214,476.13,359.35" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="67" d="M834.9623,109.8469 C836.4923,139.9969 838.42,177.91 839.95,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="834.05,91.87,828.97,110.151,840.9545,109.5428,834.05,91.87" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="68" d="M1028.2549,108.6881 C1039.7549,138.8381 1054.65,177.91 1066.15,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1021.84,91.87,1022.6488,110.8264,1033.8609,106.5498,1021.84,91.87" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="69" d="M1218.8863,106.5783 C1240.1563,136.7283 1269.21,177.91 1290.49,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1208.51,91.87,1213.9835,110.037,1223.789,103.1195,1208.51,91.87" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ProductService_ProductCompositeIntegration"><path codeLine="70" d="M788.8372,102.1829 C745.7072,132.3329 680.55,177.91 637.42,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductCompositeIntegration" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="803.59,91.87,785.3996,97.2653,792.2749,107.1005,803.59,91.87" style="stroke:#181818;stroke-width:1;"/></g><g id="link_RecommendationService_ProductCompositeIntegration"><path codeLine="71" d="M950.222,98.7807 C931.462,106.6207 926.18,108.42 906,115.45 C839.57,138.6 819.78,134.67 754,159.6 C716.9,173.65 676.21,193.26 647.23,207.99 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-ProductCompositeIntegration" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="966.83,91.84,947.9084,93.2447,952.5355,104.3167,966.83,91.84" style="stroke:#181818;stroke-width:1;"/></g><g id="link_ReviewService_ProductCompositeIntegration"><path codeLine="72" d="M1151.7613,101.9666 C1138.8613,110.6566 1137.79,109.96 1122,115.45 C966.41,169.56 912.29,113.99 754,159.6 C714.26,171.05 671.85,192.22 643.03,208.12 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ProductCompositeIntegration" style="stroke:#181818;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1166.69,91.91,1148.4091,96.9904,1155.1135,106.9428,1166.69,91.91" style="stroke:#181818;stroke-width:1;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="490px" preserveAspectRatio="xMidYMid meet" style="width:1397px;height:490px;background:#1B1B1B;" version="1.1" viewBox="0 0 1397 490" width="1397px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="490" style="stroke:#FFFFFF00;stroke-width:1;" width="1397" x="0" y="0"/><g id="cluster_api"><path d="M763.5,14.15 L788.7676,14.15 A3.75,3.75 0 0 1 791.2676,16.65 L798.2676,36.4469 L1261.5,36.4469 A2.5,2.5 0 0 1 1264,38.9469 L1264,104.95 A2.5,2.5 0 0 1 1261.5,107.45 L763.5,107.45 A2.5,2.5 0 0 1 761,104.95 L761,16.65 A2.5,2.5 0 0 1 763.5,14.15 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="761" x2="798.2676" y1="36.4469" y2="36.4469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24.2676" x="765" y="29.1451">api</text></g><g id="cluster_product-composite"><path d="M8.5,6 L158.2979,6 A3.75,3.75 0 0 1 160.7979,8.5 L167.7979,28.2969 L727.5,28.2969 A2.5,2.5 0 0 1 730,30.7969 L730,480.66 A2.5,2.5 0 0 1 727.5,483.16 L8.5,483.16 A2.5,2.5 0 0 1 6,480.66 L6,8.5 A2.5,2.5 0 0 1 8.5,6 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="167.7979" y1="28.2969" y2="28.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.7979" x="10" y="20.9951">product-composite</text></g><g id="cluster_product"><path d="M756.5,173.49 L819.0234,173.49 A3.75,3.75 0 0 1 821.5234,175.99 L828.5234,195.7869 L925.5,195.7869 A2.5,2.5 0 0 1 928,198.2869 L928,264.28 A2.5,2.5 0 0 1 925.5,266.78 L756.5,266.78 A2.5,2.5 0 0 1 754,264.28 L754,175.99 A2.5,2.5 0 0 1 756.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="754" x2="828.5234" y1="195.7869" y2="195.7869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="61.5234" x="758" y="188.4851">product</text></g><g id="cluster_review"><path d="M1222.5,173.49 L1276.2529,173.49 A3.75,3.75 0 0 1 1278.7529,175.99 L1285.7529,195.7869 L1387.5,195.7869 A2.5,2.5 0 0 1 1390,198.2869 L1390,264.28 A2.5,2.5 0 0 1 1387.5,266.78 L1222.5,266.78 A2.5,2.5 0 0 1 1220,264.28 L1220,175.99 A2.5,2.5 0 0 1 1222.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1220" x2="1285.7529" y1="195.7869" y2="195.7869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="52.7529" x="1224" y="188.4851">review</text></g><g id="cluster_recommendation"><path d="M954.5,173.49 L1088.999,173.49 A3.75,3.75 0 0 1 1091.499,175.99 L1098.499,195.7869 L1193.5,195.7869 A2.5,2.5 0 0 1 1196,198.2869 L1196,264.28 A2.5,2.5 0 0 1 1193.5,266.78 L954.5,266.78 A2.5,2.5 0 0 1 952,264.28 L952,175.99 A2.5,2.5 0 0 1 954.5,173.49 " fill="#FFFFFF" fill-opacity="0.00000" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="952" x2="1098.499" y1="195.7869" y2="195.7869"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="133.499" x="956" y="188.4851">recommendation</text></g><g id="elem_ProductService"><rect codeLine="5" fill="#313139" height="42.2969" id="ProductService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="111.4512" x="777.27" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="105.4512" x="780.27" y="67.1451">ProductService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="778.27" x2="887.7212" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="778.27" x2="887.7212" y1="83.4469" y2="83.4469"/></g><g id="elem_RecommendationService"><rect codeLine="6" fill="#313139" height="42.2969" id="RecommendationService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="181.3896" x="923.31" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="175.3896" x="926.31" y="67.1451">RecommendationService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="924.31" x2="1103.6996" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="924.31" x2="1103.6996" y1="83.4469" y2="83.4469"/></g><g id="elem_ReviewService"><rect codeLine="7" fill="#313139" height="42.2969" id="ReviewService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="108.3203" x="1139.84" y="49.15"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102.3203" x="1142.84" y="67.1451">ReviewService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1140.84" x2="1247.1603" y1="75.4469" y2="75.4469"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1140.84" x2="1247.1603" y1="83.4469" y2="83.4469"/></g><g id="elem_ProductCompositeService"><rect codeLine="11" fill="#313139" height="58.5938" id="ProductCompositeService" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="330.6162" x="86.69" y="41"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180.168" x="161.9141" y="58.9951">ProductCompositeService</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="67.2969" y2="67.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="87.69" x2="416.3062" y1="75.2969" y2="75.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318.6162" x="92.69" y="92.292">getProduct(productId: Int): ProductAggregate</text></g><path d="M452.27,52.73 L452.27,61.2964 L411.3062,87.4453 L452.27,69.2964 L452.27,77.8628 A0,0 0 0 0 452.27,77.8628 L713.7319,77.8628 A0,0 0 0 0 713.7319,77.8628 L713.7319,62.73 L703.7319,52.73 L452.27,52.73 A0,0 0 0 0 452.27,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M703.7319,52.73 L703.7319,62.73 L713.7319,62.73 L703.7319,52.73 " fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.4619" x="458.27" y="69.7969">GET /product-composite/{productId}</text><g id="elem_ProductCompositeIntegration"><rect codeLine="18" fill="#313139" height="42.2969" id="ProductCompositeIntegration" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="211.5703" x="502.21" y="208.49"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.5703" x="505.21" y="226.4851">ProductCompositeIntegration</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="503.21" x2="712.7803" y1="234.7869" y2="234.7869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="503.21" x2="712.7803" y1="242.7869" y2="242.7869"/></g><g id="elem_ProductAggregate"><rect codeLine="20" fill="#313139" height="140.0781" id="ProductAggregate" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="387.375" x="69.31" y="159.6"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.998" x="199.4985" y="177.5951">ProductAggregate</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="70.31" x2="455.685" y1="185.8969" y2="185.8969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.8281" x="75.31" y="202.892">productId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.6514" x="75.31" y="219.1889">name: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.8604" x="75.31" y="235.4857">weight: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="375.375" x="75.31" y="251.7826">recommendations: List&lt;RecommendationSummary&gt;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.2363" x="75.31" y="268.0795">reviews: List&lt;ReviewSummary&gt;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.4863" x="75.31" y="284.3764">serviceAddresses: ServiceAddresses</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="70.31" x2="455.685" y1="291.6781" y2="291.6781"/></g><g id="elem_RecommendationSummary"><rect codeLine="29" fill="#313139" height="91.1875" id="RecommendationSummary" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="197.3037" x="22.35" y="367.82"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191.3037" x="25.35" y="385.8151">RecommendationSummary</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="394.1169" y2="394.1169"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3506" x="28.35" y="411.112">recommendationId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="28.35" y="427.4089">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0957" x="28.35" y="443.7057">rate: Int</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="23.35" x2="218.6537" y1="451.0075" y2="451.0075"/></g><g id="elem_ReviewSummary"><rect codeLine="35" fill="#313139" height="91.1875" id="ReviewSummary" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="124.2344" x="254.88" y="367.82"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2344" x="257.88" y="385.8151">ReviewSummary</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="394.1169" y2="394.1169"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2813" x="260.88" y="411.112">reviewId: Int</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.084" x="260.88" y="427.4089">author: String</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.6914" x="260.88" y="443.7057">subject: String</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="255.88" x2="378.1144" y1="451.0075" y2="451.0075"/></g><g id="elem_ServiceAddresses"><rect codeLine="41" fill="#313139" height="107.4844" id="ServiceAddresses" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="299.6426" x="414.18" y="359.68"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123.9561" x="502.0233" y="377.6751">ServiceAddresses</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="385.9769" y2="385.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="420.18" y="402.972">cmp: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.0225" x="505.8001" y="402.972"># product composite service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.1563" x="420.18" y="419.2689">pro: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.9336" x="498.7864" y="419.2689"># product service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.6025" x="420.18" y="435.5657">rev: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.3867" x="498.2327" y="435.5657"># review service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.0146" x="420.18" y="451.8626">rec: String</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190.4561" x="497.6448" y="451.8626"># recommendation service</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="415.18" x2="712.8226" y1="459.1644" y2="459.1644"/></g><g id="elem_ProductServiceImpl"><rect codeLine="56" fill="#313139" height="42.2969" id="ProductServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.9941" x="770" y="208.49"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.9941" x="773" y="226.4851">ProductServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="771" x2="910.9941" y1="234.7869" y2="234.7869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="771" x2="910.9941" y1="242.7869" y2="242.7869"/></g><g id="elem_ReviewServiceImpl"><rect codeLine="60" fill="#313139" height="42.2969" id="ReviewServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="138.8633" x="1235.57" y="208.49"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.8633" x="1238.57" y="226.4851">ReviewServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1236.57" x2="1373.4333" y1="234.7869" y2="234.7869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="1236.57" x2="1373.4333" y1="242.7869" y2="242.7869"/></g><g id="elem_RecommendationServiceImpl"><rect codeLine="64" fill="#313139" height="42.2969" id="RecommendationServiceImpl" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="211.9326" x="968.03" y="208.49"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.9326" x="971.03" y="226.4851">RecommendationServiceImpl</text><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="969.03" x2="1178.9626" y1="234.7869" y2="234.7869"/><line style="stroke:#E7E7E7;stroke-width:0.5;" x1="969.03" x2="1178.9626" y1="242.7869" y2="242.7869"/></g><g id="link_ProductCompositeService_ProductAggregate"><path codeLine="48" d="M253.99,99.79 C255.16,116.44 256.2623,132.2446 257.7223,153.1646 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductAggregate" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#E7E7E7" points="258.14,159.15,261.5037,149.8934,257.7919,154.1621,253.5231,150.4503,258.14,159.15" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductCompositeService_ProductCompositeIntegration"><path codeLine="49" d="M329.57,100.03 C372.56,116.48 426.72,138.08 474,159.6 C507.11,174.67 538.4832,190.8928 565.0732,205.1628 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductCompositeService-to-ProductCompositeIntegration" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="570.36,208,564.3213,200.2196,565.9544,205.6356,560.5383,207.2687,570.36,208" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_RecommendationSummary"><path codeLine="50" d="M208.71,300.14 C191.09,322.69 175.7136,342.3717 159.8636,362.6617 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-RecommendationSummary" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="156.17,367.39,164.8627,362.7599,159.248,363.4497,158.5582,357.8351,156.17,367.39" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_ReviewSummary"><path codeLine="51" d="M283.65,300.14 C290.35,322.69 295.8933,341.3478 301.9133,361.6378 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ReviewSummary" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="303.62,367.39,304.8948,357.624,302.1978,362.5965,297.2252,359.8995,303.62,367.39" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductAggregate_ServiceAddresses"><path codeLine="52" d="M378.08,300.14 C410.61,319.78 440.3439,337.7383 470.9939,356.2483 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductAggregate-to-ServiceAddresses" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="476.13,359.35,470.4937,351.2733,471.8499,356.7652,466.3581,358.1214,476.13,359.35" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductService_ProductServiceImpl"><path codeLine="67" d="M834.9623,109.8469 C836.4923,139.9969 838.42,177.91 839.95,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="834.05,91.87,828.97,110.151,840.9545,109.5428,834.05,91.87" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_RecommendationServiceImpl"><path codeLine="68" d="M1028.2549,108.6881 C1039.7549,138.8381 1054.65,177.91 1066.15,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-RecommendationServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1021.84,91.87,1022.6488,110.8264,1033.8609,106.5498,1021.84,91.87" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_ReviewServiceImpl"><path codeLine="69" d="M1218.8863,106.5783 C1240.1563,136.7283 1269.21,177.91 1290.49,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ReviewServiceImpl" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1208.51,91.87,1213.9835,110.037,1223.789,103.1195,1208.51,91.87" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ProductService_ProductCompositeIntegration"><path codeLine="70" d="M788.8372,102.1829 C745.7072,132.3329 680.55,177.91 637.42,208.06 " fill="#FFFFFF" fill-opacity="0.00000" id="ProductService-backto-ProductCompositeIntegration" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="803.59,91.87,785.3996,97.2653,792.2749,107.1005,803.59,91.87" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_RecommendationService_ProductCompositeIntegration"><path codeLine="71" d="M950.222,98.7807 C931.462,106.6207 926.18,108.42 906,115.45 C839.57,138.6 819.78,134.67 754,159.6 C716.9,173.65 676.21,193.26 647.23,207.99 " fill="#FFFFFF" fill-opacity="0.00000" id="RecommendationService-backto-ProductCompositeIntegration" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="966.83,91.84,947.9084,93.2447,952.5355,104.3167,966.83,91.84" style="stroke:#E7E7E7;stroke-width:1;"/></g><g id="link_ReviewService_ProductCompositeIntegration"><path codeLine="72" d="M1151.7613,101.9666 C1138.8613,110.6566 1137.79,109.96 1122,115.45 C966.41,169.56 912.29,113.99 754,159.6 C714.26,171.05 671.85,192.22 643.03,208.12 " fill="#FFFFFF" fill-opacity="0.00000" id="ReviewService-backto-ProductCompositeIntegration" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1166.69,91.91,1148.4091,96.9904,1155.1135,106.9428,1166.69,91.91" style="stroke:#E7E7E7;stroke-width:1;"/></g></g></svg></div></div>

<h4 id="test-get-product_1">Test: Get product</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@EnableWireMock</span><span class="p">(</span><span class="n">ConfigureWireMock</span><span class="p">(</span><span class="n">portProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;app.product-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.recommendation-service.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app.review-service.port&quot;</span><span class="o">]</span><span class="p">))</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">ProductCompositeServiceApplicationTests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">`get product by product id`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span><span class="n">okJson</span><span class="p">(</span><span class="s">&quot;&quot;&quot; { &quot;productId&quot;: 1, &quot;name&quot;: &quot;product 1&quot;, &quot;weight&quot;: 123, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7001&quot; } &quot;&quot;&quot;</span><span class="p">)))</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/recommendation?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;recommendationId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 1, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 2, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; },</span>
<span class="s">                        { &quot;recommendationId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;rate&quot;: 3, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7002&quot; }</span>
<span class="s">                    ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">            </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/review?productId=1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">                </span><span class="n">okJson</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;&quot;&quot; [</span>
<span class="s">                        { &quot;reviewId&quot;: 1, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-1&quot;, &quot;content&quot;: &quot;content-1&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 2, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-2&quot;, &quot;content&quot;: &quot;content-2&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; },</span>
<span class="s">                        { &quot;reviewId&quot;: 3, &quot;productId&quot;: 1, &quot;author&quot;: &quot;Teddy&quot;, &quot;subject&quot;: &quot;subject-3&quot;, &quot;content&quot;: &quot;content-3&quot;, &quot;serviceAddress&quot;: &quot;localhost/127.0.0.1:7003&quot; }</span>
<span class="s">                        ] &quot;&quot;&quot;</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/1&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isOk</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.productId&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.recommendations.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.reviews.length()&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>使用 <code>RestTemplate</code> 串接 API</p>
<details class="tip">
<summary>使用 <code>RestTemplate</code> 配合 <code>ParameterizedTypeReference</code> 接收 List 處理 generic type 的問題</summary>
<div class="highlight"><span class="filename">Example</span><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getRecommendations</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span>
<span class="w">        </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;http://</span><span class="si">$</span><span class="n">recommendationServiceHost</span><span class="s">:</span><span class="si">$</span><span class="n">recommendationServicePort</span><span class="s">/recommendation?productId=</span><span class="si">$</span><span class="n">productId</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Recommendation</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">).</span><span class="na">body</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>逐步實作，分三個 subtask: <code>$.productId</code>, <code>$.recommendations.length()</code>, <code>$.reviews.length()</code>，一次做一個，還沒有做的 assertion 先註解起來。</p>
</li>
<li>定義 properties: microservices 的 host 與 port</li>
<li>Spring 建議的 Mock Server<ul>
<li><a href="https://docs.spring.io/spring-cloud-contract/docs/current/reference/html/project-features.html#features-wiremock">WireMockk</a> 這裡的測試使用這個</li>
<li><a href="https://docs.spring.io/spring-framework/reference/web/webflux-webclient/client-testing.html">MockWebServer</a></li>
</ul>
</li>
</ul>
<h4 id="test-get-product-not-found_1">Test: Get product not found</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product not found`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/13&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/13&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Product with productId=13 not found&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isNotFound</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/13&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Not found: 13&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="test-get-product-invalid-parameter">Test: Get product invalid parameter</h4>
<p>讓測試通過。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">`get product invalid parameter`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stubFor</span><span class="p">(</span>
<span class="w">        </span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/product/-1&quot;</span><span class="p">).</span><span class="na">willReturn</span><span class="p">(</span>
<span class="w">            </span><span class="n">jsonResponse</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;&quot;&quot;{&quot;timestamp&quot;:  </span><span class="si">${</span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;path&quot;: &quot;/product/-1&quot;, &quot;httpStatus&quot;: </span><span class="si">${</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="si">}</span><span class="s">, &quot;message&quot;: &quot;Invalid productId: -1&quot;}&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">.</span><span class="na">value</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">client</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">exchange</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectStatus</span><span class="p">().</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectHeader</span><span class="p">().</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">expectBody</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.path&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;/product-composite/-1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">jsonPath</span><span class="p">(</span><span class="s">&quot;</span><span class="err">$</span><span class="s">.message&quot;</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Invalid: -1&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="disable-gradle-build-to-generate-plain-jar-file">Disable gradle build to generate plain jar file</h2>
<p>預設 <code>gradle build</code> 會產生兩個 jar 檔案:</p>
<ol>
<li>ordinary JAR file</li>
<li>plain JAR file containing only the class files resulting from compiling the Java files in the Spring Boot application</li>
</ol>
<p>我們不需要第 2 個 jar 檔。設定 <code>build.gradle.kts</code> 讓 <code>gradle build</code> 僅產生第一個 jar 檔案。</p>
<details class="tip">
<summary>Tip</summary>
<p>在跟目錄新增檔案，加入以下設定。</p>
<div class="highlight"><span class="filename">build.gradle.kts</span><pre><span></span><code>subprojects {
    afterEvaluate {
        if (plugins.hasPlugin(&quot;org.springframework.boot&quot;)) {
            tasks.getByName(&quot;jar&quot;) {
                enabled = false
            }
        }
    }
}
</code></pre></div>
</details>
<h2 id="_2">手動測試</h2>
<ul>
<li>
<p>啟動 microservices</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>jar<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*-service-*.jar&quot;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>java<span class="w"> </span>-jar<span class="w"> </span><span class="nv">$jar</span><span class="w"> </span><span class="p">&amp;</span>
<span class="k">done</span>
</code></pre></div>
</li>
<li>
<p>測試 product-service, recommendation-service, review-service, product-composite-service 的 API。</p>
</li>
<li>
<p>停掉所有 microservices</p>
<div class="highlight"><pre><span></span><code>pkill<span class="w"> </span>-P<span class="w"> </span><span class="nv">$$</span>
</code></pre></div>
</li>
</ul>
<h2 id="_3">半自動化測試</h2>
<h3 id="curl-request-response-http-code">透過 <code>curl</code> 得到 request 的 response 與 http code</h3>
<ul>
<li>執行 <code>http://localhost:6000/product-composite/1</code> 將 response 與 http code 存到變數</li>
</ul>
<details class="tip">
<summary>Tip</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span><span class="w"> </span>curl<span class="w"> </span>http://localhost:6000/product-composite/1<span class="w"> </span>-s<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}&quot;</span><span class="k">)</span>
<span class="nv">http_code</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">:(-3)</span><span class="si">}</span>
<span class="nv">response</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">%???</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$response</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$http_code</span><span class="s2">&quot;</span>
</code></pre></div>
<ul>
<li><code>-w "%{http_code}"</code> 在結果後輸出 http code</li>
<li><code>http_code=${result:(-3)}</code> 擷取 result 的後三碼 http code</li>
<li><code>response=${result%???}</code> 移除 result 結尾三碼</li>
</ul>
</details>
<h3 id="assertcurl-http-code">撰寫 <code>assertCurl</code> 驗證 http code 符合預期</h3>
<ul>
<li><code>assertCurl ${expectedCode} ${curl}</code></li>
<li>符合預期，顯示 "Test OK"</li>
<li>不符合預期，顯示 "Test FAILED"，並提供以下訊息供 debug<ul>
<li>預期的 code 與實際的 code，</li>
<li>curl 指令</li>
<li>response body</li>
</ul>
</li>
<li>
<p>function</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span>name<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">$1</span><span class="w"> </span><span class="c1"># first argument</span>
<span class="w">    </span><span class="nv">$2</span><span class="w"> </span><span class="c1"># second argument</span>
<span class="o">}</span>
</code></pre></div>
</li>
<li>
<p>if-else statement</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>condition<span class="w"> </span><span class="o">]</span>
<span class="k">then</span>
<span class="w">    </span>statement
<span class="k">else</span>
<span class="w">    </span>statement
<span class="k">fi</span>
</code></pre></div>
<ul>
<li>Equal evaluation: <code>=</code></li>
</ul>
</li>
</ul>
<details class="tip">
<summary>Tip</summary>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span>assertCurl<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">expected_code</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span>-s<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="nv">http_code</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">:(-3)</span><span class="si">}</span>
<span class="w">    </span><span class="nv">response</span><span class="o">=</span><span class="si">${</span><span class="nv">result</span><span class="p">%???</span><span class="si">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$http_code</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$expected_code</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test OK&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test FAILED, expected code: </span><span class="nv">$expected_code</span><span class="s2">, got: </span><span class="nv">$http_code</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;- Failing command: </span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;- Response: </span><span class="nv">$response</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

assertCurl<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="s2">&quot;curl http://localhost:6000/product-composite/1&quot;</span>
</code></pre></div>
</details>
<h3 id="assertequal">撰寫 <code>assertEqual</code> 驗證兩個值是否相等</h3>
<ul>
<li>驗證 <code>productId</code> 為 <code>1</code><ul>
<li><code>$(echo "$response" | jq ".productId")</code> 從 response 擷取 <code>productId</code> 值</li>
</ul>
</li>
<li>驗證 <code>recommendations</code> 長度為 <code>3</code><ul>
<li><code>$(echo "$response" | jq ".recommendations | length")</code></li>
</ul>
</li>
<li>驗證 <code>reviews</code> 長度為 <code>3</code></li>
</ul>
<h3 id="test-product-not-found">Test: product not found</h3>
<ul>
<li><code>productId</code> 為 <code>13</code> 時，not found</li>
<li>status code: <code>404</code></li>
<li>assert message:<ul>
<li><code>jq -r ".."</code>: 用 <code>-r</code> 可以避免輸出字串的前後有雙引號</li>
</ul>
</li>
</ul>
<h3 id="test-product-no-recommendation">Test: product no recommendation</h3>
<ul>
<li><code>productId</code> 為 <code>113</code></li>
<li>status code: <code>200</code></li>
<li>assert recommendations 長度 <code>0</code>, reviews 長度 <code>3</code></li>
</ul>
<h3 id="test-product-no-reviews">Test: product no reviews</h3>
<ul>
<li><code>productId</code> 為 <code>213</code></li>
<li>status code: <code>200</code></li>
<li>assert recommendation 長度 <code>3</code>, reviews 長度 <code>0</code></li>
</ul>
<h3 id="test-product-id-is-negative_1">Test: product id is negative</h3>
<ul>
<li><code>prodictId</code> 為 <code>-1</code></li>
<li>status code: <code>422</code></li>
<li>assert message</li>
</ul>
<h3 id="test-product-is-in-not-integer">Test: product is in not integer</h3>
<ul>
<li><code>productId</code> 為 <code>no-integer</code></li>
<li>status code: <code>400</code></li>
<li>assert message</li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最後更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年2月1日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="建立日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年1月31日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到頂端
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2025 Teddy Lee
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.select", "content.code.annotate", "content.code.copy", "toc.integrate", "navigation.top", "content.footnote.tooltips", "content.tooltips"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../assets/mkdocs_puml/puml.js"></script>
      
        <script src="../../termynal.js"></script>
      
    
  </body>
</html>