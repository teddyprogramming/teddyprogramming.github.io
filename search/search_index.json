{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"java/effective-java/01_consider_static_factor_methods_instead_of_constructors/","title":"Item 1: Consider static factory methods instead of constructors","text":""},{"location":"java/effective-java/01_consider_static_factor_methods_instead_of_constructors/#_1","title":"\u512a\u9ede","text":"<p>\u504f\u597d static factory method \u7684\u512a\u9ede\uff1a</p> <ol> <li> <p>\u53ef\u4ee5\u63d0\u4f9b\u6709\u610f\u7fa9\u7684\u540d\u7a31\uff0c\u5e6b\u52a9\u95b1\u8b80\u7406\u89e3\u7684\u540d\u7a31</p> <ul> <li><code>BigInteger.probablePrime</code> \u6bd4 <code>BigInteger(int, int, Random)</code> \u66f4\u5bb9\u6613\u7406\u89e3\u3002</li> <li>constructor \u4e4b\u9593\u53ea\u80fd\u5920\u900f\u904e\u53c3\u6578\u578b\u5225\u4e0d\u540c\u4f86\u52a0\u4ee5\u5340\u9694\uff0c\u958b\u767c\u4eba\u54e1\u9700\u8981\u77e5\u9053\u9019\u4e9b\u4e0d\u540c constructor \u5c0d\u61c9\u7684\u5be6\u4f5c\u3002\u4f46\u662f\uff0c\u4ed6\u5011\u4e5f\u53ef\u80fd\u6703\u8a18\u932f\u800c\u8aa4\u7528\u3002\u4f8b\u5982\uff0c\u6211\u5011\u6709\u8fa6\u6cd5\u5340\u5206 <code>BigInteger(int[])</code>, <code>BigInteger(int[], int)</code>, <code>BigInteger(int, int[])</code> \u4ed6\u5011\u7684\u4e0d\u540c\u55ce\uff1f</li> </ul> </li> <li> <p>\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u5efa\u7acb\u65b0\u7269\u4ef6</p> <ul> <li>\u5957\u7528 Flyweight pattern, Singleton pattern</li> <li>\u53ef\u4ee5\u907f\u514d\u5efa\u7acb\u4e0d\u5fc5\u8981\u91cd\u8907\u7684\u7269\u4ef6</li> <li>Instance-controlled class</li> </ul> </li> <li> <p>\u53ef\u4ee5\u56de\u50b3 Subclass</p> <ul> <li>interface-based frameworks</li> <li>conceptual weight: \u958b\u767c\u4eba\u54e1\u9700\u8981\u638c\u63e1\u591a\u5c11\u6982\u5ff5\u624d\u80fd\u5920\u4f7f\u7528 API</li> </ul> <p>Info</p> <p>Java 8 \u4ee5\u524d\uff0cinterface \u4e0d\u80fd\u6709 static method\u3002\u5728\u5be6\u4f5c\u4e0a\uff0c\u9700\u8981 static factory methods \u7684 class \u6703\u547d\u540d\u6210 Type + s\uff0c\u4e26\u5c07 constructor \u5ba3\u544a\u6210 private\uff0c\u4f8b\u5982 <code>Collections</code>, <code>Arrays</code>\u3002</p> </li> <li> <p>\u53ef\u4ee5\u4f9d\u64da\u60c5\u6cc1\u56de\u50b3\u4e0d\u540c\u7684 Subclass</p> <ul> <li>\u5141\u8a31\u4e0d\u540c\u7684 release \u66f4\u63db return \u7684 subclass\u3002</li> <li> <p><code>EnumSet</code> \u7684\u5be6\u4f5c\uff0c\u6839\u64da enum \u6578\u91cf\u7684\u4e0d\u540c\uff0c\u56de\u50b3\u4e0d\u540c\u7684 subclass\u3002\u56de\u50b3\u7684 subclass \u8207\u689d\u4ef6\u662f\u53ef\u4ee5\u6539\u8b8a\u800c\u4e0d\u5f71\u97ff\u547c\u53eb\u7aef\u7684\u3002</p> <pre><code>// \u793a\u610f\u7a0b\u5f0f\u78bc\nclass EnumSet {\n   static &lt;E extends Enum&lt;E&gt;&gt; EnumSet&lt;E&gt; noneOf(Class&lt;E&gt; elementType) {\n        if (elementType.getEnumCount() &lt;= 64)\n            return new RegularEnumSet(..)\n        else\n            return new JumboEnumSet(..)\n   }\n}\n</code></pre> <ul> <li>\u689d\u4ef6 (<code>&lt;= 64</code>) \u8207 subclass \u7684\u5be6\u4f5c\u662f\u53ef\u4ee5\u6539\u8b8a\u7684\uff0c\u800c\u4e0d\u5f71\u97ff\u547c\u53eb\u7aef\u7684\u7a0b\u5f0f\u78bc\u3002</li> </ul> </li> </ul> </li> <li> <p>\u5728\u64b0\u5beb\u7a0b\u5f0f\u78bc\u6642\uff0c\u985e\u5225\u4e0d\u5fc5\u5b58\u5728</p> <ul> <li>\u5229\u65bc service provider frameworks<ul> <li>\u6846\u67b6\u958b\u767c\u5546\u4e0d\u5fc5\u63d0\u524d\u77e5\u9053\u6240\u6709 interface \u53ef\u80fd\u7684\u5be6\u4f5c</li> <li>\u8b93 interface \u5be6\u4f5c\u5ef6\u9072\u5230 development time \u6c7a\u5b9a</li> <li>\u4f8b\u5982: JDBC API \u7684 Connection interface\uff0c\u958b\u767c\u4eba\u54e1\u53ef\u4ee5\u5728\u958b\u767c\u6642\u5728\u6c7a\u5b9a\u5177\u9ad4\u7684 Connection \u5be6\u4f5c\uff0c\u50cf\u662f\u900f\u904e property \u8a2d\u5b9a Connection \u662f MySql <code>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</code></li> </ul> </li> <li>Bridge pattern</li> <li>\u53ef\u4ee5\u914d\u5408 Dependency injection frameworks \u4f7f\u7528</li> <li><code>ServiceLoader</code></li> </ul> </li> </ol>"},{"location":"java/effective-java/01_consider_static_factor_methods_instead_of_constructors/#_2","title":"\u9650\u5236","text":"<p>\u504f\u597d static factory method \u7684\u9650\u5236\uff1a</p> <ol> <li> <p>\u62cb\u68c4\u7e7c\u627f:</p> <ul> <li>constructor \u88ab\u5ba3\u544a\u6210 <code>private</code> / <code>protected</code>\uff0c\u4f7f\u5f97 subclass \u7121\u6cd5\u521d\u59cb\u5316 superclass\uff0c\u9020\u6210\u7121\u6cd5\u7e7c\u627f\u3002</li> <li>\u7121\u6cd5\u7e7c\u627f\u610f\u5473\u8457\u653e\u68c4 polymorphism \u7684\u7279\u6027\u3002</li> </ul> <p>Question</p> <p>\u5982\u679c\u540c\u6642\u8b93 class \u4fdd\u6709 static factory methods \u4e26\u4e14\u628a constructor \u5ba3\u544a\u6210 <code>public</code> \u5462?</p> </li> <li> <p>\u589e\u52a0 debug \u96e3\u5ea6:</p> <ul> <li>\u56e0\u70ba\u5efa\u7acb\u7269\u4ef6\u7684\u52d5\u4f5c\u96b1\u85cf\u5728 static factory methods \u88e1\uff0c\u6240\u4ee5 debug \u6642\u7121\u6cd5\u76f4\u63a5\u770b\u5230\u5efa\u7acb\u7269\u4ef6\u7684\u5730\u65b9\uff0c\u4ee5\u53ca\u600e\u9ebc\u88ab\u5efa\u7acb\u7684\u3002</li> <li>\u4ee5\u4e0b\u5e7e\u7a2e\u547d\u540d\u898f\u5247\uff0c\u53ef\u4ee5\u5e6b\u52a9 static factory methods \u7684\u7406\u89e3: (\u6b64\u70ba\u5217\u8209\u800c\u975e\u7aae\u8209)<ul> <li><code>from</code><ul> <li>type-conversion method: \u5f9e \u4e00\u500b type \u7684\u7269\u4ef6\u8f49\u63db\u6210\u53e6\u4e00\u500b type \u7684\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>Date.from(instant)</code></li> </ul> </li> </ul> </li> <li><code>of</code><ul> <li>aggregation method: \u5f9e \u591a\u500b \u53c3\u6578\u7684\u7269\u4ef6\u5408\u4f75\u6210\u4e00\u500b type \u7684\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>EnumSet.of(JACK, QUEEN, KING)</code></li> <li><code>LocalDate.of(2024, 7, 4)</code></li> </ul> </li> </ul> </li> <li><code>valueOf</code><ul> <li>\u6bd4 <code>from</code> \u8207 <code>of</code> \u66f4\u56c9\u5506\u4e00\u9ede\u7684\u7248\u672c</li> <li>\u7bc4\u4f8b:<ul> <li><code>Integer.valueOf(\"100\")</code> </li> <li><code>Integer.valueOf(\"100\", 2)</code></li> </ul> </li> </ul> </li> <li><code>instance</code> / <code>getInstance</code><ul> <li>\u5f9e 0 \u81f3 \u591a\u500b \u53c3\u6578\u5efa\u7acb\u7269\u4ef6</li> <li>\u96d6\u7136\u8aaa\u662f <code>getInstance</code>\uff0c\u4f46\u662f\u4e0d\u4fdd\u8b49\u56de\u50b3\u7684\u662f\u540c\u4e00\u500b\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>Calendar.getInstance()</code> </li> <li><code>Calendar.getInstance(TimeZone.getDefault())</code> </li> </ul> </li> </ul> </li> <li><code>create</code> / <code>newInstance</code><ul> <li>\u5f9e 0 \u81f3 \u591a\u500b \u53c3\u6578\u5efa\u7acb\u7269\u4ef6</li> <li>\u6bcf\u6b21\u90fd\u6703\u5efa\u7acb\u65b0\u7684\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>Array.newInstance(Integer.class, 10)</code></li> </ul> </li> </ul> </li> <li><code>getType</code><ul> <li>\u56de\u50b3\u7684\u7269\u4ef6\u662f <code>Type</code> \u7684 instance</li> <li>\u96d6\u7136\u70ba get\uff0c\u4f46\u662f\u4e0d\u4fdd\u8b49\u56de\u50b3\u7684\u662f\u540c\u4e00\u500b\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>Files.getFileStore(path)</code></li> </ul> </li> </ul> </li> <li><code>newType</code><ul> <li>\u56de\u50b3\u7684\u7269\u4ef6\u662f <code>Type</code> \u7684 instance</li> <li>\u6bcf\u6b21\u90fd\u6703\u5efa\u7acb\u65b0\u7684\u7269\u4ef6</li> <li>\u7bc4\u4f8b:<ul> <li><code>BufferedReader br = Buffer.newBufferedReader(path)</code></li> </ul> </li> </ul> </li> <li><code>type</code><ul> <li><code>getType</code> \u8207 <code>newType</code> \u7684\u7c21\u5316\u7248</li> <li>\u7bc4\u4f8b:<ul> <li><code>Collections.singletonList(\"apple\")</code></li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ol>"},{"location":"spring-boot/scheduler/hello_world/","title":"Quartz: Hello World","text":""},{"location":"spring-boot/scheduler/hello_world/#5-hello-world","title":"\u6bcf 5 \u79d2\u8f38\u51fa \"Hello World!\" \u5230\u756b\u9762\u4e0a","text":"<pre>2129477a-dd2f-4af2-b0ff-06d7dbc27594</pre> <p>\u7576\u7a0b\u5f0f\u555f\u52d5\u6642\uff0c Quartz Scheduler \u6703\u5728\u80cc\u666f\u57f7\u884c\uff0c\u4e26\u5728 <code>helloWorldTrigger</code> \u5b9a\u7fa9\u7684\u6bcf 5 \u79d2\u57f7\u884c\u4e00\u6b21 <code>HelloWorldJob</code> \u5be6\u4f5c\u7684 <code>execute</code> \u8f38\u51fa \"Hello World!\" \u5230\u756b\u9762\u4e0a\u3002</p> <p>\u5728 <code>build.gradle.kts</code> \u4e2d\u65b0\u589e <code>spring-boot-starter-quartz</code> \u76f8\u4f9d\u5957\u4ef6\u3002\u5982\u6b64\uff0c\u7a0b\u5f0f\u555f\u52d5\u5f8c\u5c31\u6703\u6709\u4e00\u500b Quartz Scheduler \u5728\u80cc\u666f\u57f7\u884c\u3002</p> build.gradle.kts<pre><code>implementation(\"org.springframework.boot:spring-boot-starter-quartz\")\n</code></pre> <p>\u63a5\u8457\uff0c\u6211\u5011\u9700\u8981\u5b9a\u7fa9 <code>HelloWorldJob</code> \u5be6\u4f5c <code>Job</code> \u4ecb\u9762\uff0c\u5be6\u4f5c\u8f38\u51fa \"Hello World!\" \u7684\u908f\u8f2f\u3002</p> HelloWorldJob.java<pre><code>public class HelloWorldJob implements Job {\n    @Override\n    public void execute(JobExecutionContext jobExecutionContext) {\n        System.out.println(\"Hello World!\");\n    }\n}\n</code></pre> <p>\u7136\u5f8c\uff0c\u6211\u5011\u9700\u8981\u518d\u65b0\u589e\u5169\u500b Bean \u5b9a\u7fa9 <code>JobDetail</code> \u548c <code>Trigger</code>\u3002\u5176\u4e2d\uff0c<code>JobDetail</code> \u5b9a\u7fa9\u4e86 <code>HelloWorldJob</code> \u7684 metadata\uff0c\u800c <code>Trigger</code> \u5b9a\u7fa9\u4e86 <code>JobDetail</code> \u7684\u89f8\u767c\u689d\u4ef6\u3002</p> QuartzConfig.java<pre><code>@Component\npublic class QuartzConfig {\n\n    @Bean\n    public JobDetail helloWorldJobDetail() {\n        return JobBuilder.newJob(HelloWorldJob.class)\n                         .withIdentity(\"helloWorldJob\")\n                         .storeDurably() // (1)\n                         .build();\n    }\n\n    @Bean\n    public Trigger helloWorldTrigger(JobDetail printHelloWorldJobDetail) {\n        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder\n                .simpleSchedule()\n                .withIntervalInSeconds(5)\n                .repeatForever();\n        return TriggerBuilder.newTrigger()\n                             .forJob(printHelloWorldJobDetail)\n                             .withIdentity(\"helloWorldTrigger\")\n                             .withSchedule(scheduleBuilder)\n                             .build();\n    }\n}\n</code></pre> <ol> <li><code>Trigger</code> \u8981\u57f7\u884c\u7684 <code>JobDetail</code> \u5fc5\u9808\u8981\u5728 <code>JobStore</code> \u4e2d\uff0c\u8a2d\u5b9a <code>storeDurably()</code> \u4f86\u4fdd\u8b49 <code>JobDetail</code> \u5728 <code>JobStore</code> \u4e2d\u3002\u5426\u5247\uff0c<code>JobDetail</code> \u6703\u5728\u6c92\u6709\u8207 <code>Trigger</code> \u95dc\u806f\u7684\u60c5\u6cc1\u4e0b\u88ab\u79fb\u9664\u3002</li> </ol> <p>\u6700\u5f8c\uff0c\u628a\u7a0b\u5f0f\u8dd1\u8d77\u4f86\u5f8c\uff0c\u6bcf 5 \u79d2\u5c31\u6703\u5728\u756b\u9762\u4e0a\u8f38\u51fa \"Hello World!\"\u3002</p>"},{"location":"spring-boot/scheduler/hello_world/#5-hello-name","title":"\u6bcf 5 \u79d2\u8f38\u51fa \"Hello {name}!\" \u5230\u756b\u9762\u4e0a","text":"<p>\u9019\u88e1\u5c55\u793a <code>Job</code> \u53ef\u4ee5\u5b58\u53d6\u5230 bean \u7684\u65b9\u5f0f\u3002\u70ba\u4e86\u65b9\u4fbf\u5c55\u793a\uff0c\u6211\u5011\u65b0\u589e\u4e00\u500b <code>name</code> bean\uff0c\u4e26\u5728 <code>HelloWorldJob</code> \u4e2d\u53d6\u5f97 <code>name</code> bean \u7684\u503c\u3002</p> HelloWorldJob.java<pre><code>@Bean\npublic String name() {\n    return \"Teddy\";\n}\n</code></pre> <p>\u4fee\u6539 <code>HelloWorldJob</code> \u7684\u5efa\u69cb\u5f0f\u63a5\u6536 <code>name</code> \u5b57\u4e32\uff0c\u9019\u500b\u8b8a\u6578\u7684\u5be6\u9ad4\uff0c\u6703\u900f\u904e DI \u6ce8\u5165\u3002</p> HelloWorldJob.java<pre><code>public class HelloWorldJob implements Job {\n    private final String name;\n\n    public HelloWorldJob(String name) {\n        this.name = name;\n    }\n\n    @Override\n    public void execute(JobExecutionContext jobExecutionContext) {\n        System.out.println(\"Hello \" + name + \"!\");\n    }\n}\n</code></pre> <p>\u6700\u5f8c\uff0c\u628a\u7a0b\u5f0f\u8dd1\u8d77\u4f86\u5f8c\uff0c\u6bcf 5 \u79d2\u5c31\u6703\u5728\u756b\u9762\u4e0a\u8f38\u51fa \"Hello Teddy!\"\u3002</p>"},{"location":"spring-boot/scheduler/hello_world/#_1","title":"\u81ea\u52d5\u5316\u6e2c\u8a66","text":"<p>\u4f7f\u7528 awaitility \u4f86\u5be6\u4f5c\u9700\u8981\u7b49\u5f85\u6642\u9593\u7684\u6e2c\u8a66\u3002\u9996\u5148\uff0c\u9700\u8981\u589e\u52a0\u76f8\u4f9d\u5957\u4ef6\u3002</p> build.gradle.kts<pre><code>testImplementation(\"org.awaitility:awaitility\")\n</code></pre> <p>awaitility \u5728 Spring Boot 3.2 \u5df2\u53d7\u5230\u76f8\u4f9d\u63a7\u7ba1\uff0c\u6240\u4ee5\u4f7f\u7528 3.2 \u4ee5\u4e0a\u7684\u7248\u672c\u9019\u88e1\u4e0d\u9700\u8981\u52a0\u7248\u672c\u865f\u78bc\u3002</p> <p>\u4f7f\u7528 JUnit 5 \u9032\u884c\u6e2c\u8a66\u3002\u6e2c\u8a66\u9a57\u8b49 15 \u79d2\u5167\uff0c\u5fc5\u9808\u8981\u6709 \"Hello World!\" \u5b57\u4e32\u8f38\u51fa\u5230 standard output \u4e0a\u3002</p> <pre><code>@SpringBootTest\nclass HelloWorldJobTest {\n    private final PrintStream standardOut = System.out; // (1)!\n\n    private final ByteArrayOutputStream outputStreamCaptor = new ByteArrayOutputStream(); // (2)!\n\n    @BeforeEach\n    public void setUp() {\n        System.setOut(new PrintStream(outputStreamCaptor)); // (3)!\n    }\n\n    @AfterEach\n    public void tearDown() {\n        System.setOut(standardOut); // (4)!\n    }\n\n    @Test\n    void helloWorld() {\n    await().atMost(Duration.ofSeconds(15)) // (5)!\n           .untilAsserted(() -&gt; assertThat(outputStreamCaptor.toString()).contains(\"Hello World!\")); // (6)!\n    }\n}\n</code></pre> <ol> <li>\u5148\u8a18\u4e0b\u9810\u8a2d\u7684 <code>System.out</code>\uff0c\u5728\u6e2c\u8a66\u7d50\u675f\u5f8c\u9084\u539f\u4f7f\u7528\u3002</li> <li>\u5efa\u7acb\u4e00\u500b <code>ByteArrayOutputStream</code> \u4f86\u53d6\u4ee3 <code>System.out</code>\uff0c\u9019\u6a23\u53ef\u4ee5\u628a <code>System.out</code> \u7684\u8f38\u51fa\u6355\u6349\u5230 <code>ByteArrayOutputStream</code> \u4e2d\u3002</li> <li>\u5728\u6bcf\u4e00\u500b\u6e2c\u8a66\u958b\u59cb\u524d\uff0c\u628a <code>System.out</code> \u8a2d\u5b9a\u70ba <code>ByteArrayOutputStream</code>\u3002</li> <li>\u5728\u6bcf\u4e00\u500b\u6e2c\u8a66\u7d50\u675f\u5f8c\uff0c\u628a <code>System.out</code> \u9084\u539f\u70ba\u9810\u8a2d\u7684 <code>System.out</code>\u3002</li> <li>\u7b49\u5f85\u6700\u591a 15 \u79d2\u3002</li> <li>\u78ba\u8a8d standard output \u8f38\u51fa\u5fc5\u9808\u5305\u542b \"Hello World!\"\u3002</li> </ol>"},{"location":"spring-boot/scheduler/hello_world/#_2","title":"\u53c3\u8003","text":"<ul> <li>Scheduling Tasks</li> <li>Unit Testing of <code>System.out.println()</code> with JUnit</li> </ul>"},{"location":"spring-boot/scheduler/jdbc_job_store/","title":"Quartz: JDBC JobStore","text":""},{"location":"spring-boot/scheduler/jdbc_job_store/#job","title":"\u7c21\u55ae\u7684 Job \u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u7bc4\u4f8b\u5c55\u793a\uff0c\u5728 Spring Boot \u4e2d\u5982\u4f55\u8a2d\u5b9a Quartz \u4f7f\u7528 JDBC JobStore\u3002\u5982\u6b64\u4e00\u4f86\uff0c\u6211\u5011\u628a Job \u653e\u5230 cluster \u4e0a\u57f7\u884c\u3002</p> <p>\u5728 <code>build.gradle.kts</code> \u4e2d\u65b0\u589e <code>spring-boot-starter-quartz</code> \u76f8\u4f9d\u5957\u4ef6\u3002\u5982\u6b64\uff0c\u7a0b\u5f0f\u555f\u52d5\u5f8c\u5c31\u6703\u6709\u4e00\u500b Quartz Scheduler \u5728\u80cc\u666f\u57f7\u884c\u3002</p> build.gradle.kts<pre><code>implementation(\"org.springframework.boot:spring-boot-starter-quartz\")\n</code></pre> <p>\u4f7f\u7528 docker compose \u57f7\u884c mysql\u3002</p> compose.yml<pre><code>version: '3.1'\n\nservices:\n  database:\n    image: mysql:8.4.0\n    ports:\n      - \"3306:3306\"\n    environment:\n      MYSQL_ALLOW_EMPTY_PASSWORD: true\n      MYSQL_DATABASE: quartz\n</code></pre> <p>\u8a2d\u5b9a spring boot \u7684 properties\u3002</p> src/main/resources/application.yml<pre><code>spring:\n  datasource: #(1)!\n    name: datasource\n    url: jdbc:mysql://localhost:3306/quartz\n    username: root\n    password:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n  quartz:\n    job-store-type: jdbc #(2)!\n    jdbc:\n      initialize-schema: always #(3)!\n    overwrite-existing-jobs: true\n    properties:\n      org:\n        quartz:\n          scheduler:\n            instanceName: scheduler\n            instanceId: AUTO #(4)!\n          dataSource:\n            quartzDataSource: #(5)!\n              driver: com.mysql.cj.jdbc.Driver\n              URL: jdbc:mysql://localhost:3306/quartz\n              user: root\n              password:\n              provider: hikaricp\n          jobStore:\n            class: org.quartz.impl.jdbcjobstore.JobStoreTX\n            dataSource: quartzDataSource #(5)!\n            isClustered: true #(6)!\n</code></pre> <ol> <li><code>spring.quartz.jdbc.initialize-schema</code> \u5403\u7684 Data Source \u8a2d\u5b9a\u3002\u5728 <code>spring.quartz.properties.org.quartz.dataSource</code> \u8a2d\u5b9a\u7684 Data Source \u4e0d\u652f\u63f4 initialize schema\u3002</li> <li>\u4f7f\u7528 JDBC JobStore\u3002</li> <li>\u6bcf\u6b21\u555f\u52d5\u90fd\u6703\u521d\u59cb\u5316 schema\u3002\u63db\u53e5\u8a71\u8aaa\uff0c\u6211\u5011\u53ef\u4ee5\u4e0d\u5fc5\u624b\u52d5\u65b0\u589e quartz \u76f8\u95dc\u7684 tables\u3002(SQL \u53c3\u8003)</li> <li>\u5728 cluster \u4e0a\u7684 pod \u9700\u8981\u6709\u552f\u4e00\u7684 instance id\u3002\u9019\u88e1\u8a2d\u5b9a <code>AUTO</code> \u5373\u53ef\u9054\u5230\u9700\u6c42\u3002</li> <li>data source \u7684\u8a2d\u5b9a\u3002\u9019\u88e1\u7684\u540d\u7a31\u6703\u5728\u4e0b\u9762\u8a2d\u5b9a job store \u7684 dataSource \u53c3\u8003\u3002</li> <li>job store \u4f7f\u7528\u7684 dataSource\u3002</li> <li>\u555f\u7528 cluster\u3002</li> </ol> \u4f7f\u7528\u8b8a\u6578\u4f86\u907f\u514d\u91cd\u8907\u8a2d\u5b9a <pre><code>spring:\n  quartz:\n    properties:\n      org:\n        quartz:\n          dataSource:\n            quartzDataSource:\n              driver: ${spring.datasource.driver-class-name}\n              URL: ${spring.datasource.url}\n              user: ${spring.datasource.username}\n              password: ${spring.datasource.password}\n</code></pre> <p>\u65b0\u589e <code>Job</code> \u5be6\u4f5c\uff0c\u7c21\u55ae\u7684\u5728\u756b\u9762\u8f38\u51fa\u73fe\u5728\u7684\u6642\u9593\u4ee5\u53ca \"Hello World!\"\u3002\u5370\u51fa\u6642\u9593\u662f\u70ba\u4e86\u5e6b\u52a9\u6211\u5011\u8b58\u5225\u9019\u662f\u54ea\u500b\u6642\u9593\u9ede\u6240\u89f8\u767c\u7684 Job\u3002</p> HelloWorldJob.java<pre><code>public class HelloWorldJob implements Job {\n    @Override\n    public void execute(JobExecutionContext jobExecutionContext) {\n        String time = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"hh:mm:ss\"));\n        System.out.println(time + \" Hello World!\");\n    }\n}\n</code></pre> <p>\u65b0\u589e <code>JobDetail</code> \u548c <code>Trigger</code> \u7684 Bean \u5b9a\u7fa9\u3002\u9019\u88e1\u8a2d\u5b9a\u6bcf 10 \u79d2\u89f8\u767c\u4e00\u6b21 Job \u5728\u756b\u9762\u4e0a\u8f38\u51fa \"Hello World!\"\u3002</p> <pre><code>@Component\npublic class QuartzConfig {\n\n    @Bean\n    public JobDetail helloWorldJobDetail() {\n        return JobBuilder.newJob(HelloWorldJob.class)\n                         .withIdentity(\"helloWorldJob\")\n                         .storeDurably()\n                         .build();\n    }\n\n    @Bean\n    public Trigger helloWorldTrigger(JobDetail printHelloWorldJobDetail) {\n        return TriggerBuilder.newTrigger()\n                             .forJob(printHelloWorldJobDetail)\n                             .withIdentity(\"helloWorldTrigger\")\n                             .withSchedule(CronScheduleBuilder.cronSchedule(\"*/10 * * * * ?\"))\n                             .build();\n    }\n}\n</code></pre> <p>\u70ba\u4e86\u53ef\u4ee5\u540c\u6642\u57f7\u884c\u591a\u500b instance\uff0c\u6211\u5011\u5c07\u7a0b\u5f0f\u6253\u5305\u6210 tar \u6a94\u3002\u5c08\u6848\u7684\u76ee\u9304 /build/libs \u61c9\u8a72\u6703\u7522\u751f xxx.jar \u6a94\u3002</p> <pre><code>./gradlew bootJar\n</code></pre> <p>\u6253\u958b 3 \u500b terminal\uff0c\u5206\u5225\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u57f7\u884c\u7a0b\u5f0f: (xxx \u66ff\u63db\u6210\u5be6\u969b\u6a94\u6848\u540d\u7a31)</p> <pre><code>java -jar build/libs/xxx.jar\n</code></pre> <p>\u89c0\u5bdf\u6bcf 10 \u79d2\u53ea\u6703\u6709\u4e00\u500b terminal \u8f38\u51fa \"Hello World!\"\u3002\u9019\u8868\u793a Job \u662f\u5728 cluster \u4e0a\u57f7\u884c\u7684\u3002\u5c07\u8f38\u51fa\u8a0a\u606f\u7684 terminal \u95dc\u9589\uff0c\u53ef\u4ee5\u89c0\u5bdf\u5230\u5176\u4ed6 terminal \u6703\u63a5\u7e8c\u57f7\u884c\u8f38\u51fa \"Hello World!\" \u7684 Job\u3002</p> <p>\u4e00\u500b trigger \u4e00\u500b job instance \u7684\u8a2d\u5b9a</p> <p><code>org.quartz.scheduler.batchTriggerAcquisitionMaxCount</code> \u9810\u8a2d\u503c\u70ba 1 \u8a2d\u5b9a\u4e86 Trigger \u7684 job \u4e00\u6b21\u57f7\u884c\u4e00\u500b instance\u3002\u53ef\u4ee5\u8a2d\u5b9a\u5176\u4ed6\u6578\u503c\u4f86\u8b93\u540c\u4e00 trigger \u540c\u6642\u57f7\u884c\u591a\u500b job\u3002</p>"},{"location":"spring-boot/scheduler/jdbc_job_store/#_1","title":"\u63a2\u8a0e: \u57f7\u884c\u6642\u9593\u8d85\u904e\u4e0b\u4e00\u6b21\u6392\u7a0b\u7684\u6642\u9593\u7684\u884c\u70ba","text":"<p>\u5047\u8a2d\u6211\u5011\u8a2d\u5b9a\u6bcf 10 \u79d2\u8dd1\u4e00\u500b job\u3002\u4e26\u4e14\uff0c\u6bcf\u500b job \u57f7\u884c\u6642\u9593\u9700\u8981 15 \u79d2\u3002\u4e5f\u5c31\u662f\u8aaa\uff0cjob \u7684\u57f7\u884c\u6642\u9593\u5fc5\u5b9a\u6703\u8986\u84cb\u5230\u4e0b\u4e00\u6b21\u89f8\u767c\u7684\u6642\u9593\u3002\u5728\u6c92\u6709\u7279\u5225\u8a2d\u5b9a\u7684\u60c5\u6cc1\u4e0b\uff0c\u7d93\u904e 30 \u79d2\u5f8c\uff0c\u5c07\u6703\u6709 3 \u500b job \u88ab\u8dd1\u8d77\u4f86\u3002job \u8207 job \u7684\u6642\u9593\u6642\u9593\u662f\u6703\u91cd\u758a\u7684\u3002</p> <pre>0be4f7b0-a78b-4b62-9690-dea9eb6a9e66</pre>"},{"location":"spring-boot/scheduler/jdbc_job_store/#disallowconcurrentexecution","title":"\u4f7f\u7528<code>@DisallowConcurrentExecution</code> \u4f86\u907f\u514d\u91cd\u758a\u57f7\u884c","text":"<p>\u5728 Job \u7684\u5ba3\u544a\u52a0\u4e0a <code>@DisallowConcurrentExecution</code> \u4f86\u907f\u514d Job \u91cd\u758a\u57f7\u884c\u3002</p> HelloWorldJob.java<pre><code>@DisallowConcurrentExecution\npublic class HelloWorldJob implements Job {\n    // ...\n}\n</code></pre> <p>\u5982\u6b64\uff0c\u7576 Job \u9084\u5728\u57f7\u884c\u6642\uff0c\u4e0b\u4e00\u6b21\u7684 Job \u5c07\u6703\u88ab\u5ef6\u9072\u5230\u4e0a\u4e00\u6b21\u7684 Job \u57f7\u884c\u5b8c\u7562\u5f8c\u518d\u57f7\u884c\u3002\u8b8a\u66f4\u5f8c\u7684 3 \u500b Job \u57f7\u884c\u6642\u9593\u8ef8\u53c3\u8003\u4e0b\u5716:</p> <pre>eefc9691-d6a3-46fc-b166-aa70201ed684</pre>"},{"location":"spring-boot/scheduler/jdbc_job_store/#trigger","title":"\u8a08\u7b97\u6392\u7a0b\u7684\u6642\u9593\u8207\u89f8\u767c\u7684\u6642\u9593\u5dee\u4f86\u5ffd\u7565\u932f\u904e\u7684 trigger","text":"<p>\u5728 <code>Job.execute</code> \u958b\u59cb\u524d\uff0c\u6aa2\u67e5 job \u89f8\u767c\u7684\u6642\u9593\u8207\u6392\u7a0b\u7684\u6642\u9593\u5dee\uff0c\u5982\u679c\u8d85\u904e\u4e00\u5b9a\u6642\u9593\uff0c\u5247\u5ffd\u7565\u9019\u6b21\u7684 trigger\u3002\u7bc4\u4f8b\u4e2d\u662f\u6642\u9593\u5dee\u8d85\u904e 1000 \u6beb\u79d2 (1 \u79d2) \u5c31\u5ffd\u7565\u9019\u6b21\u7684 trigger\u3002</p> HelloWorldJob.java<pre><code>@DisallowConcurrentExecution\npublic class HelloWorldJob implements Job {\n    @Override\n    public void execute(JobExecutionContext context) {\n        if (context.getFireTime().getTime() - context.getScheduledFireTime().getTime() &gt; 1000) {\n            return;  // skip this trigger\n        }\n        // ...\n    }\n}\n</code></pre> <p>\u5982\u6b64\uff0ctrigger \u7684 job \u90fd\u6703\u843d\u5728\u6392\u7a0b\u8a2d\u5b9a\u7684\u6642\u9593\u9ede\u4e0a\u3002\u8b8a\u66f4\u5f8c\u7684 Job \u57f7\u884c\u6642\u9593\u8ef8\u53c3\u8003\u4e0b\u5716:</p> <pre>b689e848-ee28-4b57-ab44-8b0325159791</pre> <p>Note</p> <p>\u76ee\u524d\u6c92\u6709\u767c\u73fe\u5b98\u65b9\u5c0d\u65bc\u6b64\u65b9\u6848\u7684\u89e3\u6cd5\u3002\u9019\u88e1\u7684\u89e3\u6cd5\u6709\u571f\u6cd5\u7149\u92fc\u7684\u611f\u89ba\u3002</p>"},{"location":"spring-boot/scheduler/jdbc_job_store/#job_1","title":"\u63a2\u8a0e: Job \u57f7\u884c\u904e\u7a0b\u767c\u751f\u932f\u8aa4\u7684\u884c\u70ba","text":"<p>\u5728 Job \u57f7\u884c\u904e\u7a0b\u4e2d\uff0c\u5982\u679c\u62cb\u51fa\u4f8b\u5916\uff0cJob \u5373\u4e2d\u65b7\u57f7\u884c\u3002\u5982\u679c\u62cb\u51fa\u7684\u4f8b\u5916\u662f <code>JobExecutionException</code> \u4e26\u8a2d\u5b9a <code>refireImmediately</code> \u70ba <code>true</code>\uff0c\u5247 Job \u6703\u7acb\u5373\u91cd\u65b0\u57f7\u884c\uff0c\u4e26\u4e14\u4e0b\u4e00\u6b21 <code>JobExecutionContext.getRefireCount()</code> \u6578\u5b57\u7d2f\u52a0\u3002 \u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u5c55\u793a\u7576 Job \u5931\u6557\u62cb\u51fa\u4f8b\u5916\u6642\uff0c retry 3 \u6b21\u3002</p> HelloWorldJob.java<pre><code>@DisallowConcurrentExecution\npublic class HelloWorldJob implements Job {\n    @Override\n    public void execute(JobExecutionContext context) {\n        if(context.getRefireCount() &gt; 3) {\n            throw new JobExecutionException(\"Too many re-fires\");\n        }\n\n        // ...\n\n        throw new JobExecutionException(\"Something goes wrong\", true);\n    }\n}\n</code></pre>"},{"location":"spring-boot/scheduler/jdbc_job_store/#_2","title":"\u53c3\u8003","text":"<ul> <li>Sprint Boot Quartz Scheduler</li> <li>Quartz Configuration - Configure Clustering with JDBC-JobStore </li> </ul>"}]}