# Item 15: Minimize the accessibility of classes and members

ğŸ‘ make each class or member as inaccessible as possible.

## Top-level (non-nested) classes and interfaces

ä½¿ç”¨å…©å€‹å­˜å–ä¿®é£¾è©: `public` å’Œ package-privateã€‚

package-private æ˜¯æ²’æœ‰ä»»ä½•å­˜å–ä¿®é£¾è©ï¼Œå°±æ˜¯é€™å€‹å­˜å–æ¬Šé™ã€‚

public class æ˜¯ package API çš„ä¸€éƒ¨åˆ†ï¼Œpackage-private class æ˜¯ package implementation çš„ä¸€éƒ¨åˆ†ã€‚

### é‡æ§‹æˆ private çš„ nested class/interface

ç•¶ package-private class/interface åƒ…è¢«å”¯ä¸€ä½¿ç”¨ï¼Œè€ƒæ…®å°‡å®ƒè®Šæˆ private çš„ nested class/interface

=== "é‡æ§‹å‰"
    ```java hl_lines="1-5"
    class Processor { // package-private class
        public void process() {
            // do something
        }
    }

    public class DataHandler {
        private Processor processor;

        public DataHandler() {
            this.processor = new Processor();
        }

        public void handleData() {
            processor.process();
        }
    }
    ```

=== "é‡æ§‹å¾Œ"
    ```java hl_lines="2-6"
    public class DataHandler {
        private static class Processor { // private nested class
            public void process() {
                // do something
            }
        }

        private Processor processor;

        public DataHandler() {
            this.processor = new Processor();
        }

        public void handleData() {
            processor.process();
        }
    }
    ```

!!! question "ä»€éº¼æƒ…å¢ƒæœƒéœ€è¦å°‡ package-private interface è®Šæˆ private nested interface?"

## Members

members: fields, methods, nested classes, and nested interfaces

- `private` member: åªæœ‰å®£å‘Šæ­¤ member çš„ top-level class å¯ä»¥å­˜å–
- package-private member: åªæœ‰å®£å‘Šæ­¤ member çš„åŒä¸€å€‹ package åº•ä¸‹çš„ class å¯ä»¥å­˜å–
- `protected` member: åªæœ‰å®£å‘Šæ­¤ member çš„ class åŠå…¶å­é¡åˆ¥å¯ä»¥å­˜å–
- `public` member: æ‰€æœ‰ member éƒ½å¯ä»¥å­˜å–

### Instance fields

é final æˆ–åƒè€ƒåˆ° mutable object çš„ field ä¸æ‡‰è©²æ˜¯ `public`ã€‚å³ä½¿ final æˆ– immutable objectï¼Œä¸ä½¿ç”¨ `public` ä¹Ÿæœ‰åŠ©æ–¼åˆ‡å‰²å¤–éƒ¨èˆ‡å…§éƒ¨è³‡æ–™çµæ§‹çš„ç›¸ä¾æ€§ã€‚

!!! danger "Classes with public mutable fields are not generally thread-safe"

static field é€šå¸¸æ‡‰è©²æ˜¯ `private`ï¼Œæˆ–æ˜¯ `publlic static final` æš´éœ² constant valueã€‚`public static final` field çš„åç¨±å…¨å¤§å¯«ï¼Œä¸¦ç”¨åº•ç·šä½œç‚ºæ–‡å­—é–“çš„å€éš”ã€‚éœ€è¦æ³¨æ„ï¼Œ`public static final` field å¿…é ˆè¦åƒè€ƒåˆ° primitive type æˆ– immutable objectã€‚

!!! danger "Nonzero-length array is always mutable"

```java
private record Thing(int value) {
}

public static final Thing[] THINGS = { new Thing(1), new Thing(2), new Thing(3)};
public static void main(String[] args) {
        System.out.println(Arrays.stream(THINGS).map(Object::toString).collect(Collectors.joining(", ")));
        THINGS[0] = new Thing(4); // (1)!
        System.out.println(Arrays.stream(THINGS).map(Object::toString).collect(Collectors.joining(", ")));
}
```

1. å°‡ç¬¬ä¸€å€‹å…ƒç´ æ”¹æˆå…¶ä»– instance

è¼¸å‡º

```html
Thing[value=1], Thing[value=2], Thing[value=3]
Thing[value=4], Thing[value=2], Thing[value=3]
```

å»ºè­°ä¿®æ”¹

=== "ä½¿ç”¨ unmodifiableList"

    ```java
    private static final Thing[] THINGS = { ... }; // (1)!
    public static final List<Thing> VALUES =
        Collections.unmodifiableList(Arrays.asList(THINGS)); // (2)!
    ```

    1. å®£å‘Šæˆ `private`
    2. ä½¿ç”¨ `Collections.unmodifiableList` ä¾†ä¿è­· array
 
=== "ä½¿ç”¨ clone"

    ```java
    private static final Thing[] THINGS = { ... }; // (1)!
    public static final Thing[] values() {
        return THINGS.clone(); // (2)!
    }
    ```

    1. å®£å‘Šæˆ `private`
    2. ä½¿ç”¨ `clone` ä¾†ä¿è­· array
