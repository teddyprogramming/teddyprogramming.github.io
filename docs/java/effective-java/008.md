# Item 8: Avoid finalizers and cleaners

避免使用 finalizer 和 cleaner 進行資源管理。

## 為什麼要避免？

- **不可靠**：無法保證執行時機
- **效能差**：影響 GC 效率
- **已棄用**：finalizer 在 Java 9 已標記為過時

## 正確做法

### 1. Try-with-resources (推薦)

```java
try (FileInputStream input = new FileInputStream(file)) {
    // 使用資源
} // 自動關閉，即使發生例外
```

### 2. Cleaner（僅作安全網）

```java
public class ResourceManager implements AutoCloseable {
    private static final Cleaner cleaner = Cleaner.create();

    static class CleanAction implements Runnable {
        public void run() {
            // 清理動作，不能參考外部物件
        }
    }

    private final Cleaner.Cleanable cleanable;

    public ResourceManager() {
        this.cleanable = cleaner.register(this, new CleanAction());
    }

    @Override
    public void close() {
        cleanable.clean();
    }
}
```

**重點**：Cleaner 只是安全網，主要還是要靠 try-with-resources。

## 重點整理

✅ **應該做**：

- 實作 `AutoCloseable`
- 使用 try-with-resources
- 提供明確的 `close()` 方法

❌ **不要做**：

- 依賴 finalizer 或 cleaner 釋放資源
- 在清理動作中參考主物件 (會導致 memory leak)

!!! tip "核心原則"
    資源管理應該明確且可預測，不要依賴 GC 的不可預測行為。
